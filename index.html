<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="æˆ‘èœæ•…æˆ‘åœ¨">
<meta property="og:type" content="website">
<meta property="og:title" content="å°èœé¸¡">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="å°èœé¸¡">
<meta property="og:description" content="æˆ‘èœæ•…æˆ‘åœ¨">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="å°èœé¸¡">
<meta name="twitter:description" content="æˆ‘èœæ•…æˆ‘åœ¨">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>å°èœé¸¡</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-106410509-1', 'auto');
  ga('send', 'pageview');
</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->





</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">å°èœé¸¡</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/12/Focus-on-Natural-Language-Processing-Machine-Learning-and-Algorithm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeb">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°èœé¸¡">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/12/Focus-on-Natural-Language-Processing-Machine-Learning-and-Algorithm/" itemprop="url">Focus on Natural Language Processing, Computer Vision and Algorithm</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-03-12T11:34:09+08:00">
                2019-03-12
              </time>
            

            
              <i class="fa fa-thumb-tack"></i>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><video src="https://d4mucfpksywv.cloudfront.net/research-covers/better-language-models/1x-no-mark-animated.mp4" autoplay="autoplay" loop="loop" style="max-width: 100%; display: block; margin-left: auto; margin-right: auto;"><br>your browser does not support the video tag<br></video></p>
<center>ï¼ˆè§†é¢‘æ¥æºï¼š<a href="https://blog.openai.com/better-language-models/" title="è¯­è¨€æ¨¡å‹" target="_blank" rel="external">OpenAI</a>)</center>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/27/LambdaMARTä»æ”¾å¼ƒåˆ°å…¥é—¨/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeb">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°èœé¸¡">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/27/LambdaMARTä»æ”¾å¼ƒåˆ°å…¥é—¨/" itemprop="url">LambdaMARTä»æ”¾å¼ƒåˆ°å…¥é—¨</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2020-03-27T11:53:17+08:00">
                2020-03-27
              </time>
            

            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>

<script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<p> <img src="/images/letfly.png" alt=""></p>
<p>æ¥åˆ°è¿™ç¯‡æ–‡ç« æ‚¨åªéœ€è¦åŠä¸‰ä»¶äº‹ï¼š</p>
<ol>
<li>ç†è§£ Lambdaï¼›</li>
<li>ç†è§£MARTï¼›</li>
<li>ç†è§£LambdaMARTã€‚</li>
</ol>
<p>å…³äºLambdaè¦ä»RankNetè¯´èµ·ï¼Œè¯¦ç»†å†…å®¹å¯ä»¥å‚è€ƒ<a href="[http://octopuscoder.github.io/2020/01/19/%E6%90%9C%E7%B4%A2%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/](http://octopuscoder.github.io/2020/01/19/æœç´¢æ’åºç®—æ³•/">æœç´¢æ’åºç®—æ³•</a>)ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« ä¸»è¦æ¥è§£å†³ç¬¬2å’Œç¬¬3ä¸ªé—®é¢˜ã€‚</p>
<h1 id="ä»€ä¹ˆæ˜¯MART"><a href="#ä»€ä¹ˆæ˜¯MART" class="headerlink" title="ä»€ä¹ˆæ˜¯MART"></a>ä»€ä¹ˆæ˜¯MART</h1><p>MART(Multiple Additive Regression Tree)çš„å¦ä¸€ä¸ªåå­—å«GBDT(Gradient Boosting Decision Tree)ï¼Œç†è§£GBDTè¦ä»BTå¼€å§‹ã€‚</p>
<p>##æå‡æ ‘ï¼ˆboosting treeï¼‰</p>
<p>BT(Boosting Tree)æå‡æ ‘æ˜¯ä»¥<strong>å†³ç­–æ ‘</strong>ä¸ºåŸºæœ¬å­¦ä¹ å™¨çš„æå‡æ–¹æ³•ï¼Œå®ƒè¢«è®¤ä¸ºæ˜¯ç»Ÿè®¡å­¦ä¹ ä¸­æ€§èƒ½æœ€å¥½çš„æ–¹æ³•ä¹‹ä¸€ã€‚å¯¹äºåˆ†ç±»é—®é¢˜ï¼Œæå‡æ ‘çš„å†³ç­–æ ‘æ˜¯äºŒå‰å†³ç­–æ ‘ï¼Œå¯¹äºå›å½’é—®é¢˜ï¼Œæå‡æ ‘ä¸­çš„å†³ç­–æ˜¯äºŒå‰å›å½’æ ‘ã€‚</p>
<p>æå‡æ ‘æ¨¡å‹å¯ä»¥è¡¨ç¤ºä¸ºå†³ç­–æ ‘ä¸ºåŸºå­¦ä¹ å™¨çš„åŠ æ³•æ¨¡å‹ï¼š</p>
<span>$$\begin{gather*}
f(\overrightarrow{\mathbf{x}})=f_{M}(\overrightarrow{\mathbf{x}})=\sum_{m=1}^{M} h_{m}\left(\overrightarrow{\mathbf{x}} ; \Theta_{m}\right)
\end{gather*}$$</span><!-- Has MathJax -->
<p>å…¶ä¸­<span>$h_{m}\left(\overrightarrow{\mathbf{x}} ; \Theta_{m}\right)$</span><!-- Has MathJax -->è¡¨ç¤ºç¬¬ <img src="https://www.zhihu.com/equation?tex=m" alt="[å…¬å¼]"> ä¸ªå†³ç­–æ ‘ï¼Œ<span>$\Theta_{m}$</span><!-- Has MathJax -->ä¸ºç¬¬mä¸ªå†³ç­–æ ‘çš„å‚æ•°ï¼ŒMä¸ºå†³ç­–æ ‘çš„æ•°é‡ã€‚</p>
<p><strong>æå‡æ ‘</strong>é‡‡ç”¨<strong>å‰å‘åˆ†æ­¥ç®—æ³•</strong>:</p>
<ul>
<li>é¦–å…ˆç¡®å®šåˆå§‹æå‡æ ‘<span>$f_{0}(\overrightarrow{\mathbf{x}})=0$</span><!-- Has MathJax -->ã€‚</li>
<li>ç¬¬mæ­¥æ¨¡å‹ä¸ºï¼š<span>$f_{m}(\overrightarrow{\mathbf{x}})=f_{m-1}(\overrightarrow{\mathbf{x}})+h_{m}\left(\overrightarrow{\mathbf{x}} ; \Theta_{m}\right)$</span><!-- Has MathJax -->ï¼Œå…¶ä¸­<span>$h_{m}(\cdot)$</span><!-- Has MathJax -->ä¸ºå¾…æ±‚çš„ç¬¬mæ£µå†³ç­–æ ‘ã€‚</li>
<li>é€šè¿‡ç»éªŒé£é™©æå°åŒ–ç¡®å®šç¬¬mæ£µå†³ç­–æ ‘çš„å‚æ•°$\Theta<em>{m}$: $\hat{\Theta}</em>{m}=\arg \min <em>{\Theta</em>{m}} \sum<em>{i=1}^{N} L\left(\bar{y}</em>{i}, f<em>{m}\left(\overrightarrow{\mathbf{x}}</em>{i}\right)\right)$ã€‚è¿™é‡Œæ²¡æœ‰å¼•å…¥æ­£åˆ™é¡¹ï¼Œè€ŒXGBoostä¸­å¼•å…¥äº†æ­£åˆ™é¡¹ã€‚</li>
</ul>
<p>ä¸åŒé—®é¢˜çš„æå‡æ ‘å­¦ä¹ ç®—æ³•ä¸»è¦åŒºåˆ«åœ¨äºä½¿ç”¨çš„æŸå¤±å‡½æ•°ä¸åŒï¼Œï¼ˆè®¾é¢„æµ‹å€¼ä¸º<span>$\tilde{y}$</span><!-- Has MathJax --> ï¼ŒçœŸå®å€¼ä¸º<span>$\hat{y}$</span><!-- Has MathJax -->):</p>
<ul>
<li>å›å½’é—®é¢˜ï¼šé€šå¸¸ä½¿ç”¨å¹³æ–¹è¯¯å·®æŸå¤±å‡½æ•°<span>$L(\tilde{y}, \hat{y})=(\tilde{y}-\hat{y})^{2}$</span><!-- Has MathJax -->ã€‚</li>
<li>åˆ†ç±»é—®é¢˜ï¼šé€šå¸¸ä½¿ç”¨æŒ‡æ•°æŸå¤±å‡½æ•°ï¼š<span>$L(\tilde{y}, \hat{y})=e^{-\tilde{y} \hat{y}}$</span><!-- Has MathJax --></li>
</ul>
<p><strong>æå‡æ ‘</strong>çš„å­¦ä¹ <strong>æ€æƒ³</strong>æœ‰ç‚¹ç±»ä¼¼ä¸€æ‰“é«˜å°”å¤«çƒï¼Œå…ˆç²—ç•¥çš„æ‰“ä¸€æ†ï¼Œç„¶ååœ¨ä¹‹å‰çš„åŸºç¡€ä¸Šé€æ­¥é è¿‘çƒæ´ï¼Œä¹Ÿå°±æ˜¯è¯´<strong>æ¯ä¸€æ£µæ ‘å­¦ä¹ çš„æ˜¯ä¹‹å‰æ‰€æœ‰æ ‘é¢„æµ‹å€¼å’Œçš„æ®‹å·®</strong>ï¼Œè¿™ä¸ª<strong>æ®‹å·®</strong>å°±æ˜¯ä¸€ä¸ªåŠ é¢„æµ‹å€¼åå¾—åˆ°çœŸå®å€¼çš„ç´¯åŠ é‡ã€‚</p>
<p>ä¾‹å¦‚åœ¨å›å½’é—®é¢˜ä¸­ï¼Œæå‡æ ‘é‡‡ç”¨å¹³æ–¹è¯¯å·®æŸå¤±å‡½æ•°ï¼Œæ­¤æ—¶ï¼š</p>
<span>$$\begin{gather*}
\begin{aligned}
L\left(\tilde{y}, f_{m}(\overrightarrow{\mathbf{x}})\right) &amp;=L\left(\tilde{y}, f_{m-1}(\overrightarrow{\mathbf{x}})+h_{m}\left(\overrightarrow{\mathbf{x}} ; \Theta_{m}\right)\right) \\
=\left(\tilde{y}-f_{m-1}(\overrightarrow{\mathbf{x}})-h_{m}\left(\overrightarrow{\mathbf{x}} ; \Theta_{m}\right)\right)^{2} &amp;=\left(r-h_{m}\left(\overrightarrow{\mathbf{x}} ; \Theta_{m}\right)\right)^{2}
\end{aligned}
\end{gather*}$$</span><!-- Has MathJax -->
<p>å…¶ä¸­<span>$r=\tilde{y}-f_{m-1}(\overrightarrow{\mathbf{x}})$</span><!-- Has MathJax -->ä¸ºå½“å‰æ¨¡å‹æ‹Ÿåˆæ•°æ®çš„æ®‹å·®ã€‚æ‰€ä»¥å¯¹å›å½’é—®é¢˜çš„æå‡æ ‘ç®—æ³•ï¼Œç¬¬mä¸ªå†³ç­–æ ‘ <span>$h_{m}(\cdot)$</span><!-- Has MathJax -->åªéœ€è¦ç®€å•æ‹Ÿåˆå½“å‰æ¨¡å‹çš„æ®‹å·®ã€‚</p>
<p>å›å½’æå‡æ ‘ç®—æ³•å¦‚ä¸‹ï¼š</p>
<p> <img src="/images/boostingTree.png" alt=""></p>
<p>##æ¢¯åº¦æå‡æ ‘(GBT)</p>
<p>ä¸Šé¢æ‰€è®²çš„æå‡æ ‘ä¸­ï¼Œå½“æŸå¤±å‡½æ•°æ˜¯<strong>å¹³æ–¹æŸå¤±å‡½æ•°</strong>å’Œ<strong>æŒ‡æ•°æŸå¤±å‡½æ•°</strong>æ—¶ï¼Œæ¯ä¸€æ­¥ä¼˜åŒ–éƒ½å¾ˆç®€å•ã€‚å› ä¸ºå¹³æ–¹æŸå¤±å‡½æ•°å’ŒæŒ‡æ•°æŸå¤±å‡½æ•°çš„æ±‚å¯¼éå¸¸ç®€å•ã€‚å½“æŸå¤±å‡½æ•°æ˜¯ä¸€èˆ¬å‡½æ•°æ—¶ï¼Œå¾€å¾€æ¯ä¸€æ­¥ä¼˜åŒ–ä¸æ˜¯å¾ˆå®¹æ˜“ã€‚é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œ<code>Freidman</code>æå‡ºäº†<strong>æ¢¯åº¦æå‡æ ‘ç®—æ³•(GBT)</strong>ã€‚</p>
<blockquote>
<p> <strong>æ¢¯åº¦æå‡æ ‘(GBT)</strong>çš„ä¸€ä¸ªæ ¸å¿ƒæ€æƒ³æ˜¯<strong>åˆ©ç”¨æŸå¤±å‡½æ•°çš„è´Ÿæ¢¯åº¦åœ¨å½“å‰æ¨¡å‹çš„å€¼ä½œä¸ºæ®‹å·®çš„è¿‘ä¼¼å€¼</strong>ï¼Œæœ¬è´¨ä¸Šæ˜¯<strong>å¯¹æŸå¤±å‡½æ•°è¿›è¡Œä¸€é˜¶æ³°å‹’å±•å¼€</strong>ï¼Œä»è€Œæ‹Ÿåˆä¸€ä¸ªå›å½’æ ‘ã€‚</p>
</blockquote>
<p><strong>æ³°å‹’å±•å¼€å…¬å¼ï¼š</strong><br><span>$$begin{gather*}
TaylorExpansion:f(x+\Delta x) \simeq f(x)+f^{\prime}(x) \Delta x+\frac{1}{2} f^{\prime \prime}(x) \Delta x^{2}
\end{gather*}$$</span><!-- Has MathJax --><br>å°†æŸå¤±å‡½æ•°ä½¿ç”¨<strong>ä¸€é˜¶æ³°å‹’å±•å¼€å…¬å¼</strong>(<span>$\Delta x$</span><!-- Has MathJax -->ç›¸å½“äºè¿™é‡Œçš„<span>$h_{m}\left(\overrightarrow{\mathbf{x}} ; \Theta_{m}\right))$</span><!-- Has MathJax -->ï¼š</p>
<span>$$\begin{gather*}
L\left(\tilde{y}, f_{m}(\overrightarrow{\mathrm{x}})\right)=L\left(\tilde{y}, f_{m-1}(\overrightarrow{\mathrm{x}})+h_{m}\left(\overrightarrow{\mathrm{x}} ; \Theta_{m}\right)\right)=L\left(\tilde{y}, f_{m-1}(\overrightarrow{\mathrm{x}})\right)+\frac{\partial L\left(\tilde{y}, f_{m-1}(\overrightarrow{\mathrm{x}})\right)}{\partial f_{m-1}(\overrightarrow{\mathrm{x}})} h_{m}\left(\overrightarrow{\mathrm{x}} ; \Theta_{m}\right)
\end{gather*}$$</span><!-- Has MathJax -->
<p>åˆ™æœ‰ï¼š</p>
<span>$$\begin{gather*}
\Delta L=L\left(\tilde{y}, f_{m}(\overrightarrow{\mathbf{x}})\right)-L\left(\tilde{y}, f_{m-1}(\overrightarrow{\mathbf{x}})\right)=\frac{\partial L\left(\tilde{y}, f_{m-1}(\overrightarrow{\mathbf{x}})\right)}{\partial f_{m-1}(\overrightarrow{\mathbf{x}})} h_{m}\left(\overrightarrow{\mathbf{x}} ; \Theta_{m}\right)
\end{gather*}$$</span><!-- Has MathJax -->
<p>è¦ä½¿å¾—æŸå¤±å‡½æ•°é™ä½ï¼Œåˆ™æ ¹æ®æ¢¯åº¦ä¸‹é™çš„æ€æƒ³è®©æŸå¤±å‡½æ•°å¯¹<span>$h_{m}\left(\overrightarrow{\mathbf{x}} ; \mathbf{\Theta}_{m}\right)$</span><!-- Has MathJax -->è¿›è¡Œæ±‚å¯¼ï¼ŒæŒ‰ç…§è´Ÿæ¢¯åº¦æ›´æ–°æ”¹å€¼ï¼Œåˆ™æŸå¤±å‡½æ•°æ˜¯ä¸‹é™çš„ï¼Œå³ï¼š</p>
<span>$h_{m}\left(\overrightarrow{\mathbf{x}} ; \Theta_{m}\right)=-\frac{\partial L\left(\tilde{y}, f_{m-1}(\overrightarrow{\mathbf{x}})\right)}{\partial f_{m-1}(\overrightarrow{\mathbf{x}})}$</span><!-- Has MathJax -->
<ul>
<li>å¯¹äºå¹³æ–¹æŸå¤±å‡½æ•°ï¼Œå®ƒå°±æ˜¯é€šå¸¸æ„ä¹‰çš„æ®‹å·®ã€‚</li>
<li>å¯¹äºä¸€èˆ¬æŸå¤±å‡½æ•°ï¼Œå®ƒå°±æ˜¯æ®‹å·®çš„è¿‘ä¼¼ã€‚</li>
</ul>
<p>è¿™é‡Œæˆ‘ä»¬ç›¸å½“äºè·å¾—äº†æ ·æœ¬çš„æ ‡ç­¾ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ç”¨è¿™ä¸ªæ ‡ç­¾æ¥è®­ç»ƒå†³ç­–æ ‘ã€‚</p>
<p>å¦å¤–ï¼Œæ¢¯åº¦æå‡æ ‘ç”¨äºåˆ†ç±»æ¨¡å‹æ—¶ï¼Œæ˜¯<strong>æ¢¯åº¦æå‡å†³ç­–æ ‘<code>GBDT</code></strong>ï¼›ç”¨äºå›å½’æ¨¡å‹æ—¶ï¼Œæ˜¯<strong>æ¢¯åº¦æå‡å›å½’æ ‘<code>GBRT</code>ï¼Œ</strong>äºŒè€…çš„åŒºåˆ«ä¸»è¦æ˜¯æŸå¤±å‡½æ•°ä¸åŒã€‚</p>
<p><strong>GBRT</strong>ç®—æ³•çš„ä¼ªä»£ç å¦‚ä¸‹ï¼š</p>
<p> <img src="/images/GBRT.png" alt=""></p>
<p>å¦å¤–ï¼ŒFreidmanä»baggingç­–ç•¥å—åˆ°å¯å‘ï¼Œé‡‡ç”¨<strong>éšæœºæ¢¯åº¦æå‡</strong>æ¥ä¿®æ”¹äº†åŸå§‹çš„æ¢¯åº¦æå‡ç®—æ³•ï¼Œå³æ¯ä¸€è½®è¿­ä»£ä¸­ï¼Œæ–°çš„å†³ç­–æ ‘æ‹Ÿåˆçš„æ˜¯åŸå§‹è®­ç»ƒé›†çš„ä¸€ä¸ªå­é›†ï¼ˆè€Œå¹¶ä¸æ˜¯åŸå§‹è®­ç»ƒé›†ï¼‰çš„æ®‹å·®ï¼Œè¿™ä¸ªå­é›†æ˜¯é€šè¿‡å¯¹åŸå§‹è®­ç»ƒé›†çš„æ— æ”¾å›éšæœºé‡‡æ ·è€Œæ¥ï¼Œç±»ä¼¼äºè‡ªåŠ©é‡‡æ ·æ³•ã€‚è¿™ç§æ–¹æ³•<strong>å¼•å…¥äº†éšæœºæ€§ï¼Œæœ‰åŠ©äºæ”¹å–„è¿‡æ‹Ÿåˆ</strong>ï¼Œå¦ä¸€ä¸ªå¥½å¤„æ˜¯<strong>æœªè¢«é‡‡æ ·çš„å¦ä¸€éƒ¨åˆ†å­—é›†å¯ä»¥ç”¨æ¥è®¡ç®—åŒ…å¤–ä¼°è®¡è¯¯å·®</strong>ã€‚</p>
<p>è¿™æ—¶æˆ‘ä»¬å†çœ‹ä¸€ä¸‹LambdaMARTç®—æ³•çš„æµç¨‹ï¼š</p>
<p><img src="/images/LambdaMART2.png" alt=""></p>
<p>å¯¹æ¯”GBRTå’ŒLambdaMARTç®—æ³•æµç¨‹å¯ä»¥å‘ç°ä¸¤è€…éå¸¸ç›¸ä¼¼ï¼Œä¸»è¦åŒºåˆ«æ˜¯LambdaMARTå°†GBRTä¸­è¦æ‹Ÿåˆçš„è´Ÿæ¢¯åº¦æ›¿æ¢ä¸ºLambdaæ¢¯åº¦ï¼Œè€ŒLambdaMARTå¯¹æ’åºçš„æœ€æ ¸å¿ƒçš„æ”¹è¿›æ­£æ˜¯è¿™ä¸ªLambdaæ¢¯åº¦ï¼Œå…·ä½“ä»‹ç»å¯ä»¥å‚è€ƒ<a href="[http://octopuscoder.github.io/2020/01/19/%E6%90%9C%E7%B4%A2%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/](http://octopuscoder.github.io/2020/01/19/æœç´¢æ’åºç®—æ³•/">æœç´¢æ’åºç®—æ³•</a>)ä¸­å…³äºRankNetå’ŒLambdaRankçš„ä»‹ç»ã€‚</p>
<h2 id="XBGoost"><a href="#XBGoost" class="headerlink" title="XBGoost"></a>XBGoost</h2><p>è¿™é‡Œæ—¢ç„¶æåˆ°äº†æå‡æ ‘å’Œæ¢¯åº¦æå‡æ ‘ï¼Œé‚£ä¹ˆé¡ºä¾¿ä¹Ÿä»‹ç»ä¸€ä¸‹å¤§åé¼é¼çš„XGBoostï¼Œè¿™éƒ¨åˆ†ä»‹ç»å®Œåæˆ‘ä»¬å†æ¢LambdaMARTçš„ä¸€äº›ç»†èŠ‚ã€‚</p>
<p><strong>Xgboost</strong>ä¹Ÿä½¿ç”¨ä¸æå‡æ ‘ç›¸åŒçš„<strong>å‰å‘åˆ†æ­¥ç®—æ³•ï¼Œ</strong>å…¶åŒºåˆ«åœ¨äºï¼šXgboosté€šè¿‡<strong>ç»“æ„é£é™©æœ€å°åŒ–</strong>æ¥ç¡®å®šä¸‹ä¸€ä¸ªå†³ç­–æ ‘çš„å‚æ•°$$\Theta_{m}$$ï¼š</p>
<span>$\hat{\Theta}_{m}=\arg \min _{\Theta_{m}} \sum_{i=1}^{N} L\left(\tilde{y}_{i}, f_{m}\left(\overrightarrow{\mathbf{x}}_{i}\right)\right)+\Omega\left(h_{m}(\overrightarrow{\mathbf{x}})\right)$</span><!-- Has MathJax -->
<p>å…¶ä¸­ï¼š</p>
<ul>
<li><span>$\Omega\left(h_{m}\right)$</span><!-- Has MathJax -->ä¸ºç¬¬mä¸ªå†³ç­–æ ‘çš„æ­£åˆ™åŒ–é¡¹ï¼Œè¿™æ˜¯XGBoostå’ŒGBTçš„ä¸€ä¸ªé‡è¦åŒºåˆ«ã€‚</li>
<li><span>$\mathcal{L}=\sum_{i=1}^{N} L\left(\tilde{y}_{i}, f_{m}\left(\overrightarrow{\mathbf{x}}_{i}\right)\right)+\Omega\left(h_{m}(\overrightarrow{\mathbf{x}})\right)$</span><!-- Has MathJax -->ä¸ºç›®æ ‡å‡½æ•°ã€‚</li>
</ul>
<p>ä¸æå‡æ ‘ä¸åŒçš„æ˜¯<strong>ï¼ŒXgboost</strong>è¿˜ä½¿ç”¨äº†<strong>äºŒé˜¶æ³°å‹’å±•å¼€</strong>ï¼Œå®šä¹‰ï¼š</p>
<span>$\hat{y}_{i}^{&lt;m-1&gt;}=f_{m-1}\left(\overrightarrow{\mathbf{x}}_{i}\right), \quad g_{i}=\frac{\partial L\left(\tilde{y}_{i}, \hat{y}_{i}^{&lt;m-1&gt;}\right)}{\partial \hat{y}_{i}^{&lt;m-1&gt;}}, \quad h_{i}=\frac{\partial^{2} L\left(\tilde{y}_{i}, \hat{y}_{i}^{&lt;m-1&gt;}\right)}{\partial^{2} \hat{y}_{i}^{&lt;m-1&gt;}}$</span><!-- Has MathJax -->
<p>å…¶ä¸­ï¼Œ<span>$g_{i}, h_{i}$</span><!-- Has MathJax -->åˆ†åˆ«æ˜¯æŸå¤±å‡½æ•°<span>$L\left(\tilde{y}_{i}, \hat{y}_{i}^{&lt;m-1&gt;}\right)$</span><!-- Has MathJax -->å¯¹<span>$\hat{y}_{i}^{&lt;m-1&gt;}$</span><!-- Has MathJax -->çš„ä¸€é˜¶å¯¼æ•°å’ŒäºŒé˜¶å¯¼æ•°ã€‚å†çœ‹<strong>æ³°å‹’å±•å¼€å¼</strong>ï¼š</p>
<p>Taylor expansion <span>$f(x+\Delta x) \simeq f(x)+f^{\prime}(x) \Delta x+\frac{1}{2} f^{\prime \prime}(x) \Delta x^{2}$</span><!-- Has MathJax --></p>
<p>å› æ­¤æˆ‘ä»¬å¯¹æŸå¤±å‡½æ•°äºŒé˜¶æ³°å‹’å±•å¼€æœ‰ï¼ˆ<span>$\Delta x$</span><!-- Has MathJax -->ç›¸å½“äºè¿™é‡Œçš„<span>$h_{m}(\overrightarrow{\mathbf{x}})$</span><!-- Has MathJax -->ï¼‰</p>
<span>$$\begin{gather*}
\begin{aligned} \mathcal{L} &amp;=\sum_{i=1}^{N} L\left(\tilde{y}_{i}, f_{m}\left(\overrightarrow{\mathbf{x}}_{i}\right)\right)+\Omega\left(h_{m}(\overrightarrow{\mathbf{x}})\right)=\sum_{i=1}^{N} L\left(\tilde{y}_{i}, \hat{y}_{i}^{&lt;m-1&gt;}+h_{m}\left(\overrightarrow{\mathbf{x}}_{i}\right)\right)+\Omega\left(h_{m}(\overrightarrow{\mathbf{x}})\right) \\ &amp; \simeq \sum_{i=1}^{N}\left[L\left(\tilde{y}_{i}, \hat{y}_{i}^{&lt;m-1&gt;}\right)+g_{i} h_{m}\left(\overrightarrow{\mathbf{x}}_{i}\right)+\frac{1}{2} h_{i} h_{m}^{2}\left(\overrightarrow{\mathbf{x}}_{i}\right)\right]+\Omega\left(h_{m}(\overrightarrow{\mathbf{x}})\right)+\text { constant } \end{aligned}
\end{gather*}$$</span><!-- Has MathJax -->
<p><strong>æå‡æ ‘(GBT)</strong>åªä½¿ç”¨äº†ä¸€é˜¶æ³°å‹’å±•å¼€ã€‚è€ŒXGBoostçš„æ­£åˆ™åŒ–é¡¹ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š</p>
<span>$\Omega\left(h_{m}(\overrightarrow{\mathbf{x}})\right)=\gamma T+\frac{1}{2} \lambda \sum_{j=1}^{T} w_{j}^{2}$</span><!-- Has MathJax -->
<p>è¯¥éƒ¨åˆ†è¡¨ç¤º<strong>å†³ç­–æ ‘çš„å¤æ‚åº¦ï¼Œ</strong>å…¶ä¸­Tä¸ºå¶èŠ‚ç‚¹çš„ä¸ªæ•°ï¼Œ$w_{j}$ä¸ºæ¯ä¸ªå¶èŠ‚ç‚¹çš„è¾“å‡ºå€¼ï¼Œ$\gamma, \lambda \geq 0$ä¸ºç³»æ•°ï¼Œæ§åˆ¶è¿™ä¸¤ä¸ªéƒ¨åˆ†çš„æ¯”é‡ã€‚</p>
<ul>
<li>å¶ç»“ç‚¹è¶Šå¤šï¼Œåˆ™å†³ç­–æ ‘è¶Šå¤æ‚ã€‚</li>
<li>æ¯ä¸ªå¶ç»“ç‚¹è¾“å‡ºå€¼çš„ç»å¯¹å€¼è¶Šå¤§ï¼Œåˆ™å†³ç­–æ ‘è¶Šå¤æ‚ã€‚</li>
</ul>
<blockquote>
<p>è¯¥å¤æ‚åº¦æ˜¯ä¸€ä¸ªç»éªŒå…¬å¼ã€‚äº‹å®ä¸Šè¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„å®šä¹‰å¤æ‚åº¦çš„æ–¹å¼ï¼Œåªæ˜¯è¿™ä¸ªå…¬å¼æ•ˆæœè¿˜ä¸é”™ã€‚</p>
</blockquote>
<p><strong>Xgboost</strong>ç›¸æ¯”ä¸<strong>GBDT</strong>ï¼š</p>
<ol>
<li><p>ä¼ ç»ŸGBDTåœ¨ä¼˜åŒ–æ—¶åªç”¨åˆ°ä¸€é˜¶å¯¼æ•°ä¿¡æ¯ï¼Œxgbooståˆ™å¯¹ä»£ä»·å‡½æ•°è¿›è¡Œäº†<strong>äºŒé˜¶æ³°å‹’å±•å¼€ï¼ŒåŒæ—¶ç”¨åˆ°äº†ä¸€é˜¶å’ŒäºŒé˜¶å¯¼æ•°</strong>ã€‚é¡ºä¾¿æä¸€ä¸‹ï¼Œxgboostå·¥å…·æ”¯æŒè‡ªå®šä¹‰ä»£ä»·å‡½æ•°ï¼Œåªè¦å‡½æ•°å¯ä¸€é˜¶å’ŒäºŒé˜¶æ±‚å¯¼ã€‚ä¾‹å¦‚ï¼Œxgboostæ”¯æŒçº¿æ€§åˆ†ç±»å™¨ï¼Œè¿™ä¸ªæ—¶å€™xgboostç›¸å½“äºå¸¦L1å’ŒL2æ­£åˆ™åŒ–é¡¹çš„é€»è¾‘æ–¯è’‚å›å½’ï¼ˆåˆ†ç±»é—®é¢˜ï¼‰æˆ–è€…çº¿æ€§å›å½’ï¼ˆå›å½’é—®é¢˜ï¼‰</p>
</li>
<li><p>xgbooståœ¨<strong>ä»£ä»·å‡½æ•°é‡ŒåŠ å…¥äº†æ­£åˆ™é¡¹ï¼Œç”¨äºæ§åˆ¶æ¨¡å‹çš„å¤æ‚åº¦</strong>ã€‚æ­£åˆ™é¡¹é‡ŒåŒ…å«äº†æ ‘çš„å¶å­èŠ‚ç‚¹ä¸ªæ•°ã€æ¯ä¸ªå¶å­èŠ‚ç‚¹ä¸Šè¾“å‡ºçš„scoreçš„L2æ¨¡çš„å¹³æ–¹å’Œã€‚ä»Bias-variance tradeoffè§’åº¦æ¥è®²ï¼Œæ­£åˆ™é¡¹é™ä½äº†æ¨¡å‹çš„varianceï¼Œä½¿å­¦ä¹ å‡ºæ¥çš„æ¨¡å‹æ›´åŠ ç®€å•ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆï¼Œè¿™ä¹Ÿæ˜¯xgboostä¼˜äºä¼ ç»ŸGBDTçš„ä¸€ä¸ªç‰¹æ€§ã€‚</p>
</li>
<li><p><strong>åˆ—æŠ½æ ·ï¼ˆcolumn subsamplingï¼‰</strong>ã€‚xgboostå€Ÿé‰´äº†éšæœºæ£®æ—çš„åšæ³•ï¼Œæ”¯æŒåˆ—æŠ½æ ·ï¼ˆå³æ¯æ¬¡çš„è¾“å…¥ç‰¹å¾ä¸æ˜¯å…¨éƒ¨ç‰¹å¾ï¼‰ï¼Œä¸ä»…èƒ½é™ä½è¿‡æ‹Ÿåˆï¼Œè¿˜èƒ½å‡å°‘è®¡ç®—ï¼Œè¿™ä¹Ÿæ˜¯xgboostå¼‚äºä¼ ç»Ÿgbdtçš„ä¸€ä¸ªç‰¹æ€§ã€‚</p>
</li>
<li><p><strong>å¹¶è¡ŒåŒ–å¤„ç†</strong>ï¼šåœ¨è®­ç»ƒä¹‹å‰ï¼Œé¢„å…ˆå¯¹æ¯ä¸ªç‰¹å¾å†…éƒ¨è¿›è¡Œäº†æ’åºæ‰¾å‡ºå€™é€‰åˆ‡å‰²ç‚¹ï¼Œç„¶åä¿å­˜ä¸ºblockç»“æ„ï¼Œåé¢çš„è¿­ä»£ä¸­é‡å¤åœ°ä½¿ç”¨è¿™ä¸ªç»“æ„ï¼Œå¤§å¤§å‡å°è®¡ç®—é‡ã€‚åœ¨è¿›è¡ŒèŠ‚ç‚¹çš„åˆ†è£‚æ—¶ï¼Œéœ€è¦è®¡ç®—æ¯ä¸ªç‰¹å¾çš„å¢ç›Šï¼Œæœ€ç»ˆé€‰å¢ç›Šæœ€å¤§çš„é‚£ä¸ªç‰¹å¾å»åšåˆ†è£‚ï¼Œé‚£ä¹ˆå„ä¸ªç‰¹å¾çš„å¢ç›Šè®¡ç®—å°±å¯ä»¥å¼€å¤šçº¿ç¨‹è¿›è¡Œï¼Œå³åœ¨ä¸åŒçš„ç‰¹å¾å±æ€§ä¸Šé‡‡ç”¨å¤šçº¿ç¨‹å¹¶è¡Œæ–¹å¼å¯»æ‰¾æœ€ä½³åˆ†å‰²ç‚¹ã€‚</p>
</li>
</ol>
<p><strong>ç›¸æ¯”äºGBDTï¼ŒXgboostæœ€é‡è¦çš„ä¼˜ç‚¹è¿˜æ˜¯ç”¨åˆ°äº†äºŒé˜¶æ³°å‹’å±•å¼€ä¿¡æ¯å’ŒåŠ å…¥æ­£åˆ™é¡¹</strong> ã€‚</p>
<h2 id="LambdaMART"><a href="#LambdaMART" class="headerlink" title="LambdaMART"></a>LambdaMART</h2><p>LambdaMARTç®—æ³•çš„æµç¨‹ï¼š</p>
<p><img src="/images/LambdaMART2.png" alt=""></p>
<p>å¶å­ç»“ç‚¹è¾“å‡ºå€¼çš„è®¡ç®—é‡‡ç”¨ç‰›é¡¿è¿­ä»£æ³•ï¼Œå¯¹äºä¸€ä¸ªå‡½æ•°<span>$g(\gamma)$</span><!-- Has MathJax -->ï¼Œä¸ºäº†æ‰¾åˆ°$\gamma$ä½¿å¾—å‡½æ•°$g$å–å¾—æå°ï¼ˆå¤§ï¼‰å€¼é‡‡ç”¨ç‰›é¡¿è¿­ä»£æ³•çš„è¿­ä»£æ­¥éª¤ä¸ºï¼š</p>
<span>$\gamma_{n+1}=\gamma_{n}-\frac{g^{\prime}\left(\gamma_{n}\right)}{g^{\prime \prime}\left(\gamma_{n}\right)}$</span><!-- Has MathJax -->
<p>ç›¸åº”åœ°ï¼ŒLambdaMARTç¬¬mæ£µæ ‘ä¸­ç¬¬kä¸ªå¶å­ç»“ç‚¹çš„è¾“å‡ºå€¼è®¡ç®—å…¬å¼ä¸ºï¼š</p>
<span>$\gamma_{k m}=\frac{\sum_{x_{i} \in R_{k m}} \frac{\partial C}{\partial s_{i}}}{\sum_{x_{i} \in R_{k m}} \frac{\partial^{2} C}{\partial s_{i}^{2}}}=\frac{-\sum_{x_{i} \in R_{k m}} \sum_{\{i, j\} \rightleftharpoons I}\left|\Delta Z_{i j}\right| \rho_{i j}}{\sum_{x_{i} \in R_{k m}} \sum_{\{i, j\} \rightleftharpoons I}\left|\Delta Z_{i j}\right| \sigma \rho_{i j}\left(1-\rho_{i j}\right)}$</span><!-- Has MathJax -->
<p>å…·ä½“åŸç†å¯ä»¥å‚è€ƒ<a href="https://www.microsoft.com/en-us/research/wp-content/uploads/2016/02/MSR-TR-2010-82.pdf" target="_blank" rel="external">From RankNet to LambdaRank to LambdaMART: An Overview</a></p>
<p>ä¸‹é¢æˆ‘ä»¬åŸºäºRanklibæºç å’Œä¸€ä¸ªå…·ä½“çš„ä¾‹å­æ¥è¿›ä¸€æ­¥ç†è§£LambdaMARTç®—æ³•çš„è¿‡ç¨‹ã€‚Ranklibæ˜¯Learning to Ranké¢†åŸŸçš„ä¸€ä¸ªä¼˜ç§€çš„å¼€æºç®—æ³•åº“ï¼Œå®ç°äº†MART,RankNet,RankBoost,LambdaMart,Random Forestç­‰æ¨¡å‹ï¼Œä»£ç ä¸ºJavaã€‚æˆ‘ä»¬è¿™é‡ŒåŸºäºå¾®è½¯å‘å¸ƒçš„LambdaMARTæ¥è¿›è¡Œä»‹ç»ï¼ŒLambdaMART.javaä¸­çš„LambdaMART.learn()æ˜¯å­¦ä¹ æµç¨‹çš„ç®¡æ§å‡½æ•°ï¼Œå­¦ä¹ è¿‡ç¨‹ä¸»è¦æœ‰ä¸‹é¢å››æ­¥æ„æˆï¼š</p>
<ol>
<li><p>è®¡ç®—deltaNDCGä»¥åŠlambda;</p>
</li>
<li><p>ä»¥lambdaä½œä¸ºlabelè®­ç»ƒä¸€æ£µregression tree;</p>
</li>
<li><p>åœ¨treeçš„æ¯ä¸ªå¶å­èŠ‚ç‚¹é€šè¿‡é¢„æµ‹çš„regression lambdaå€¼è¿˜åŸå‡ºgammaï¼Œå³æœ€ç»ˆè¾“å‡ºå¾—åˆ†ï¼›</p>
</li>
<li><p>ç”¨3çš„æ¨¡å‹é¢„æµ‹æ‰€æœ‰è®­ç»ƒé›†åˆä¸Šçš„å¾—åˆ†ï¼ˆ+learningRate*gammaï¼‰,ç„¶åç”¨è¿™ä¸ªå¾—åˆ†å¯¹æ¯ä¸ªqueryçš„ç»“æœæ’åºï¼Œè®¡ç®—æ–°çš„æ¯ä¸ªqueryçš„base ndcgï¼Œä»¥æ­¤ä¸ºåŸºç¡€å›åˆ°ç¬¬1æ­¥ï¼Œç»„æˆæ£®æ—ã€‚</p>
</li>
</ol>
<p>é‡å¤è¿™ä¸ªæ­¥éª¤ï¼Œç›´åˆ°æ»¡è¶³ä¸‹åˆ—ä¸¤ä¸ªæ”¶æ•›æ¡ä»¶ä¹‹ä¸€ï¼š</p>
<ol>
<li><p>æ ‘çš„ä¸ªæ•°è¾¾åˆ°è®­ç»ƒå‚æ•°è®¾ç½®ï¼›</p>
</li>
<li><p>Random Foreståœ¨validationé›†åˆä¸Šæ²¡æœ‰å˜å¥½ã€‚</p>
</li>
</ol>
<p>ä¸‹é¢ç”¨ä¸€ç»„å®é™…çš„æ•°æ®æ¥è¯´æ˜æ•´ä¸ªè®¡ç®—è¿‡ç¨‹ï¼Œå‡è®¾æˆ‘ä»¬æœ‰10ä¸ªqueryçš„è®­ç»ƒæ•°æ®ï¼Œæ¯ä¸ªqueryä¸‹æœ‰10ä¸ªdocï¼Œæ¯ä¸ªquery-docå¯¹æœ‰10ä¸ªfeatureï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="number">0</span> qid:<span class="number">1830</span> <span class="number">1</span>:<span class="number">0.002736</span> <span class="number">2</span>:<span class="number">0.000000</span> <span class="number">3</span>:<span class="number">0.000000</span> <span class="number">4</span>:<span class="number">0.000000</span> <span class="number">5</span>:<span class="number">0.002736</span> <span class="number">6</span>:<span class="number">0.000000</span> <span class="number">7</span>:<span class="number">0.000000</span> <span class="number">8</span>:<span class="number">0.000000</span> <span class="number">9</span>:<span class="number">0.000000</span> <span class="number">10</span>:<span class="number">0.000000</span></div><div class="line"><span class="number">0</span> qid:<span class="number">1830</span> <span class="number">1</span>:<span class="number">0.025992</span> <span class="number">2</span>:<span class="number">0.125000</span> <span class="number">3</span>:<span class="number">0.000000</span> <span class="number">4</span>:<span class="number">0.000000</span> <span class="number">5</span>:<span class="number">0.027360</span> <span class="number">6</span>:<span class="number">0.000000</span> <span class="number">7</span>:<span class="number">0.000000</span> <span class="number">8</span>:<span class="number">0.000000</span> <span class="number">9</span>:<span class="number">0.000000</span> <span class="number">10</span>:<span class="number">0.000000</span></div><div class="line"><span class="number">0</span> qid:<span class="number">1830</span> <span class="number">1</span>:<span class="number">0.001368</span> <span class="number">2</span>:<span class="number">0.000000</span> <span class="number">3</span>:<span class="number">0.000000</span> <span class="number">4</span>:<span class="number">0.000000</span> <span class="number">5</span>:<span class="number">0.001368</span> <span class="number">6</span>:<span class="number">0.000000</span> <span class="number">7</span>:<span class="number">0.000000</span> <span class="number">8</span>:<span class="number">0.000000</span> <span class="number">9</span>:<span class="number">0.000000</span> <span class="number">10</span>:<span class="number">0.000000</span></div><div class="line"><span class="number">1</span> qid:<span class="number">1830</span> <span class="number">1</span>:<span class="number">0.188782</span> <span class="number">2</span>:<span class="number">0.375000</span> <span class="number">3</span>:<span class="number">0.333333</span> <span class="number">4</span>:<span class="number">1.000000</span> <span class="number">5</span>:<span class="number">0.195622</span> <span class="number">6</span>:<span class="number">0.000000</span> <span class="number">7</span>:<span class="number">0.000000</span> <span class="number">8</span>:<span class="number">0.000000</span> <span class="number">9</span>:<span class="number">0.000000</span> <span class="number">10</span>:<span class="number">0.000000</span></div><div class="line"><span class="number">1</span> qid:<span class="number">1830</span> <span class="number">1</span>:<span class="number">0.077975</span> <span class="number">2</span>:<span class="number">0.500000</span> <span class="number">3</span>:<span class="number">0.666667</span> <span class="number">4</span>:<span class="number">0.000000</span> <span class="number">5</span>:<span class="number">0.086183</span> <span class="number">6</span>:<span class="number">0.000000</span> <span class="number">7</span>:<span class="number">0.000000</span> <span class="number">8</span>:<span class="number">0.000000</span> <span class="number">9</span>:<span class="number">0.000000</span> <span class="number">10</span>:<span class="number">0.000000</span></div><div class="line"><span class="number">0</span> qid:<span class="number">1830</span> <span class="number">1</span>:<span class="number">0.075239</span> <span class="number">2</span>:<span class="number">0.125000</span> <span class="number">3</span>:<span class="number">0.333333</span> <span class="number">4</span>:<span class="number">0.000000</span> <span class="number">5</span>:<span class="number">0.077975</span> <span class="number">6</span>:<span class="number">0.000000</span> <span class="number">7</span>:<span class="number">0.000000</span> <span class="number">8</span>:<span class="number">0.000000</span> <span class="number">9</span>:<span class="number">0.000000</span> <span class="number">10</span>:<span class="number">0.000000</span></div><div class="line"><span class="number">1</span> qid:<span class="number">1830</span> <span class="number">1</span>:<span class="number">0.079343</span> <span class="number">2</span>:<span class="number">0.250000</span> <span class="number">3</span>:<span class="number">0.666667</span> <span class="number">4</span>:<span class="number">0.000000</span> <span class="number">5</span>:<span class="number">0.084815</span> <span class="number">6</span>:<span class="number">0.000000</span> <span class="number">7</span>:<span class="number">0.000000</span> <span class="number">8</span>:<span class="number">0.000000</span> <span class="number">9</span>:<span class="number">0.000000</span> <span class="number">10</span>:<span class="number">0.000000</span></div><div class="line"><span class="number">1</span> qid:<span class="number">1830</span> <span class="number">1</span>:<span class="number">0.147743</span> <span class="number">2</span>:<span class="number">0.000000</span> <span class="number">3</span>:<span class="number">0.000000</span> <span class="number">4</span>:<span class="number">0.000000</span> <span class="number">5</span>:<span class="number">0.147743</span> <span class="number">6</span>:<span class="number">0.000000</span> <span class="number">7</span>:<span class="number">0.000000</span> <span class="number">8</span>:<span class="number">0.000000</span> <span class="number">9</span>:<span class="number">0.000000</span> <span class="number">10</span>:<span class="number">0.000000</span></div><div class="line"><span class="number">0</span> qid:<span class="number">1830</span> <span class="number">1</span>:<span class="number">0.058824</span> <span class="number">2</span>:<span class="number">0.000000</span> <span class="number">3</span>:<span class="number">0.000000</span> <span class="number">4</span>:<span class="number">0.000000</span> <span class="number">5</span>:<span class="number">0.058824</span> <span class="number">6</span>:<span class="number">0.000000</span> <span class="number">7</span>:<span class="number">0.000000</span> <span class="number">8</span>:<span class="number">0.000000</span> <span class="number">9</span>:<span class="number">0.000000</span> <span class="number">10</span>:<span class="number">0.000000</span></div><div class="line"><span class="number">0</span> qid:<span class="number">1830</span> <span class="number">1</span>:<span class="number">0.071135</span> <span class="number">2</span>:<span class="number">0.125000</span> <span class="number">3</span>:<span class="number">0.333333</span> <span class="number">4</span>:<span class="number">0.000000</span> <span class="number">5</span>:<span class="number">0.073871</span> <span class="number">6</span>:<span class="number">0.000000</span> <span class="number">7</span>:<span class="number">0.000000</span> <span class="number">8</span>:<span class="number">0.000000</span> <span class="number">9</span>:<span class="number">0.000000</span> <span class="number">10</span>:<span class="number">0.000000</span></div><div class="line"><span class="number">1</span> qid:<span class="number">1840</span> <span class="number">1</span>:<span class="number">0.007364</span> <span class="number">2</span>:<span class="number">0.200000</span> <span class="number">3</span>:<span class="number">1.000000</span> <span class="number">4</span>:<span class="number">0.500000</span> <span class="number">5</span>:<span class="number">0.013158</span> <span class="number">6</span>:<span class="number">0.000000</span> <span class="number">7</span>:<span class="number">0.000000</span> <span class="number">8</span>:<span class="number">0.000000</span> <span class="number">9</span>:<span class="number">0.000000</span> <span class="number">10</span>:<span class="number">0.000000</span></div><div class="line"><span class="number">1</span> qid:<span class="number">1840</span> <span class="number">1</span>:<span class="number">0.097202</span> <span class="number">2</span>:<span class="number">0.000000</span> <span class="number">3</span>:<span class="number">0.000000</span> <span class="number">4</span>:<span class="number">0.000000</span> <span class="number">5</span>:<span class="number">0.096491</span> <span class="number">6</span>:<span class="number">0.000000</span> <span class="number">7</span>:<span class="number">0.000000</span> <span class="number">8</span>:<span class="number">0.000000</span> <span class="number">9</span>:<span class="number">0.000000</span> <span class="number">10</span>:<span class="number">0.000000</span></div><div class="line"><span class="number">2</span> qid:<span class="number">1840</span> <span class="number">1</span>:<span class="number">0.169367</span> <span class="number">2</span>:<span class="number">0.000000</span> <span class="number">3</span>:<span class="number">0.500000</span> <span class="number">4</span>:<span class="number">0.000000</span> <span class="number">5</span>:<span class="number">0.169591</span> <span class="number">6</span>:<span class="number">0.000000</span> <span class="number">7</span>:<span class="number">0.000000</span> <span class="number">8</span>:<span class="number">0.000000</span> <span class="number">9</span>:<span class="number">0.000000</span> <span class="number">10</span>:<span class="number">0.000000</span></div><div class="line">......</div></pre></td></tr></table></figure>
<p>ä¸ºäº†ç®€ä¾¿ï¼Œçœç•¥äº†ä½™ä¸‹çš„æ•°æ®ã€‚ä¸Šé¢çš„æ•°æ®æ ¼å¼æ˜¯æŒ‰ç…§Ranklib readmeä¸­è¦æ±‚çš„æ ¼å¼ç»„ç»‡ï¼Œé™¤äº†è¡Œå·ä¹‹å¤–ï¼Œç¬¬ä¸€åˆ—æ˜¯query-docå¯¹çš„å®é™…labelï¼ˆäººå·¥æ ‡æ³¨æ•°æ®ï¼‰ï¼Œç¬¬äºŒåˆ—æ˜¯qidï¼Œåé¢10åˆ—éƒ½æ˜¯featureã€‚</p>
<p>è¿™ä»½æ•°æ®æ¯ç»„qidä¸­çš„docåˆå§‹é¡ºåºå¯ä»¥æ˜¯éšæœºçš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ä»å®é™…çš„ç³»ç»Ÿä¸­è·å¾—çš„é¡ºåºï¼Œæ€»ä¹‹è¿™ä¸ªæ˜¯è®¡ç®—ndcgçš„åˆå§‹çŠ¶æ€ã€‚å¯¹äºqid=1830ï¼Œå®ƒçš„10ä¸ªdocçš„åˆå§‹é¡ºåºçš„labelåºåˆ—æ˜¯ï¼š0, 0, 0, 1, 1, 0, 1, 1, 0, 0(å®é™…ä¸­labelå¯ä»¥æ‰©å±•ä¸º1ï¼Œ2ï¼Œ3ï¼Œ4ç­‰ï¼Œæ ¹æ®æ•°æ®è‡ªè¡Œå†³å®š)ã€‚dcgçš„è®¡ç®—å…¬å¼ä¸ºï¼š</p>
<span>$d c g(i)=\frac{2^{l a b e l(i)}-1}{\log _{2}(i+1)}$</span><!-- Has MathJax -->
<p>iè¡¨ç¤ºå½“å‰docåœ¨è¿™ä¸ªqidä¸‹çš„ä½ç½®ï¼ˆä»1å¼€å§‹ï¼Œé¿å…åˆ†æ¯ä¸º0ï¼‰ï¼Œlabel(i)æ˜¯doc(i)çš„æ ‡æ³¨å€¼ã€‚è€Œä¸€ä¸ªqueryçš„dcgåˆ™æ˜¯å…¶ä¸‹æ‰€æœ‰docçš„åŠ å’Œï¼š</p>
<span>$d c g(q u e r y)=\sum_{i} \frac{2^{l a b e l(i)}-1}{\log _{2}(i+1)}$</span><!-- Has MathJax -->
<p>æ ¹æ®ä¸Šå¼å¯ä»¥è®¡ç®—åˆå§‹çŠ¶æ€ä¸‹æ¯ä¸ªqidçš„dcgï¼š</p>
<span>$\begin{aligned} d c g(q i d=1830) &amp;=\frac{2^{0}-1}{\log _{2}(1+1)}+\frac{2^{0}-1}{\log _{2}(2+1)}+\ldots+\frac{2^{0}-1}{\log _{2}(10+1)} \\ &amp;=0+0+0+0.431+0.387+0+0.333+0.315+0 \\ &amp;+0=1.466 \end{aligned}$</span><!-- Has MathJax -->
<p>è¦è®¡ç®—ndcgï¼Œè¿˜éœ€è¦è®¡ç®—ç†æƒ³é›†çš„dcgï¼Œå°†åˆå§‹çŠ¶æ€æŒ‰ç…§labelæ’åºï¼Œqid=1830å¾—åˆ°çš„åºåˆ—æ˜¯1,1,1,1,0,0,0,0,0,0ï¼Œè®¡ç®—dcg:</p>
<span>$$\begin{gather*}
ideal_dcg(qid =1830) $=\frac{2^{1}-1}{\log _{2}(1+1)}+\frac{2^{1}-1}{\log _{2}(2+1)}+\ldots$
$\begin{aligned}+\frac{2^{0}-1}{\log _{2}(10+1)} &amp; \\ &amp;=1+0.631+0.5+0.431+0+0+0+0+0+0 \\ &amp;=2.562 \end{aligned}$
\end{gather*}$$</span><!-- Has MathJax -->
<p>ä¸¤è€…ç›¸é™¤å¾—åˆ°åˆå§‹çŠ¶æ€ä¸‹qid=1830çš„ndcg:</p>
<span>$n d c g(q i d=1830)=\frac{d c g(q i d=1830)}{i d e a l_{-} n d c g(q i d=1830)}=\frac{1.466}{2.562}=0.572$</span><!-- Has MathJax -->
<p>ä¸‹é¢è¦è®¡ç®—æ¯ä¸€ä¸ªdocçš„deltaNDCGï¼Œå…¬å¼å¦‚ä¸‹ï¼š</p>
<span>$$\begin{gather*}
\begin{array}{c}
\operatorname{deltaNDCG}(i, j) \\
=| \text {ndcg(original sequence) }-n d \operatorname{cs}(\operatorname{swap}(i, j) \text { sequence }) |
\end{array}
\end{gather*}$$</span><!-- Has MathJax -->
<p>deltaNDCG(i,j)æ˜¯å°†ä½ç½®iå’Œä½ç½®jçš„ä½ç½®äº’æ¢åäº§ç”Ÿçš„ndcgå˜åŒ–ï¼ˆå…¶ä»–ä½ç½®å‡ä¸å˜ï¼‰ï¼Œæ˜¾ç„¶æœ‰ç›¸åŒlabelçš„deltaNDCG(i,j)=0ã€‚åœ¨qid=1830çš„åˆå§‹åºåˆ—0, 0, 0, 1, 1, 0, 1, 1, 0, 0ï¼Œç”±äºå‰3çš„labeléƒ½ä¸€æ ·ï¼Œæ‰€ä»¥deltaNDCG(1,2)=deltaNDCG(1,3)=0ï¼Œä¸ä¸º0çš„æ˜¯deltaNDCG(1,4), deltaNDCG(1,5), deltaNDCG(1,7), deltaNDCG(1,8)ã€‚å°†1ï¼Œ4ä½ç½®äº’æ¢ï¼Œåºåˆ—å˜ä¸º1, 0, 0, 0, 1, 0, 1, 1, 0, 0ï¼Œè®¡ç®—å¾—åˆ°dcg=2.036ï¼Œæ•´ä¸ªdeltaNDCG(1,4)çš„è®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<span>$$\begin{gather*}
\begin{array}{l}
\qquad \begin{array}{l}
d \operatorname{cg}(q i d=1830, \operatorname{swap}(1,4))=\frac{2^{1}-1}{\log _{2}(1+1)}+\frac{2^{0}-1}{\log _{2}(2+1)}+\ldots \\
+\frac{2^{0}-1}{\log _{2}(10+1)}
\end{array} \\
=1+0+0+0+0.387+0+0.333+0.315+0+0 \\
=2.036
\end{array}
\end{gather*}$$</span><!-- Has MathJax -->
<span>$$\begin{gather*}
\begin{array}{l}
n d c g(\sin a p(1,4))=\frac{d c g(\sin a p(1,4))}{i d e a l_{-} d c g}=\frac{2.036}{2.562}=0.795 \\
\text {deltaNDCG}(1,4)=\operatorname{detal} N D C G(4,1) \\
=| \text {ndcg}(\text {original sequence})-\text {ndcg}(\operatorname{swap}(1,4)) | \\
=|0.572-0.795|=0.222
\end{array}
\end{gather*}$$</span><!-- Has MathJax -->
<p>åŒæ ·è¿‡ç¨‹å¯ä»¥è®¡ç®—å‡ºdeltaNDCG(1,5)=0.239, deltaNDCG(1,7)=0.260, deltaNDCG(1,8)=0.267ç­‰ã€‚</p>
<p>è¿›ä¸€æ­¥ï¼Œè¦è®¡ç®—lambda(i)ï¼Œæ ¹æ®paperï¼Œè¿˜éœ€è¦Ïå€¼ï¼ŒÏå¯ä»¥ç†è§£ä¸ºdociæ¯”docjå·®çš„æ¦‚ç‡ï¼Œå…¶è®¡ç®—å…¬å¼ä¸ºï¼š</p>
<span>$\rho_{i j}=\frac{1}{1+e^{\sigma\left(s_{i}-s_{j}\right)}}$</span><!-- Has MathJax -->
<p>å‚è€ƒ<a href="[http://octopuscoder.github.io/2020/01/19/%E6%90%9C%E7%B4%A2%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/](http://octopuscoder.github.io/2020/01/19/æœç´¢æ’åºç®—æ³•/">æœç´¢æ’åºç®—æ³•</a>)ä¸­å…³äºLambdaRankçš„ä»‹ç»ï¼š</p>
<span>$\lambda_{i j}=\frac{\partial C\left(s_{i}-s_{j}\right)}{\partial s_{i}}=\frac{-\sigma}{1+e^{\sigma\left(s_{i}-s_{j}\right)}}\left|\Delta_{N D C G}\right|$</span><!-- Has MathJax -->
<p>Ranklibä¸­ç›´æ¥å–Ïƒ=1ï¼Œå¦‚ä¸‹å›¾ï¼Œè“ï¼Œçº¢ï¼Œç»¿ä¸‰ç§é¢œè‰²åˆ†åˆ«å¯¹åº”Ïƒ=1ï¼Œ2ï¼Œ4æ—¶Ïå‡½æ•°çš„æ›²çº¿æƒ…å½¢ï¼ˆæ¨ªåæ ‡æ˜¯$s_i-s_j$ï¼‰:</p>
<p>åˆå§‹æ—¶ï¼Œæ¨¡å‹ä¸ºç©ºï¼Œæ‰€æœ‰æ¨¡å‹é¢„æµ‹å¾—åˆ†éƒ½æ˜¯0ï¼Œæ‰€ä»¥$s_i=s<em>j=0$ï¼Œ$Ï</em>{ij}=1/2$ï¼Œlambda(i,j)çš„è®¡ç®—å…¬å¼ä¸ºï¼š</p>
<span>$\lambda_{i j}=\rho_{i j} *|\operatorname{deltaNDCG}(i, j)|$</span><!-- Has MathJax -->
<p>ä¸Šå¼ä¸ºRanklibä¸­å®é™…ä½¿ç”¨çš„å…¬å¼ï¼Œè€Œåœ¨paperä¸­ï¼Œè¿˜éœ€è¦å†ä¹˜ä»¥-Ïƒï¼Œåœ¨Ïƒ=1æ—¶ï¼Œå°±æ˜¯ç¬¦å·æ­£å¥½ç›¸åï¼Œè¿™ä¸¤ç§æ–¹å¼æ˜¯ç­‰ä»·çš„ï¼Œç¬¦å·å¹¶ä¸å½±å“æ¨¡å‹è®­ç»ƒç»“æœï¼ˆå…¶å®å¤§å¯ä»¥æŠŠä»£ç ä¸­lambdaçš„å€¼å‰é¢åŠ ä¸€ä¸ªè´Ÿå·ï¼Œåªæ˜¯æ³¨æ„åœ¨æ¯è½®è®¡ç®—train, validå’Œæœ€åè®¡ç®—testçš„ndcgçš„æ—¶å€™ï¼Œæ¨¡å‹é¢„æµ‹çš„å¾—åˆ†modelScoresè¦æŒ‰å‡åºæ’åˆ—â€”â€”è¶Šè´Ÿçš„docè¶Šå¥½ï¼Œè€Œä¸æ˜¯æºä»£ç ä¸­æŒ‰é™åºã€‚æœ€åè®­ç»ƒå‡ºçš„æ¨¡å‹æ˜¯ä¸€æ ·çš„ï¼Œè¿™è¯´æ˜è¿™ä¸¤ç§æ–¹å¼å®Œå…¨å¯¹ç§°ï¼Œæ‰€ä»¥ç¬¦å·çš„é—®é¢˜å¯ä»¥çœç•¥ã€‚ç”šè‡³ä¸ä¹˜ä»¥-Ïƒï¼Œæ›´ç¬¦åˆäººçš„ä¹ æƒ¯â€”â€”åˆ†æ•°è¶Šå¤§è¶Šå¥½ï¼Œé™åºæ’åˆ—ç»“æœã€‚ï¼‰ï¼š</p>
<span>$\lambda_{i}=\sum_{j(l a b e l(i)&gt;l a b e l(j))} \lambda_{i j}-\sum_{j(label(i)&lt;label(j))} \lambda_{i j}$</span><!-- Has MathJax -->
<p>è®¡ç®—<span>$\lambda_{1}$</span><!-- Has MathJax -->ï¼Œç”±äºlabel(1)=0ï¼Œqid=1830ä¸­çš„å…¶ä»–docçš„labeléƒ½å¤§äºæˆ–è€…ç­‰äº0ï¼Œæ‰€ä»¥<span>$\lambda_{1}$</span><!-- Has MathJax -->çš„è®¡ç®—ä¸­æ‰€æœ‰çš„<span>$\lambda_{1,j}$</span><!-- Has MathJax -->éƒ½ä¸ºè´Ÿé¡¹ã€‚å°†ä¹‹å‰è®¡ç®—çš„å„<span>$deltaNDCG(1,j)$</span><!-- Has MathJax -->ä»£å…¥ï¼Œä¸”åˆå§‹çŠ¶æ€ä¸‹<span>$&rho;_{ij}=1/2$</span><!-- Has MathJax -->ï¼Œæ‰€ä»¥:</p>
<span>$$\begin{gather*}
begin{aligned}
&amp;\lambda_{1}=-0.5 *(\text {deltaNDCG}(1,3)+\operatorname{deltaNDCG}(1,4)\\
&amp;+\operatorname{deltaNDCG}(1,6)+\operatorname{deltaNDCG}(1,7))\\
&amp;=-0.5 *(0.222+0.239+0.260+0.267)=-0.495
\end{aligned}
\end{gather*}$$</span><!-- Has MathJax -->
<p>å¯ä»¥è®¡ç®—å‡ºåˆå§‹çŠ¶æ€ä¸‹qid=1830å„ä¸ªdocçš„lambdaå€¼ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">qId=<span class="number">1830</span>    <span class="number">0.000</span>   <span class="number">0.000</span>   <span class="number">0.000</span>   <span class="number">-0.111</span>  <span class="number">-0.120</span>  <span class="number">0.000</span>   <span class="number">-0.130</span>  <span class="number">-0.134</span>  <span class="number">0.000</span>   <span class="number">0.000</span>   <span class="keyword">lambda</span>(<span class="number">1</span>): <span class="number">-0.495</span></div><div class="line">qId=<span class="number">1830</span>    <span class="number">0.000</span>   <span class="number">0.000</span>   <span class="number">0.000</span>   <span class="number">-0.039</span>  <span class="number">-0.048</span>  <span class="number">0.000</span>   <span class="number">-0.058</span>  <span class="number">-0.062</span>  <span class="number">0.000</span>   <span class="number">0.000</span>   <span class="keyword">lambda</span>(<span class="number">2</span>): <span class="number">-0.206</span></div><div class="line">qId=<span class="number">1830</span>    <span class="number">0.000</span>   <span class="number">0.000</span>   <span class="number">0.000</span>   <span class="number">-0.014</span>  <span class="number">-0.022</span>  <span class="number">0.000</span>   <span class="number">-0.033</span>  <span class="number">-0.036</span>  <span class="number">0.000</span>   <span class="number">0.000</span>   <span class="keyword">lambda</span>(<span class="number">3</span>): <span class="number">-0.104</span></div><div class="line">qId=<span class="number">1830</span>    <span class="number">0.111</span>   <span class="number">0.039</span>   <span class="number">0.014</span>   <span class="number">0.000</span>   <span class="number">0.000</span>   <span class="number">0.015</span>   <span class="number">0.000</span>   <span class="number">0.000</span>   <span class="number">0.025</span>   <span class="number">0.028</span>   <span class="keyword">lambda</span>(<span class="number">4</span>): <span class="number">0.231</span> </div><div class="line">qId=<span class="number">1830</span>    <span class="number">0.120</span>   <span class="number">0.048</span>   <span class="number">0.022</span>   <span class="number">0.000</span>   <span class="number">0.000</span>   <span class="number">0.006</span>   <span class="number">0.000</span>   <span class="number">0.000</span>   <span class="number">0.017</span>   <span class="number">0.019</span>   <span class="keyword">lambda</span>(<span class="number">5</span>): <span class="number">0.231</span> </div><div class="line">qId=<span class="number">1830</span>    <span class="number">0.000</span>   <span class="number">0.000</span>   <span class="number">0.000</span>   <span class="number">-0.015</span>  <span class="number">-0.006</span>  <span class="number">0.000</span>   <span class="number">-0.004</span>  <span class="number">-0.008</span>  <span class="number">0.000</span>   <span class="number">0.000</span>   <span class="keyword">lambda</span>(<span class="number">6</span>): <span class="number">-0.033</span></div><div class="line">qId=<span class="number">1830</span>    <span class="number">0.130</span>   <span class="number">0.058</span>   <span class="number">0.033</span>   <span class="number">0.000</span>   <span class="number">0.000</span>   <span class="number">0.004</span>   <span class="number">0.000</span>   <span class="number">0.000</span>   <span class="number">0.006</span>   <span class="number">0.009</span>   <span class="keyword">lambda</span>(<span class="number">7</span>): <span class="number">0.240</span> </div><div class="line">qId=<span class="number">1830</span>    <span class="number">0.134</span>   <span class="number">0.062</span>   <span class="number">0.036</span>   <span class="number">0.000</span>   <span class="number">0.000</span>   <span class="number">0.008</span>   <span class="number">0.000</span>   <span class="number">0.000</span>   <span class="number">0.003</span>   <span class="number">0.005</span>   <span class="keyword">lambda</span>(<span class="number">8</span>): <span class="number">0.247</span> </div><div class="line">qId=<span class="number">1830</span>    <span class="number">0.000</span>   <span class="number">0.000</span>   <span class="number">0.000</span>   <span class="number">-0.025</span>  <span class="number">-0.017</span>  <span class="number">0.000</span>   <span class="number">-0.006</span>  <span class="number">-0.003</span>  <span class="number">0.000</span>   <span class="number">0.000</span>   <span class="keyword">lambda</span>(<span class="number">9</span>): <span class="number">-0.051</span></div><div class="line">qId=<span class="number">1830</span>    <span class="number">0.000</span>   <span class="number">0.000</span>   <span class="number">0.000</span>   <span class="number">-0.028</span>  <span class="number">-0.019</span>  <span class="number">0.000</span>   <span class="number">-0.009</span>  <span class="number">-0.005</span>  <span class="number">0.000</span>   <span class="number">0.000</span>   <span class="keyword">lambda</span>(<span class="number">10</span>): <span class="number">-0.061</span></div></pre></td></tr></table></figure>
<p>ä¸Šè¡¨ä¸­æ¯ä¸€åˆ—éƒ½æ˜¯è€ƒè™‘äº†ç¬¦å·çš„<span>$\lambda_{i,j}$</span><!-- Has MathJax -->ï¼Œå³å¦‚æœlabel(i)<label(j)ï¼Œåˆ™ä¸ºè´Ÿå€¼ï¼Œåä¹‹ä¸ºæ­£å€¼ï¼Œæ¯è¡Œç»“å°¾çš„<span>$\lambda_i$<!-- Has MathJax -->æ˜¯å‰é¢çš„åŠ å’Œï¼Œå³ä¸ºæœ€ç»ˆçš„<span>$\lambda_i$</span><!-- Has MathJax -->ã€‚å¯ä»¥çœ‹åˆ°ï¼Œ<span>$\lambda_i$</span><!-- Has MathJax -->åœ¨ç³»ç»Ÿä¸­è¡¨è¾¾äº†<span>$doc_i$</span><!-- Has MathJax -->ä¸Šå‡æˆ–è€…ä¸‹é™çš„å¼ºåº¦ï¼Œlabelè¶Šé«˜ï¼Œä½ç½®è¶Šåï¼Œ<span>$\lambda_i$</span><!-- Has MathJax -->ä¸ºæ­£å€¼ï¼Œè¶Šå¤§ï¼Œè¡¨ç¤ºè¶‹å‘ä¸Šå‡çš„æ–¹å‘ï¼ŒåŠ›åº¦ä¹Ÿè¶Šå¤§ï¼›labelè¶Šå°ï¼Œä½ç½®è¶Šé å‰ï¼Œ<span>$\lambda_i$</span><!-- Has MathJax -->ä¸ºè´Ÿå€¼ï¼Œè¶Šå°ï¼Œè¡¨ç¤ºè¶‹å‘ä¸‹é™çš„æ–¹å‘ï¼ŒåŠ›åº¦ä¹Ÿå¤§ï¼ˆ<span>$\lambda_i$</span><!-- Has MathJax -->çš„ç»å¯¹å€¼è¡¨è¾¾äº†ä¸Šå‡ã€ä¸‹é™çš„å¼ºåº¦ï¼‰ã€‚</label(j)ï¼Œåˆ™ä¸ºè´Ÿå€¼ï¼Œåä¹‹ä¸ºæ­£å€¼ï¼Œæ¯è¡Œç»“å°¾çš„<span></p>
<p>å®Œæˆå„docçš„<span>$\lambda$</span><!-- Has MathJax -->å€¼è®¡ç®—åï¼ŒRegression Treeä¾¿å¼€å§‹ä»¥æ¯ä¸ªdocçš„<span>$\lambda$</span><!-- Has MathJax -->å€¼ä¸ºç›®æ ‡ï¼Œè®­ç»ƒæ¨¡å‹ã€‚å¹¶åœ¨æœ€åå¯¹å¶å­èŠ‚ç‚¹ä¸Šçš„æ ·æœ¬ <span>$\lambda$</span><!-- Has MathJax -->å‡å€¼è¿˜åŸæˆ ğ›¾ ï¼Œä¹˜ä»¥learningRateåŠ åˆ°æ­¤å‰çš„Regression Treesä¸Šï¼Œæ›´æ–°scoreï¼Œé‡æ–°å¯¹queryä¸‹çš„docæŒ‰scoreæ’åºï¼Œå†æ¬¡è®¡ç®—deltaNDCGä»¥åŠ Î» ï¼Œå¦‚æ­¤è¿­ä»£ä¸‹å»ç›´è‡³æ ‘çš„æ•°ç›®è¾¾åˆ°å‚æ•°è®¾å®šæˆ–è€…åœ¨validationé›†ä¸Šä¸å†æŒç»­å˜å¥½ï¼ˆä¸€èˆ¬å®è·µæ¥è¯´ä¸åœ¨æ¨¡å‹è®­ç»ƒæ—¶è®¾ç½®validationé›†åˆï¼Œå› ä¸ºvalidationé›†åˆä¸€èˆ¬æ¯”è®­ç»ƒé›†åˆå°å¾ˆå¤šï¼Œå¾ˆå®¹æ˜“æ”¶æ•›ï¼Œè¾¾ä¸åˆ°æ•ˆæœï¼Œä¸å¦‚è®­ç»ƒæ—¶ä¸€æ­¥åˆ°ä½ï¼Œç„¶åå¦èµ·testé›†åˆåšç»“æœè¯„ä¼°ï¼‰ã€‚</p>
<p>Regression Treeçš„è®­ç»ƒæœ€ä¸»è¦çš„å°±æ˜¯å†³å®šå¦‚ä½•åˆ†è£‚èŠ‚ç‚¹ã€‚lambdaMARTé‡‡ç”¨æœ€æœ´ç´ çš„æœ€å°äºŒä¹˜æ³•ï¼Œä¹Ÿå°±æ˜¯æœ€å°åŒ–å¹³æ–¹è¯¯å·®å’Œæ¥åˆ†è£‚èŠ‚ç‚¹ï¼šå³å¯¹äºæŸä¸ªé€‰å®šçš„featureï¼Œé€‰å®šä¸€ä¸ªå€¼valï¼Œæ‰€æœ‰&lt;=valçš„æ ·æœ¬åˆ†åˆ°å·¦å­èŠ‚ç‚¹ï¼Œ&gt;valçš„åˆ†åˆ°å³å­èŠ‚ç‚¹ã€‚ç„¶ååˆ†åˆ«å¯¹å·¦å³ä¸¤ä¸ªèŠ‚ç‚¹è®¡ç®—å¹³æ–¹è¯¯å·®å’Œï¼Œå¹¶åŠ åœ¨ä¸€èµ·ä½œä¸ºè¿™æ¬¡åˆ†è£‚çš„ä»£ä»·ã€‚éå†æ‰€æœ‰featureä»¥åŠæ‰€æœ‰å¯èƒ½çš„åˆ†è£‚ç‚¹val(æ¯ä¸ªfeatureæŒ‰å€¼æ’åºï¼Œæ¯ä¸ªä¸åŒçš„å€¼éƒ½æ˜¯å¯èƒ½çš„åˆ†è£‚ç‚¹)ï¼Œåœ¨è¿™äº›åˆ†è£‚ä¸­æ‰¾åˆ°ä»£ä»·æœ€å°çš„ã€‚</p>
<p>ç»§ç»­ä¸Šé¢çš„ä¾‹å­ï¼Œå‡è®¾æ ·æœ¬åªæœ‰ä¸Šé¢è®¡ç®—å‡º Î» çš„10ä¸ªï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">qId=<span class="number">1830</span> features <span class="keyword">and</span> lambdas</div><div class="line">qId=<span class="number">1830</span>    <span class="number">1</span>:<span class="number">0.003</span> <span class="number">2</span>:<span class="number">0.000</span> <span class="number">3</span>:<span class="number">0.000</span> <span class="number">4</span>:<span class="number">0.000</span> <span class="number">5</span>:<span class="number">0.003</span> <span class="number">6</span>:<span class="number">0.000</span> <span class="number">7</span>:<span class="number">0.000</span> <span class="number">8</span>:<span class="number">0.000</span> <span class="number">9</span>:<span class="number">0.000</span> <span class="number">10</span>:<span class="number">0.000</span>    <span class="keyword">lambda</span>(<span class="number">1</span>):<span class="number">-0.495</span></div><div class="line">qId=<span class="number">1830</span>    <span class="number">1</span>:<span class="number">0.026</span> <span class="number">2</span>:<span class="number">0.125</span> <span class="number">3</span>:<span class="number">0.000</span> <span class="number">4</span>:<span class="number">0.000</span> <span class="number">5</span>:<span class="number">0.027</span> <span class="number">6</span>:<span class="number">0.000</span> <span class="number">7</span>:<span class="number">0.000</span> <span class="number">8</span>:<span class="number">0.000</span> <span class="number">9</span>:<span class="number">0.000</span> <span class="number">10</span>:<span class="number">0.000</span>    <span class="keyword">lambda</span>(<span class="number">2</span>):<span class="number">-0.206</span></div><div class="line">qId=<span class="number">1830</span>    <span class="number">1</span>:<span class="number">0.001</span> <span class="number">2</span>:<span class="number">0.000</span> <span class="number">3</span>:<span class="number">0.000</span> <span class="number">4</span>:<span class="number">0.000</span> <span class="number">5</span>:<span class="number">0.001</span> <span class="number">6</span>:<span class="number">0.000</span> <span class="number">7</span>:<span class="number">0.000</span> <span class="number">8</span>:<span class="number">0.000</span> <span class="number">9</span>:<span class="number">0.000</span> <span class="number">10</span>:<span class="number">0.000</span>    <span class="keyword">lambda</span>(<span class="number">3</span>):<span class="number">-0.104</span></div><div class="line">qId=<span class="number">1830</span>    <span class="number">1</span>:<span class="number">0.189</span> <span class="number">2</span>:<span class="number">0.375</span> <span class="number">3</span>:<span class="number">0.333</span> <span class="number">4</span>:<span class="number">1.000</span> <span class="number">5</span>:<span class="number">0.196</span> <span class="number">6</span>:<span class="number">0.000</span> <span class="number">7</span>:<span class="number">0.000</span> <span class="number">8</span>:<span class="number">0.000</span> <span class="number">9</span>:<span class="number">0.000</span> <span class="number">10</span>:<span class="number">0.000</span>    <span class="keyword">lambda</span>(<span class="number">4</span>):<span class="number">0.231</span></div><div class="line">qId=<span class="number">1830</span>    <span class="number">1</span>:<span class="number">0.078</span> <span class="number">2</span>:<span class="number">0.500</span> <span class="number">3</span>:<span class="number">0.667</span> <span class="number">4</span>:<span class="number">0.000</span> <span class="number">5</span>:<span class="number">0.086</span> <span class="number">6</span>:<span class="number">0.000</span> <span class="number">7</span>:<span class="number">0.000</span> <span class="number">8</span>:<span class="number">0.000</span> <span class="number">9</span>:<span class="number">0.000</span> <span class="number">10</span>:<span class="number">0.000</span>    <span class="keyword">lambda</span>(<span class="number">5</span>):<span class="number">0.231</span></div><div class="line">qId=<span class="number">1830</span>    <span class="number">1</span>:<span class="number">0.075</span> <span class="number">2</span>:<span class="number">0.125</span> <span class="number">3</span>:<span class="number">0.333</span> <span class="number">4</span>:<span class="number">0.000</span> <span class="number">5</span>:<span class="number">0.078</span> <span class="number">6</span>:<span class="number">0.000</span> <span class="number">7</span>:<span class="number">0.000</span> <span class="number">8</span>:<span class="number">0.000</span> <span class="number">9</span>:<span class="number">0.000</span> <span class="number">10</span>:<span class="number">0.000</span>    <span class="keyword">lambda</span>(<span class="number">6</span>):<span class="number">-0.033</span></div><div class="line">qId=<span class="number">1830</span>    <span class="number">1</span>:<span class="number">0.079</span> <span class="number">2</span>:<span class="number">0.250</span> <span class="number">3</span>:<span class="number">0.667</span> <span class="number">4</span>:<span class="number">0.000</span> <span class="number">5</span>:<span class="number">0.085</span> <span class="number">6</span>:<span class="number">0.000</span> <span class="number">7</span>:<span class="number">0.000</span> <span class="number">8</span>:<span class="number">0.000</span> <span class="number">9</span>:<span class="number">0.000</span> <span class="number">10</span>:<span class="number">0.000</span>    <span class="keyword">lambda</span>(<span class="number">7</span>):<span class="number">0.240</span></div><div class="line">qId=<span class="number">1830</span>    <span class="number">1</span>:<span class="number">0.148</span> <span class="number">2</span>:<span class="number">0.000</span> <span class="number">3</span>:<span class="number">0.000</span> <span class="number">4</span>:<span class="number">0.000</span> <span class="number">5</span>:<span class="number">0.148</span> <span class="number">6</span>:<span class="number">0.000</span> <span class="number">7</span>:<span class="number">0.000</span> <span class="number">8</span>:<span class="number">0.000</span> <span class="number">9</span>:<span class="number">0.000</span> <span class="number">10</span>:<span class="number">0.000</span>    <span class="keyword">lambda</span>(<span class="number">8</span>):<span class="number">0.247</span></div><div class="line">qId=<span class="number">1830</span>    <span class="number">1</span>:<span class="number">0.059</span> <span class="number">2</span>:<span class="number">0.000</span> <span class="number">3</span>:<span class="number">0.000</span> <span class="number">4</span>:<span class="number">0.000</span> <span class="number">5</span>:<span class="number">0.059</span> <span class="number">6</span>:<span class="number">0.000</span> <span class="number">7</span>:<span class="number">0.000</span> <span class="number">8</span>:<span class="number">0.000</span> <span class="number">9</span>:<span class="number">0.000</span> <span class="number">10</span>:<span class="number">0.000</span>    <span class="keyword">lambda</span>(<span class="number">9</span>):<span class="number">-0.051</span></div><div class="line">qId=<span class="number">1830</span>    <span class="number">1</span>:<span class="number">0.071</span> <span class="number">2</span>:<span class="number">0.125</span> <span class="number">3</span>:<span class="number">0.333</span> <span class="number">4</span>:<span class="number">0.000</span> <span class="number">5</span>:<span class="number">0.074</span> <span class="number">6</span>:<span class="number">0.000</span> <span class="number">7</span>:<span class="number">0.000</span> <span class="number">8</span>:<span class="number">0.000</span> <span class="number">9</span>:<span class="number">0.000</span> <span class="number">10</span>:<span class="number">0.000</span>    <span class="keyword">lambda</span>(<span class="number">10</span>):<span class="number">-0.061</span></div></pre></td></tr></table></figure>
<p>ä¸Šè¡¨ä¸­é™¤äº†ç¬¬ä¸€åˆ—æ˜¯qidï¼Œæœ€åä¸€åˆ—æ˜¯lambdaå¤–ï¼Œå…¶ä½™éƒ½æ˜¯featureï¼Œæ¯”å¦‚æˆ‘ä»¬é€‰æ‹©feature(1)çš„0.059åšåˆ†è£‚ç‚¹ï¼Œåˆ™å·¦å­èŠ‚ç‚¹&lt;=0.059çš„docæœ‰: 1, 2, 3, 9ï¼›è€Œ&gt;0.059çš„è¢«å®‰æ’åˆ°å³å­èŠ‚ç‚¹ï¼Œdocæœ‰4, 5, 6, 7, 8, 10ã€‚ç”±æ­¤å·¦å³ä¸¤ä¸ªå­èŠ‚ç‚¹çš„lambdaå‡å€¼åˆ†åˆ«ä¸ºï¼š</p>
<span>$\bar{\lambda}_{L}=\frac{\lambda_{1}+\lambda_{2}+\lambda_{3}+\lambda 9}{4}=\frac{-0.495-0.206-0.104-0.051}{4}=-0.214$</span><!-- Has MathJax -->
<span>$$\begin{gather*}
\begin{array}{l}
\lambda_{R}^{-}=\frac{\lambda_{4}+\lambda_{5}+\lambda_{6}+\lambda 7+\lambda_{8}+\lambda_{10}}{6} \\
=\frac{0.231+0.231-0.033+0.240+0.247-0.061}{6}=0.143
\end{array}
\end{gather*}$$</span><!-- Has MathJax -->
<p>ç»§ç»­è®¡ç®—å·¦å³å­èŠ‚ç‚¹çš„å¹³æ–¹è¯¯å·®å’Œï¼š</p>
<span>$$\begin{gather*}
\begin{aligned}
&amp;s_{L}=\sum_{i \in L}\left(\lambda_{i}-\bar{\lambda}_{L}\right)^{2}=(-0.495+0.214)^{2}\\
&amp;+(-0.206+0.214)^{2}+(-0.104+0.214)^{2}\\
&amp;+(-0.051+0.214)^{2}=0.118\\
&amp;s_{R}=\sum_{i \in R}\left(\lambda_{i}-\bar{\lambda}_{R}\right)^{2}=(0.231-0.143)^{2}\\
&amp;+(0.231-0.143)^{2}+(-0.033-0.143)^{2}\\
&amp;+(0.240-0.143)^{2}+(0.247-0.143)^{2}\\
&amp;+(0.016-0.143)^{2}=0.083
\end{aligned}
\end{gather*}$$</span><!-- Has MathJax -->
<p>å› æ­¤å°†feature(1)çš„0.059ä½œä¸ºåˆ†è£‚ç‚¹æ—¶çš„å‡æ–¹å·®ï¼ˆåˆ†è£‚ä»£ä»·ï¼‰æ˜¯ï¼š</p>
<span>$$\begin{gather*}
\cos t_{0.059 @ \text { feature}(1)}=s_{L}+s_{R}=0.118+0.083=0.201
\end{gather*}$$</span><!-- Has MathJax -->
<p>æˆ‘ä»¬å¯ä»¥åƒä¸Šé¢é‚£æ ·éå†æ‰€æœ‰featureçš„ä¸åŒå€¼ï¼Œå°è¯•åˆ†è£‚ï¼Œè®¡ç®—Costï¼Œæœ€ç»ˆé€‰æ‹©æ‰€æœ‰å¯èƒ½åˆ†è£‚ä¸­æœ€å°Costçš„é‚£ä¸€ä¸ªä½œä¸ºåˆ†è£‚ç‚¹ã€‚ç„¶åå°† ğ‘ ğ¿sL å’Œ ğ‘ ğ‘…sR åˆ†åˆ«ä½œä¸ºå·¦å³å­èŠ‚ç‚¹çš„å±æ€§å­˜å‚¨èµ·æ¥ï¼Œå¹¶æŠŠåˆ†è£‚çš„æ ·æœ¬ä¹Ÿåˆ†åˆ«å­˜å‚¨åˆ°å·¦å³å­èŠ‚ç‚¹ä¸­ï¼Œç„¶åç»´æŠ¤ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå§‹ç»ˆæŒ‰å¹³æ–¹è¯¯å·®å’Œ s é™åºæ’å…¥æ–°åˆ†è£‚å‡ºçš„èŠ‚ç‚¹ï¼Œæ¯æ¬¡ä»è¯¥é˜Ÿåˆ—å¤´éƒ¨æ‹¿å‡ºä¸€ä¸ªèŠ‚ç‚¹ï¼ˆå¹¶åŸºäºè¿™ä¸ªèŠ‚ç‚¹ä¸Šçš„æ ·æœ¬ï¼‰è¿›è¡Œåˆ†è£‚ï¼ˆå³æœ€å¤§å‡æ–¹å·®ä¼˜å…ˆåˆ†è£‚ï¼‰ï¼Œç›´åˆ°æ ‘çš„åˆ†è£‚æ¬¡æ•°è¾¾åˆ°å‚æ•°è®¾å®šï¼ˆè®­ç»ƒæ—¶ä¼ å…¥çš„leafå€¼ï¼Œå¶å­èŠ‚ç‚¹çš„ä¸ªæ•°ä¸åˆ†è£‚æ¬¡æ•°ç­‰ä»·ï¼‰ã€‚è¿™æ ·å°±å®Œæˆäº†ä¸€æ£µRegression Treeçš„è®­ç»ƒã€‚</p>
<p>ä¸Šé¢è®²è¿°äº†ä¸€æ£µæ ‘çš„æ ‡å‡†åˆ†è£‚è¿‡ç¨‹ï¼Œæ­¤å¤–ï¼Œæ ‘çš„åˆ†è£‚è¿˜åŒ…å«äº†å…¶ä»–å‚æ•°è®¾å®šï¼Œä¾‹å¦‚å¶å­èŠ‚ç‚¹ä¸Šçš„æœ€å°‘æ ·æœ¬æ•°ï¼Œæ¯”å¦‚æˆ‘ä»¬è®¾å®šä¸º3ï¼Œåˆ™åœ¨feature(1)å¤„ï¼Œ0.001å’Œ0.003ä¸¤ä¸ªå€¼éƒ½ä¸èƒ½ä½œä¸ºåˆ†è£‚ç‚¹ï¼Œå› ä¸ºç”¨å®ƒä»¬åšåˆ†è£‚ç‚¹ï¼Œå·¦å­æ ‘çš„æ ·æœ¬æ•°åˆ†åˆ«æ˜¯1å’Œ2ï¼Œå‡&lt;3ã€‚å¶å­èŠ‚ç‚¹çš„æœ€å°‘æ ·æœ¬æ•°è¶Šå°ï¼Œæ¨¡å‹åˆ™æ‹Ÿåˆå¾—è¶Šå¥½ï¼Œå½“ç„¶ä¹Ÿå®¹æ˜“è¿‡æ‹Ÿåˆï¼ˆover-fittingï¼‰ï¼›åä¹‹å¦‚æœè®¾ç½®å¾—è¶Šå¤§ï¼Œæ¨¡å‹åˆ™å¯èƒ½æ¬ æ‹Ÿåˆï¼ˆunder-fittingï¼‰ï¼Œå®è·µä¸­å¯ä»¥ä½¿ç”¨cross validationçš„åŠæ³•æ¥å¯»æ‰¾æœ€ä½³çš„å‚æ•°è®¾å®šã€‚</p>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://zhuanlan.zhihu.com/p/57814935" target="_blank" rel="external">GBTã€GBDTã€GBRTä¸Xgboost</a></p>
<p><a href="https://www.microsoft.com/en-us/research/wp-content/uploads/2016/02/MSR-TR-2010-82.pdf" target="_blank" rel="external">From RankNet to LambdaRank to LambdaMART: An Overview</a></p>
<p><a href="https://www.cnblogs.com/wowarsenal/p/3900359.html" target="_blank" rel="external">LambdaMARTç®€ä»‹â€”â€”åŸºäºRanklibæºç </a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/19/æœç´¢æ’åºç®—æ³•/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeb">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°èœé¸¡">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/19/æœç´¢æ’åºç®—æ³•/" itemprop="url">æœç´¢æ’åºç®—æ³•</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2020-01-19T15:56:07+08:00">
                2020-01-19
              </time>
            

            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>

<script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>



<p><strong><em>[å¾…è¿›ä¸€æ­¥æ•´ç†]</em></strong></p>
<h1 id="ç®—æ³•æ¡†æ¶"><a href="#ç®—æ³•æ¡†æ¶" class="headerlink" title="ç®—æ³•æ¡†æ¶"></a>ç®—æ³•æ¡†æ¶</h1><p>å…¸å‹çš„æœç´¢æ’åºç®—æ³•æ¡†æ¶å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåˆ†ä¸ºçº¿ä¸‹è®­ç»ƒå’Œçº¿ä¸Šæ’åºä¸¤ä¸ªéƒ¨åˆ†ã€‚æ¨¡å‹åŒ…æ‹¬ç›¸å…³æ€§æ¨¡å‹ã€æ—¶æ•ˆæ€§æ¨¡å‹ã€ä¸ªæ€§åŒ–æ¨¡å‹å’Œç‚¹å‡»æ¨¡å‹ç­‰ã€‚ç‰¹å¾åŒ…æ‹¬Queryç‰¹å¾ã€Docç‰¹å¾ã€Userç‰¹å¾å’ŒQuery-DocåŒ¹é…ç‰¹å¾ç­‰ã€‚æ—¥å¿—åŒ…æ‹¬å±•ç°æ—¥å¿—ã€ç‚¹å‡»æ—¥å¿—å’ŒQueryæ—¥å¿—ã€‚<br><img width="700" src="/images/search_structure.png"></p>
<h1 id="ç‰¹å¾é€‰æ‹©"><a href="#ç‰¹å¾é€‰æ‹©" class="headerlink" title="ç‰¹å¾é€‰æ‹©"></a>ç‰¹å¾é€‰æ‹©</h1><h2 id="æ³›ç‰¹å¾"><a href="#æ³›ç‰¹å¾" class="headerlink" title="æ³›ç‰¹å¾"></a>æ³›ç‰¹å¾</h2><p>Queryç‰¹å¾ï¼šæ„å›¾åˆ†ç±»ã€å…³é”®è¯ã€è¯æƒé‡ç­‰ã€‚<br>Docç‰¹å¾ï¼šæ–‡ç« åˆ†ç±»ã€é•¿åº¦ã€ç‚¹èµæ•°ç­‰ã€‚<br>Userç‰¹å¾ï¼šå¹´é¾„ã€æ€§åˆ«ç­‰ã€‚<br>Query-DocåŒ¹é…ç‰¹å¾ï¼šç±»åˆ«åŒ¹é…ã€BM25ã€‚<br>ç‚¹å‡»ç‰¹å¾ï¼šCTRã€é¦–æ¬¡ç‚¹å‡»ç­‰ã€‚</p>
<h1 id="æ—¥å¿—è®¾è®¡"><a href="#æ—¥å¿—è®¾è®¡" class="headerlink" title="æ—¥å¿—è®¾è®¡"></a>æ—¥å¿—è®¾è®¡</h1><p>å±•ç°æ—¥å¿—ï¼šç†è®ºä¸Šå¯æ ¹æ®ç»éªŒè¿›è¡Œäººå·¥æ ‡æ³¨æ‰“åˆ†ï¼Œå¹¶ä¸”ä½œä¸ºæ¨¡å‹çš„å¯åŠ¨è®­ç»ƒæ•°æ®ã€‚<br>ç‚¹å‡»æ—¥å¿—ï¼šç”¨æˆ·çš„ç‚¹å‡»è¡Œä¸ºæ—¥å¿—ï¼Œå¯ä»¥ç”¨äºQueryæ—¥å¿—æŒ–æ˜ï¼Œè¿›è¡ŒæŸ¥è¯¢æ‰©å±•ç­‰ï¼Œä¾‹å¦‚å¤šä¸ªqueryæœç´¢ç»“æœç”¨æˆ·éƒ½ç‚¹å‡»äº†åŒä¸€ç¯‡æ–‡æ¡£ï¼Œåˆ™å¯è®¤ä¸ºè¿™äº›queryç›¸ä¼¼ã€‚<br>Queryæ—¥å¿—ï¼šç”¨äºå’Œç‚¹å‡»ï¼è½¬åŒ–æ•°æ®åšè”åˆåˆ†æã€‚</p>
<h1 id="æ¨¡å‹ä»‹ç»"><a href="#æ¨¡å‹ä»‹ç»" class="headerlink" title="æ¨¡å‹ä»‹ç»"></a>æ¨¡å‹ä»‹ç»</h1><p>ç›¸å…³æ€§æ¨¡å‹ï¼šLearning to Rankæ¨¡å‹</p>
<ol>
<li>æŒ‰ç…§æ ·æœ¬ç”Ÿæˆæ–¹æ³•å’ŒLoss Functionä¸åŒåˆ†ä¸ºpoint wiseã€pair wiseå’Œlist wiseä¸‰ç§ï¼Œå‚è€ƒ<a href="https://wesure.lexiangla.com/teams/dm/docs/1665fb8a09d111ea81c20a58ac131706?company_from=wesure" target="_blank" rel="external">L2Rç®—æ³•ä»‹ç»</a>ã€‚2019å¹´Googleæå‡ºçš„group wiseæ¨¡å‹ TF Rankingã€‚</li>
<li>æŒ‰ç…§æ¨¡å‹ç»“æ„åˆ’åˆ†ï¼Œå¯åˆ†ä¸ºçº¿æ€§æ’åºæ¨¡å‹ã€æ ‘æ¨¡å‹ã€æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œä»¥åŠç»„åˆæ¨¡å‹ï¼ˆGBDT+LRï¼ŒDeep&amp;Wideï¼‰ã€‚</li>
</ol>
<p>æ—¶æ•ˆæ€§æ¨¡å‹ï¼š[å¾…è¡¥å……]ã€‚<br>ä¸ªæ€§åŒ–æ¨¡å‹ï¼šé€»è¾‘å›å½’(Logistic Regressionï¼‰ã€‚<br>ç‚¹å‡»æ¨¡å‹ï¼šæ·±åº¦ç½®ä¿¡ç½‘ç»œ(DeepBeliefNetworks)ã€‚</p>
<h2 id="ç›¸å…³æ€§æ¨¡å‹"><a href="#ç›¸å…³æ€§æ¨¡å‹" class="headerlink" title="ç›¸å…³æ€§æ¨¡å‹"></a>ç›¸å…³æ€§æ¨¡å‹</h2><h3 id="æ¨¡å‹åˆ†ç±»"><a href="#æ¨¡å‹åˆ†ç±»" class="headerlink" title="æ¨¡å‹åˆ†ç±»"></a>æ¨¡å‹åˆ†ç±»</h3><p><img width="700" src="/images/search_kinds.png"></p>
<h3 id="è¿­ä»£è¿‡ç¨‹"><a href="#è¿­ä»£è¿‡ç¨‹" class="headerlink" title="è¿­ä»£è¿‡ç¨‹"></a>è¿­ä»£è¿‡ç¨‹</h3><p><img width="700" src="/images/search_process.png"></p>
<h3 id="ä¸»æµæ¨¡å‹åŠè¯„æµ‹æŒ‡æ ‡"><a href="#ä¸»æµæ¨¡å‹åŠè¯„æµ‹æŒ‡æ ‡" class="headerlink" title="ä¸»æµæ¨¡å‹åŠè¯„æµ‹æŒ‡æ ‡"></a>ä¸»æµæ¨¡å‹åŠè¯„æµ‹æŒ‡æ ‡</h3><p><img width="700" src="/images/search_evalute.png"></p>
<h3 id="ä¸»æµæ¨¡å‹å¯¹æ¯”"><a href="#ä¸»æµæ¨¡å‹å¯¹æ¯”" class="headerlink" title="ä¸»æµæ¨¡å‹å¯¹æ¯”"></a>ä¸»æµæ¨¡å‹å¯¹æ¯”</h3><p><img height="500" src="/images/serach_model_compare.png"></p>
<p>å›¾ä¸­Rank CreationæŒ‡ç»™å®šæŸ¥è¯¢Queryå’Œæ–‡æ¡£Docsï¼Œå¾—åˆ°Docsæ’åºç»“æœï¼›Rank AggregationæŒ‡ç»¼åˆå¤šä¸ªä¸åŒçš„Ranking Systemçš„æ’åºç»“æœï¼Œå¾—å‡ºæœ€ç»ˆæ’åºç»“æœã€‚</p>
<h3 id="æ¨¡å‹è¯¦æƒ…"><a href="#æ¨¡å‹è¯¦æƒ…" class="headerlink" title="æ¨¡å‹è¯¦æƒ…"></a>æ¨¡å‹è¯¦æƒ…</h3><h4 id="RankSVM"><a href="#RankSVM" class="headerlink" title="RankSVM"></a>RankSVM</h4><p>RankSVM(2003)ï¼Œå°†æ’åºé—®é¢˜è½¬åŒ–ä¸ºpairwiseçš„åˆ†ç±»é—®é¢˜ï¼Œç„¶åä½¿ç”¨SVMåˆ†ç±»æ¨¡å‹è¿›è¡Œå­¦ä¹ å¹¶æ±‚è§£ï¼Œä¸¾ä¾‹è¯´æ˜ï¼Œä¸¤ç»„queryåŠå…¶å¬å›çš„documentsï¼Œå…¶ä¸­query-docçš„ç›¸å…³ç¨‹åº¦ç­‰çº§åˆ†ä¸ºä¸‰æ¡£ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img width="700" src="/images/search_ranksvm1.png"><br>åŒä¸€ä¸ªqueryä¸‹çš„ä¸åŒç›¸å…³åº¦çš„docçš„feature vectorå¯ä»¥è¿›è¡Œç»„åˆï¼Œå½¢æˆæ–°çš„feature vectorï¼šx1-x2ï¼Œx1-x3ï¼Œx2-x3ã€‚åŒæ—¶labelä¹Ÿä¼šè¢«é‡æ–°èµ‹å€¼ï¼Œä¾‹å¦‚L1-L2ï¼ŒL1-L3ï¼ŒL2-L3ã€‚è¿™å‡ ä¸ªfeature vectorçš„labelè¢«èµ‹å€¼æˆåˆ†ç±»é—®é¢˜ä¸­çš„positive labelã€‚è¿›ä¸€æ­¥ï¼Œä¸ºäº†å½¢æˆä¸€ä¸ªæ ‡å‡†çš„åˆ†ç±»é—®é¢˜ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æœ‰negative samplesï¼Œè¿™é‡Œæˆ‘ä»¬å°±ä½¿ç”¨å‰è¿°çš„å‡ ä¸ªæ–°çš„positive feature vectorçš„åæ–¹å‘å‘é‡ä½œä¸ºç›¸åº”çš„negative samplesï¼šx2-x1ï¼Œx3-x1ï¼Œx3-x2ã€‚å¦å¤–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨ç»„åˆå½¢æˆæ–°çš„feature vectorçš„æ—¶å€™ï¼Œä¸èƒ½ä½¿ç”¨åœ¨åŸå§‹æ’åºé—®é¢˜ä¸­å¤„äºç›¸åŒç›¸ä¼¼åº¦ç­‰çº§çš„ä¸¤ä¸ªfeature vectorï¼Œä¹Ÿä¸èƒ½ä½¿ç”¨å¤„äºä¸åŒqueryä¸‹çš„ä¸¤ä¸ªfeature vectorã€‚<br><img width="700" src="/images/search_ranksvm2.png"></p>
<h4 id="RankNet"><a href="#RankNet" class="headerlink" title="RankNet"></a>RankNet</h4><p>å¾®è½¯(2005)æå‡ºï¼Œå±äºpairwiseç®—æ³•ï¼Œä»æ¦‚ç‡çš„è§’åº¦æ¥è§£å†³æ’åºé—®é¢˜ã€‚RankNetçš„æ ¸å¿ƒæ˜¯æå‡ºäº†ä¸€ç§æ¦‚ç‡æŸå¤±å‡½æ•°æ¥å­¦ä¹ Ranking Functionï¼Œå¹¶åº”ç”¨Ranking Functionå¯¹æ–‡æ¡£è¿›è¡Œæ’åºã€‚è¿™é‡Œçš„Ranking Functionå¯ä»¥æ˜¯ä»»æ„å¯¹å‚æ•°å¯å¾®çš„æ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥æ¦‚ç‡æŸå¤±å‡½æ•°å¹¶ä¸ä¾èµ–äºç‰¹å®šçš„æœºå™¨å­¦ä¹ æ¨¡å‹ï¼Œåœ¨è®ºæ–‡ä¸­ï¼ŒRankNetæ˜¯åŸºäºç¥ç»ç½‘ç»œå®ç°çš„ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒGBDTç­‰æ¨¡å‹ä¹Ÿå¯ä»¥åº”ç”¨äºè¯¥æ¡†æ¶ã€‚<br>å¯¹äºä»»æ„ä¸€ä¸ªdocå¯¹(Ui,Uj)ï¼Œæ¨¡å‹è¾“å‡ºçš„scoreåˆ†åˆ«ä¸ºsiå’Œsjï¼Œé‚£ä¹ˆæ ¹æ®æ¨¡å‹çš„é¢„æµ‹ï¼ŒUiæ¯”Ujä¸Queryæ›´ç›¸å…³çš„æ¦‚ç‡ä¸ºPijã€‚ç”±äºRankNetä½¿ç”¨çš„æ¨¡å‹ä¸€èˆ¬ä¸ºç¥ç»ç½‘ç»œï¼Œæ ¹æ®ç»éªŒsigmoidå‡½æ•°èƒ½æä¾›ä¸€ä¸ªæ¯”è¾ƒå¥½çš„æ¦‚ç‡è¯„ä¼°ã€‚<br>é‚£ä¹ˆæ ¹æ®æ¨¡å‹çš„é¢„æµ‹ï¼ŒUiæ¯”Ujä¸Queryæ›´ç›¸å…³çš„æ¦‚ç‡ä¸ºï¼š<br><span>$$\begin{gather*}
P_{i j}=P\left(U_{i}&gt;U_{j}\right)=\frac{1}{1+e^{-\sigma\left(s_{i}-s_{j}\right)}}
\end{gather*}$$</span><!-- Has MathJax --><br><strong><em>RankNetè¯æ˜äº†å¦‚æœçŸ¥é“ä¸€ä¸ªå¾…æ’åºæ–‡æ¡£çš„æ’åˆ—ä¸­ç›¸é‚»ä¸¤ä¸ªæ–‡æ¡£ä¹‹é—´çš„æ’åºæ¦‚ç‡ï¼Œåˆ™é€šè¿‡æ¨å¯¼å¯ä»¥ç®—å‡ºæ¯ä¸¤ä¸ªæ–‡æ¡£ä¹‹é—´çš„æ’åºæ¦‚ç‡ã€‚å› æ­¤å¯¹äºä¸€ä¸ªå¾…æ’åºæ–‡æ¡£åºåˆ—ï¼Œåªéœ€è®¡ç®—ç›¸é‚»æ–‡æ¡£ä¹‹é—´çš„æ’åºæ¦‚ç‡ï¼Œä¸éœ€è¦è®¡ç®—æ‰€æœ‰pairï¼Œå‡å°‘è®¡ç®—é‡ã€‚</em></strong><br>å¯¹äºè®­ç»ƒæ•°æ®ä¸­çš„Uiå’ŒUjï¼Œå®ƒä»¬éƒ½åŒ…å«æœ‰ä¸€ä¸ªä¸Queryç›¸å…³æ€§çš„çœŸå®labelï¼Œæ¯”å¦‚Uiä¸Queryçš„ç›¸å…³æ€§labelä¸ºgoodï¼ŒUjä¸Queryçš„ç›¸å…³æ€§labelä¸ºbadï¼Œé‚£ä¹ˆæ˜¾ç„¶Uiæ¯”Ujæ›´ç›¸å…³ã€‚æˆ‘ä»¬å®šä¹‰Uiæ¯”Ujæ›´ç›¸å…³çš„çœŸå®æ¦‚ç‡ä¸ºSijï¼š<br><span>$$\begin{gather*}
\bar{P}_{i j}=\frac{1}{2}\left(1+S_{i j}\right)
\end{gather*}$$</span><!-- Has MathJax --><br>å¦‚æœ$U_i$æ¯”$U_j$æ›´ç›¸å…³ï¼Œé‚£ä¹ˆSij=1ï¼›å¦‚æœUiä¸å¦‚Ujç›¸å…³ï¼Œé‚£ä¹ˆSij=âˆ’1ï¼›å¦‚æœ$U_i$ã€$U_j$ä¸Queryçš„ç›¸å…³ç¨‹åº¦ç›¸åŒï¼Œé‚£ä¹ˆSij=0ã€‚é€šå¸¸ï¼Œä¸¤ä¸ªdocçš„ç›¸å…³åº¦å¯ç”±äººå·¥æ ‡æ³¨æˆ–è€…ä»æœç´¢æ—¥å¿—ä¸­å¾—åˆ°ã€‚<br>å¯¹äºä¸€ä¸ªæ’åºï¼ŒRankNetä»å„ä¸ªdocçš„ç›¸å¯¹å…³ç³»æ¥è¯„ä»·æ’åºç»“æœçš„å¥½åï¼Œæ’åºçš„æ•ˆæœè¶Šå¥½ï¼Œé‚£ä¹ˆæœ‰é”™è¯¯ç›¸å¯¹å…³ç³»çš„doc pairå°±è¶Šå°‘ã€‚æ‰€è°“é”™è¯¯çš„ç›¸å¯¹å…³ç³»å³å¦‚æœæ ¹æ®æ¨¡å‹è¾“å‡ºUiæ’åœ¨Ujå‰é¢ï¼Œä½†çœŸå®labelä¸ºUiçš„ç›¸å…³æ€§å°äºUjï¼Œé‚£ä¹ˆå°±è®°ä¸€ä¸ªé”™è¯¯pairï¼ŒRankNetæœ¬è´¨ä¸Šå°±æ˜¯ä»¥é”™è¯¯çš„pairæœ€å°‘ä¸ºä¼˜åŒ–ç›®æ ‡ã€‚è€Œåœ¨æŠ½è±¡æˆcost functionæ—¶ï¼ŒRankNetå®é™…ä¸Šæ˜¯å¼•å…¥äº†æ¦‚ç‡çš„æ€æƒ³ï¼šä¸æ˜¯ç›´æ¥åˆ¤æ–­Uiæ’åœ¨Ujå‰é¢ï¼Œè€Œæ˜¯è¯´Uiä»¥ä¸€å®šçš„æ¦‚ç‡Pæ’åœ¨Ujå‰é¢ï¼Œå³æ˜¯ä»¥é¢„æµ‹æ¦‚ç‡ä¸çœŸå®æ¦‚ç‡çš„å·®è·æœ€å°ä½œä¸ºä¼˜åŒ–ç›®æ ‡ã€‚æœ€åï¼ŒRankNetä½¿ç”¨Cross Entropyä½œä¸ºcost functionï¼Œæ¥è¡¡é‡é¢„æµ‹ç›¸å…³æ€§æ¦‚ç‡å¯¹çœŸå®ç›¸å…³æ€§æ¦‚ç‡çš„æ‹Ÿåˆç¨‹åº¦ï¼š<br><span>$$\begin{gather*}
C=-\bar{P}_{i j} \log P_{i j}-\left(1-\bar{P}_{i j}\right) \log \left(1-P_{i j}\right)
\end{gather*}$$</span><!-- Has MathJax --><br>è¯¥æŸå¤±å‡½æ•°æœ‰ä»¥ä¸‹ä¸¤ä¸ªç‰¹ç‚¹ï¼š<br>è¿›ä¸€æ­¥åŒ–ç®€åæœ‰ï¼š<br><span>$$\begin{gather*}
\begin{aligned}
C_{i j} &amp;=-\frac{1}{2}\left(1+S_{i j}\right) \log \frac{1}{1+e^{-\sigma\left(s_{i}-s_{j}\right)}}-\frac{1}{2}\left(1-S_{i j}\right) \log \frac{e^{-\sigma\left(s_{i}-s_{j}\right)}}{1+e^{-\sigma\left(s_{i}-s_{j}\right)}} \\
&amp;=-\frac{1}{2}\left(1+S_{i j}\right) \log \frac{1}{1+e^{-\sigma\left(s_{i}-s_{j}\right)}}-\frac{1}{2}\left(1-S_{i j}\right)\left[-\sigma\left(s_{i}-s_{j}\right)+\log \frac{1}{1+e^{-\sigma\left(s_{i}-s_{j}\right)}}\right] \\
&amp;=\frac{1}{2}\left(1-S_{i j}\right) \sigma\left(s_{i}-s_{j}\right)+\log \left(1+e^{-\sigma\left(s_{i}-s_{j}\right)}\right)
\end{aligned}
\end{gather*}$$</span><!-- Has MathJax --><br>å½“Sij=1ï¼Œæœ‰ï¼š<br><span>$$\begin{gather*}
C=\log \left(1+e^{-\sigma\left(s_{i}-s_{j}\right)}\right)
\end{gather*}$$</span><!-- Has MathJax --><br>å½“Sij=-1ï¼Œæœ‰ï¼š<br><span>$$\begin{gather*}
C=\log \left(1+e^{-\sigma\left(s_{j}-s_{i}\right)}\right)
\end{gather*}$$</span><!-- Has MathJax --><br>ä¸‹å›¾å±•ç¤ºäº†å½“Sijåˆ†åˆ«å–1ï¼Œ0ï¼Œ-1çš„æ—¶å€™cost functionä»¥si-sjä¸ºå˜é‡çš„å‡½æ•°å›¾åƒï¼š<br><img width="700" src="/images/search_fun_pic.png"><br>å¯ä»¥çœ‹åˆ°å½“Sij=1æ—¶ï¼Œæ¨¡å‹é¢„æµ‹çš„siæ¯”sjè¶Šå¤§ï¼Œå…¶ä»£ä»·è¶Šå°ï¼›Sij=âˆ’1æ—¶ï¼Œsiæ¯”sjè¶Šå°ï¼Œä»£ä»·è¶Šå°ï¼›Sij=0æ—¶ï¼Œä»£ä»·çš„æœ€å°å€¼åœ¨siä¸sjç›¸ç­‰å¤„å–å¾—ã€‚<br>è¯¥æŸå¤±å‡½æ•°æœ‰ä¸‹é¢ä¸¤ä¸ªç‰¹ç‚¹ï¼š</p>
<ol>
<li>å½“ä¸¤ä¸ªç›¸å…³æ€§ä¸åŒçš„æ–‡æ¡£ç®—å‡ºæ¥çš„æ¨¡å‹åˆ†æ•°ç›¸åŒæ—¶ï¼ŒæŸå¤±å‡½æ•°çš„å€¼å¤§äº0ï¼Œä»ä¼šå¯¹è¿™å¯¹pairåšæƒ©ç½šï¼Œä½¿ä»–ä»¬çš„æ’åºä½ç½®åŒºåˆ†å¼€ã€‚</li>
<li>æŸå¤±å‡½æ•°æ˜¯ä¸€ä¸ªç±»çº¿æ€§å‡½æ•°ï¼Œå¯ä»¥æœ‰æ•ˆå‡å°‘å¼‚å¸¸æ ·æœ¬æ•°æ®å¯¹æ¨¡å‹çš„å½±å“ï¼Œå› æ­¤å…·æœ‰é²æ£’æ€§ã€‚</li>
</ol>
<p>ä»£ä»·å‡½æ•°Cå¯å¾®ï¼Œä¸‹é¢å°±å¯ä»¥ç”¨éšæœºæ¢¯åº¦ä¸‹é™æ³•æ¥è¿­ä»£æ›´æ–°æ¨¡å‹å‚æ•°wkäº†ï¼Œå³ï¼š<br><span>$$\begin{gather*}
w_{k} \rightarrow w_{k}-\eta \frac{\partial C}{\partial w_{k}}
\end{gather*}$$</span><!-- Has MathJax --><br>Î·ä¸ºæ­¥é•¿ï¼Œä»£ä»·Cæ²¿è´Ÿæ¢¯åº¦æ–¹å‘å˜åŒ–ï¼š<br><span>$$\begin{gather*}
\Delta C=\sum_{k} \frac{\partial C}{\partial w_{k}} \Delta w_{k}=\sum_{k} \frac{\partial C}{\partial w_{k}}\left(\eta \frac{\partial C}{\partial w_{k}}\right)=-\eta \sum_{k}\left(\frac{\partial C}{\partial w_{k}}\right)^{2}&lt;0
\end{gather*}$$</span><!-- Has MathJax --><br>è¿™è¡¨æ˜æ²¿è´Ÿæ¢¯åº¦æ–¹å‘æ›´æ–°å‚æ•°ç¡®å®å¯ä»¥é™ä½æ€»ä»£ä»·ã€‚<br>éšæœºæ¢¯åº¦ä¸‹é™æ³•æ—¶ï¼Œæœ‰ï¼š<br><span>$$\begin{gather*}
\begin{aligned}
\frac{\partial C}{\partial w_{k}} &amp;=\frac{\partial C}{\partial s_{i}} \frac{\partial s_{i}}{\partial w_{k}}+\frac{\partial C}{\partial s_{j}} \frac{\partial s_{j}}{\partial w_{k}}=\sigma\left(\frac{1}{2}\left(1-S_{i j}\right)-\frac{1}{1+e^{\sigma\left(s_{i}-s_{j}\right)}}\right)\left(\frac{\partial s_{i}}{\partial w_{k}}-\frac{\partial s_{j}}{\partial w_{k}}\right) \\
&amp;=\lambda_{i j}\left(\frac{\partial s_{i}}{\partial w_{k}}-\frac{\partial s_{j}}{\partial w_{k}}\right)
\end{aligned}
\end{gather*}$$</span><!-- Has MathJax --><br>å…¶ä¸­ï¼š<br><span>$$\begin{gather*}
\lambda_{i j} \equiv \frac{\partial C\left(s_{i}-s_{j}\right)}{\partial s_{i}}=\sigma\left(\frac{1}{2}\left(1-S_{i j}\right)-\frac{1}{1+e^{\sigma\left(s_{i}-s_{j}\right)}}\right)
\end{gather*}$$</span><!-- Has MathJax --><br>ä¸Šé¢çš„æ˜¯å¯¹äºæ¯ä¸€å¯¹pairéƒ½ä¼šè¿›è¡Œä¸€æ¬¡æƒé‡çš„æ›´æ–°ï¼Œå…¶å®æ˜¯å¯ä»¥å¯¹åŒä¸€ä¸ªqueryä¸‹çš„æ‰€æœ‰æ–‡æ¡£pairå…¨éƒ¨å¸¦å…¥ç¥ç»ç½‘ç»œè¿›è¡Œå‰å‘é¢„æµ‹ï¼Œç„¶åè®¡ç®—æ€»å·®åˆ†å¹¶è¿›è¡Œè¯¯å·®åå‘åé¦ˆï¼Œè¿™æ ·å°†å¤§å¤§å‡å°‘è¯¯å·®åå‘ä¼ æ’­çš„æ¬¡æ•°ï¼ŒåŠ é€ŸRankNetè®­ç»ƒè¿‡ç¨‹ï¼Œå³åˆ©ç”¨æ‰¹å¤„ç†çš„æ¢¯åº¦ä¸‹é™æ³•ï¼š<br><span>$$\begin{gather*}
\frac{\partial C}{\partial w_{k}}=\sum_{(i, j) \in I}\left(\frac{\partial C_{i j}}{\partial s_{i}} \frac{\partial s_{i}}{\partial w_{k}}+\frac{\partial C_{i j}}{\partial s_{j}} \frac{\partial s_{j}}{\partial w_{k}}\right)
\end{gather*}$$</span><!-- Has MathJax --><br>å…¶ä¸­ï¼š<br><span>$$\begin{gather*}
\frac{\partial C_{i j}}{\partial s_{i}}=\sigma\left(\frac{1}{2}\left(1-S_{i j}\right)-\frac{1}{1+e^{\sigma\left(s_{i}-s_{j}\right)}}\right)=-\frac{\partial C_{i j}}{\partial s_{j}}
\end{gather*}$$</span><!-- Has MathJax --><br>ä»¤ï¼š<br><span>$$\begin{gather*}
\lambda_{i j}=\frac{\partial C_{i j}}{\partial s_{i}}=\sigma\left(\frac{1}{2}\left(1-S_{i j}\right)-\frac{1}{1+e^{o\left(s_{i}-s_{j}\right)}}\right)
\end{gather*}$$</span><!-- Has MathJax --><br>æœ‰ï¼š<br><span>$$\begin{gather*}
\begin{aligned}
\frac{\partial C}{\partial w_{k}} &amp;=\sum_{(i, j) \in I} \sigma\left(\frac{1}{2}\left(1-S_{i j}\right)-\frac{1}{1+e^{\sigma\left(s_{i}-s_{j}\right)}}\right)\left(\frac{\partial s_{i}}{\partial w_{k}}-\frac{\partial s_{j}}{\partial w_{k}}\right) \\
&amp;=\sum_{(i, j) \in I} \lambda_{i j}\left(\frac{\partial s_{i}}{\partial w_{k}}-\frac{\partial s_{j}}{\partial w_{k}}\right) \\
&amp;=\sum_{i} \lambda_{i} \frac{\partial s_{i}}{\partial w_{k}}
\end{aligned}
\end{gather*}$$</span><!-- Has MathJax --></p>
<p>å¦‚ä½•ç†è§£ä¸Šå¼æœ€åä¸€æ­¥çš„åŒ–ç®€åŠÎ»içš„æ„ä¹‰å‘¢ï¼Ÿå‰é¢è®²è¿‡é›†åˆIä¸­åªåŒ…å«labelä¸åŒçš„docçš„é›†åˆï¼Œä¸”æ¯ä¸ªpairä»…åŒ…å«ä¸€æ¬¡ï¼Œå³(Ui,Uj)ä¸(Uj,Ui)ç­‰ä»·ã€‚ä¸ºæ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬å‡è®¾Iä¸­åªåŒ…å«Uiç›¸å…³æ€§å¤§äºUjçš„pair(Ui,Uj)ï¼Œå³Iä¸­çš„pairå‡æ»¡è¶³Sij=1ï¼Œé‚£ä¹ˆï¼š<br><span>$$\begin{gather*}
\lambda_{i}=\sum_{j:(i, j) \in I} \lambda_{i j}-\sum_{k:(k, i) \in I} \lambda_{k i}
\end{gather*}$$</span><!-- Has MathJax --><br>ä¸¾ä¾‹è¯´æ˜ï¼Œå‡è®¾æœ‰ä¸‰ä¸ªdocï¼Œå…¶çœŸå®ç›¸å…³æ€§æ»¡è¶³U1&gt;U2&gt;U3ï¼Œé‚£ä¹ˆé›†åˆIä¸­å°±åŒ…å«{(1,2), (1,3), (2,3)}å…±ä¸‰ä¸ªpairï¼Œåˆ™ï¼š<br><span>$$\begin{gather*}
\frac{\partial C}{\partial w_{k}}=\left(\lambda_{12} \frac{\partial s_{1}}{\partial w_{k}}-\lambda_{12} \frac{\partial s_{2}}{\partial w_{k}}\right)+\left(\lambda_{13} \frac{\partial s_{1}}{\partial w_{k}}-\lambda_{13} \frac{\partial s_{3}}{\partial w_{k}}\right)+\left(\lambda_{23} \frac{\partial s_{2}}{\partial w_{k}}-\lambda_{23} \frac{\partial s_{3}}{\partial w_{k}}\right)
\end{gather*}$$</span><!-- Has MathJax --><br>æ˜¾ç„¶Î»1=Î»12+Î»13ï¼ŒÎ»2=Î»23âˆ’Î»12ï¼ŒÎ»3=âˆ’Î»13âˆ’Î»23ã€‚<br><strong><em>Î»iå†³å®šç€ç¬¬iä¸ªdocåœ¨è¿­ä»£ä¸­çš„ç§»åŠ¨æ–¹å‘å’Œå¹…åº¦ï¼ŒçœŸå®çš„æ’åœ¨Uiå‰é¢çš„docè¶Šå°‘ï¼Œæ’åœ¨Uiåé¢çš„docè¶Šå¤šï¼Œé‚£ä¹ˆæ–‡æ¡£Uiå‘å‰ç§»åŠ¨çš„å¹…åº¦å°±è¶Šå¤§ã€‚</em></strong><br>å¦‚ä½•ç†è§£å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ç»“åˆæŸå¤±å‡½æ•°Cçš„å›¾åƒæ¥çœ‹ï¼Œç¬¬iä¸ªdocä¸queryè¶Šç›¸å…³ï¼ŒÎ»iè¶Šå¤§ï¼Œåˆ™wkå˜åŒ–è¶Šå¤§ï¼ŒæŸå¤±å‡½æ•°Cå‡å°‘è¶Šå¤šï¼Œè€ŒæŸå¤±å‡½æ•°Cçš„å›¾åƒåœ¨Sij=1æ—¶è¶Šå°ï¼Œsi-sjè¶Šå¤§ï¼Œè¡¨æ˜æ¨¡å‹è¾“å‡ºçš„æ–‡æ¡£içš„åˆ†æ•°ä¸æ–‡æ¡£jåˆ†æ•°ç›¸å·®è¶Šå¤§ï¼Œå³æ–‡æ¡£Uiå‘å‰ç§»åŠ¨çš„å¹…åº¦å°±è¶Šå¤§ã€‚</p>
<h4 id="GBrank"><a href="#GBrank" class="headerlink" title="GBrank"></a>GBrank</h4><p><strong><em>åŸºæœ¬æ€æƒ³ï¼šå¯¹ä¸¤ä¸ªå…·æœ‰relative relevance judgmentçš„Documentsï¼Œåˆ©ç”¨pairwiseçš„æ–¹å¼æ„é€ ä¸€ä¸ªç‰¹æ®Šçš„ loss functionï¼Œå†ä½¿ç”¨GBDTçš„æ–¹æ³•æ¥å¯¹æ­¤loss functionè¿›è¡Œä¼˜åŒ–ï¼Œæ±‚è§£å…¶æå°å€¼ã€‚</em></strong><br>GBRankçš„åˆ›æ–°ç‚¹ä¹‹ä¸€å°±åœ¨äºæ„é€ ä¸€ä¸ªç‰¹æ®Šçš„loss functionã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ„é€ pairï¼Œå³åœ¨åŒä¸€ä¸ªqueryä¸‹æœ‰ä¸¤ä¸ªdocï¼Œå¯ä»¥é€šè¿‡äººå·¥æ ‡æ³¨æˆ–è€…æœç´¢æ—¥å¿—æ¥å¯¹è¿™ä¸¤ä¸ªdocä¸è¯¥queryçš„ç›¸å…³ç¨‹åº¦è¿›è¡Œåˆ¤æ–­ï¼Œå¾—åˆ°ä¸€ä¸ªpairå…³ç³»ï¼Œå³å…¶ä¸­ä¸€ä¸ªdocçš„ç›¸å…³ç¨‹åº¦è¦æ¯”å¦ä¸€ä¸ªdocçš„ç›¸å…³ç¨‹åº¦æ›´é«˜ï¼Œè¿™å°±æ˜¯relative relevance judgmentã€‚ä¸€æ—¦æˆ‘ä»¬æœ‰äº†è¿™ä¸ªpairwiseçš„ç›¸å¯¹å…³ç³»ï¼Œé—®é¢˜å°±æˆäº†å¦‚ä½•åˆ©ç”¨è¿™äº›doc pairå­¦ä¹ å‡ºä¸€ä¸ªæ’åºæ¨¡å‹ã€‚<br>å‡è®¾æˆ‘ä»¬æœ‰ä»¥ä¸‹çš„preference pairs ä½œä¸ºtraining dataï¼š<br><span>$$\begin{gather*}
\left\{\left(x_{i}^{(1)}, x_{i}^{(2)}\right), x_{i}^{(1)}&gt;x_{i}^{(2)}\right\}_{i=1}^{N}
\end{gather*}$$</span><!-- Has MathJax --><br>åˆ™å¯æ„é€ æŸå¤±å‡½æ•°L(f)ï¼Œä¸SVMä¸­hinge lossç±»ä¼¼:<br><span>$$\begin{gather*}
L(f)=\frac{1}{2} \sum_{i=1}^{N}\left(\max \left\{0, \tau-\left(f\left(x_{i}^{(1)}\right)-f\left(x_{i}^{(2)}\right)\right\}\right)^{2}\right.
\end{gather*}$$</span><!-- Has MathJax --><br>åœ¨hinge lossçš„åŸºç¡€ä¸Šï¼Œå°†åŸæ¥ä¸º1çš„å‚æ•°æ”¹æˆäº†Ï„ã€‚å³å½“ä¸¤ä¸ªdocç›¸å…³åº¦å·®è·è¾¾åˆ°Ï„ä»¥ä¸Šçš„æ—¶å€™ï¼Œlossæ‰ä¸º0ã€‚è‹¥f(x)è¾“å‡ºå›ºå®šï¼Œé‚£ä¹ˆæŸå¤±å‡½æ•°æœ€å°‘ï¼Œä½†ä¸æ˜¯è®­ç»ƒç›®æ ‡ã€‚<br>ç„¶åé—®é¢˜å°±å˜æˆäº†æ€æ ·å¯¹è¿™ä¸ªloss functionè¿›è¡Œä¼˜åŒ–æ±‚è§£æå°å€¼ã€‚è¿™é‡Œä½¿ç”¨äº†GBDTçš„æ€æƒ³ï¼Œå³Functional Gradient Descentçš„æ–¹æ³•ã€‚</p>
<blockquote>
<p>åœ¨GBDTä¸­ï¼ŒFunctional Gradient Descentçš„ä½¿ç”¨ä¸ºï¼šå°†éœ€è¦æ±‚è§£çš„f(x)è¡¨ç¤ºæˆä¸€ä¸ªadditive modelï¼Œå³å°†ä¸€ä¸ªå‡½æ•°åˆ†è§£ä¸ºè‹¥å¹²ä¸ªå°å‡½æ•°çš„åŠ å’Œå½¢å¼ï¼Œè€Œè¿™æ¯ä¸ªå°å‡½æ•°çš„äº§ç”Ÿè¿‡ç¨‹æ˜¯ä¸²è¡Œç”Ÿæˆçš„ï¼Œå³æ¯ä¸ªå°å‡½æ•°éƒ½æ˜¯åœ¨æ‹Ÿåˆloss functionåœ¨å·²æœ‰çš„f(x)ä¸Šçš„æ¢¯åº¦æ–¹å‘ï¼ˆç”±äºè®­ç»ƒæ•°æ®æ˜¯æœ‰é™ä¸ªæ•°çš„ï¼Œæ‰€ä»¥f(x)æ˜¯ç¦»æ•£å€¼çš„å‘é‡ï¼Œè€Œæ­¤æ¢¯åº¦æ–¹å‘ä¹Ÿè¡¨ç¤ºæˆä¸€ä¸ªç¦»æ•£å€¼çš„å‘é‡ï¼‰ï¼Œç„¶åå°†æ‹Ÿåˆçš„ç»“æœå‡½æ•°è¿›ä¸€æ­¥æ›´æ–°åˆ°f(x)ä¸­ï¼Œå½¢æˆä¸€ä¸ªæ–°çš„f(x)ã€‚</p>
</blockquote>
<p>å¯¹äºloss functionï¼Œåˆ©ç”¨Functional Gradient Descentçš„æ–¹æ³•ä¼˜åŒ–ä¸ºæå°å€¼çš„è¿‡ç¨‹ä¸ºï¼šå°†f(x)è¡¨ç¤ºæˆadditive modelï¼Œæ¯æ¬¡è¿­ä»£çš„æ—¶å€™ï¼Œç”¨ä¸€ä¸ªregression treeæ¥æ‹Ÿåˆloss functionåœ¨å½“å‰f(x)ä¸Šçš„æ¢¯åº¦æ–¹å‘ã€‚æ­¤æ—¶ç”±äºè®­ç»ƒæ•°æ®æ˜¯æœ‰é™ä¸ªæ•°çš„ï¼Œf(x)åŒæ ·åªæ˜¯ä¸€ç³»åˆ—ç¦»æ•£å€¼ï¼Œæ¢¯åº¦å‘é‡ä¹Ÿæ˜¯ä¸€ç³»åˆ—ç¦»æ•£å€¼ï¼Œåˆ™å¯ä½¿ç”¨regression treeæ¥æ‹Ÿåˆè¿™ä¸€ç³»åˆ—ç¦»æ•£å€¼ã€‚<br>ä½†ä¸åŒä¹‹å¤„åœ¨äºï¼Œç”±äºä½¿ç”¨pairwiseæ–¹æ³•ï¼Œè¿™é‡Œçš„loss functionä¸­ï¼Œæœ‰ä¸¤ä¸ªä¸ä¸€æ ·çš„f(x)çš„ç¦»æ•£å€¼ï¼Œæ‰€ä»¥æ¯æ¬¡æˆ‘ä»¬éœ€è¦å¯¹f(x)åœ¨è¿™ä¸¤ä¸ªç‚¹ä¸Šçš„å€¼éƒ½è¿›è¡Œæ›´æ–°ï¼Œå³éœ€è¦å¯¹ä¸€ä¸ªtraining instanceè®¡ç®—ä¸¤ä¸ªæ¢¯åº¦æ–¹å‘ã€‚é¦–å…ˆå°†ä»¥ä¸‹ä¸¤ä¸ªå˜é‡çœ‹ä½œæœªçŸ¥å˜é‡ï¼š<br><span>$$\begin{gather*}
f\left(x_{i}^{(1)}\right), \quad f\left(x_{i}^{(2)}\right), \quad i=1, \cdots, N
\end{gather*}$$</span><!-- Has MathJax --><br>ç„¶åæ±‚è§£loss functionå¯¹è¿™ä¸¤ä¸ªæœªçŸ¥å˜é‡çš„æ¢¯åº¦ï¼ˆåˆ†åˆ«å¯¹ä¸¤ä¸ªæœªçŸ¥å˜é‡æ±‚å¯¼ï¼‰ï¼Œå¦‚ä¸‹ï¼š<br><span>$$\begin{gather*}
-\max \left\{0, f\left(x_{i}^{(2)}\right)-f\left(x_{i}^{(1)}\right)+\tau\right\}, \quad \max \left\{0, f\left(x_{i}^{(2)}\right)-f\left(x_{i}^{(1)}\right)+\tau\right\}, \quad i=1, \cdots, N
\end{gather*}$$</span><!-- Has MathJax --><br>å¦‚æœä¸¤ä¸ªå˜é‡ä¹‹å·®å¤§äº0ï¼Œåˆ™æ­¤æ—¶å¯¹åº”çš„lossä¸º0ï¼Œæˆ‘ä»¬æ— éœ€å¯¹f(x)è¿›è¡Œè¿­ä»£æ›´æ–°ï¼›åä¹‹lossä¸ä¸º0ï¼Œæˆ‘ä»¬éœ€è¦å¯¹f(x)è¿›è¡Œè¿­ä»£æ›´æ–°ï¼Œå³ä½¿å¾—æ–°çš„f(x)åœ¨è¿™ä¸ªinstanceä¸Šçš„ä¸¤ä¸ªç‚¹çš„é¢„æµ‹å€¼èƒ½å¤Ÿæ›´æ¥è¿‘çœŸå®å€¼ã€‚f(x)æ›´æ–°ç±»ä¼¼äºæ¢¯åº¦ä¸‹é™æ–¹æ³•ä¸­å‚æ•°çš„æ›´æ–°ï¼š<br><span>$$\begin{gather*}
f_{k}(x)=f_{k-1}(x)-\eta \nabla L\left(f_{k}(x)\right)
\end{gather*}$$</span><!-- Has MathJax --><br>pairwiseæ–¹æ³•ä¸­ï¼Œå…·ä½“ä¸ºï¼š<br><span>$$\begin{gather*}
\begin{aligned}
&amp;f_{k}\left(x_{i}^{(1)}\right)=f_{k-1}\left(x_{i}^{(1)}\right)+\eta\left(f_{k-1}\left(x_{i}^{(2)}\right)-f_{k-1}\left(x_{i}^{(1)}\right)+\tau\right)\\
&amp;f_{k}\left(x_{i}^{(2)}\right)=f_{k-1}\left(x_{i}^{(2)}\right)-\eta\left(f_{k-1}\left(x_{i}^{(2)}\right)-f_{k-1}\left(x_{i}^{(1)}\right)+\tau\right)
\end{aligned}
\end{gather*}$$</span><!-- Has MathJax --><br>å½“å­¦ä¹ é€Ÿç‡Î·ç­‰äº1çš„æ—¶å€™ï¼Œæ›´æ–°å…¬å¼å³ä¸ºï¼š<br><span>$$\begin{gather*}
\begin{aligned}
&amp;f_{k}\left(x_{i}^{(1)}\right)=f_{k-1}\left(x_{i}^{(2)}\right)+\tau\\
&amp;f_{k}\left(x_{i}^{(2)}\right)=f_{k-1}\left(x_{i}^{(1)}\right)-\tau
\end{aligned}
\end{gather*}$$</span><!-- Has MathJax --><br>å½“æˆ‘ä»¬æ”¶é›†åˆ°æ‰€æœ‰losså€¼ä¸ä¸º0çš„training instanceåï¼Œæˆ‘ä»¬ä¾¿å¾—åˆ°äº†å…¶å¯¹åº”çš„æ›´æ–°å€¼ï¼š<br><span>$$\begin{gather*}
\left\{\left(x_{i}^{(1)}, f_{k-1}\left(x_{i}^{(2)}\right)+\tau\right),\left(x_{i}^{(2)}, f_{k-1}\left(x_{i}^{(1)}\right)-\tau\right)\right\}
\end{gather*}$$</span><!-- Has MathJax --><br>æ¥ç€ï¼Œä½¿ç”¨ä¸€æ£µregression treeå¯¹è¿™äº›æ•°æ®è¿›è¡Œæ‹Ÿåˆï¼Œç”Ÿæˆä¸€ä¸ªæ‹Ÿåˆå‡½æ•°$g_{k}(x)$ï¼Œç„¶åå°†è¿™æ¬¡è¿­ä»£æ›´æ–°çš„æ‹Ÿåˆå‡½æ•°æ›´æ–°åˆ°f(x)ä¸­ï¼Œæ­¤å¤„é‡‡ç”¨çº¿æ€§å åŠ çš„æ–¹å¼ï¼š<br><span>$$\begin{gather*}
f_{k}(x)=\frac{k f_{k-1}(x)+\beta g_{k}(x)}{k+1}
\end{gather*}$$</span><!-- Has MathJax --><br>å…¶ä¸­ï¼ŒÃŸä¸ºshrinkingç³»æ•°ã€‚<br>ä¸ºä»€ä¹ˆåœ¨æ¯æ¬¡è¿­ä»£æ›´æ–°çš„æ—¶å€™ï¼Œæ–°çš„regression treeä¸åƒGBDTä¸­é‚£æ ·ï¼Œçº¯ç²¹åœ°å»æ‹Ÿåˆæ¢¯åº¦æ–¹å‘ï¼ˆä¸€ä¸ªç¦»æ•£å€¼çš„å‘é‡ï¼‰ï¼Œè€Œæ˜¯å»æ‹Ÿåˆï¼š<br><span>$$\begin{gather*}
f_{k}(x)=f_{k-1}(x)-\eta \nabla L\left(f_{k}(x)\right)
\end{gather*}$$</span><!-- Has MathJax --><br>è¿™æ ·ä¸€ä¸ª åŸå§‹é¢„æµ‹å€¼+æ¢¯åº¦æ›´æ–°å€¼ åçš„æ–°é¢„æµ‹å€¼å‘é‡å‘¢ï¼Ÿ<br>å› ä¸ºåœ¨æ¯æ¬¡è¿­ä»£æ›´æ–°çš„æ—¶å€™ï¼Œåªæ˜¯å–äº†éƒ¨åˆ†è®­ç»ƒæ•°æ®ï¼ˆå³æ‰€æœ‰losså€¼ä¸ä¸º0çš„training instanceä¸­çš„doc pairï¼‰ï¼Œæ‰€ä»¥æ¯æ¬¡æ‹Ÿåˆçš„æ—¶å€™ï¼Œéƒ½åªæ˜¯å¯¹è¿™éƒ¨åˆ†æ•°æ®è¿›è¡Œè®­ç»ƒï¼Œå¾—åˆ°ä¸€ä¸ªregression treeï¼Œç„¶åæŠŠè¿™ä¸ªæ–°çš„æ‹Ÿåˆå‡½æ•°ï¼ˆå³regression treeï¼‰æ·»åŠ åˆ°æ€»çš„é¢„æµ‹å‡½æ•°f(x)ä¸­å»ï¼Œå³è¿™ä¸ªregression treeåœ¨é¢„æµ‹æ—¶å€™æ˜¯éœ€è¦å¯¹æ‰€æœ‰è®­ç»ƒæ•°æ®ï¼Œè€Œä¸æ˜¯éƒ¨åˆ†æ•°æ®ï¼Œè¿›è¡Œé¢„æµ‹çš„ã€‚æ‰€ä»¥å¦‚æœæ¯æ¬¡è¿­ä»£æ˜¯å»æ‹Ÿåˆæ¢¯åº¦çš„è¯ï¼ˆæ¢¯åº¦æ–¹å‘å®Œå…¨æœ‰å¯èƒ½ä¸å½“å‰çš„f(x)å‘é‡æ–¹å‘ç›¸å·®å¾ˆå¤§ï¼‰ï¼Œåœ¨é¢„æµ‹çš„æ—¶å€™ï¼Œè¿™ä¸ªregression treeå¯¹å…¶ä½™æ•°æ®ï¼ˆå¹¶æ²¡æœ‰å‚ä¸è¿™ä¸ªregression treeè®­ç»ƒçš„æ•°æ®ï¼‰çš„é¢„æµ‹å€¼ä¼šåç¦»å®ƒä»¬åŸå§‹å€¼è¾ƒå¤šï¼Œè€Œä¸”è¿™ä¸ªåç¦»æ˜¯ä¸åœ¨æœŸæœ›ä¹‹ä¸­çš„ï¼Œå› ä¸ºè¿™äº›æ•°æ®çš„å½“å‰é¢„æµ‹å€¼å·²ç»ç›¸å¯¹é è°±äº†ï¼ˆä¸ä¼šå¯¹loss functionæœ‰è´¡çŒ®ï¼‰ã€‚æ‰€ä»¥ï¼Œå½“æ¯æ¬¡æ‹Ÿåˆçš„ç›®æ ‡æ˜¯ åŸå§‹f(x)å‘é‡ + æ¢¯åº¦å‘é‡ çš„æ—¶å€™ï¼Œè¿™ä¸ªæ–°çš„å‘é‡ä¸ä¼šè·‘çš„å¤ªåï¼ˆå³è·ŸåŸå§‹å‘é‡ç›¸å·®è¾ƒå°ï¼‰ï¼Œè¿™æ—¶å€™æ‹Ÿåˆå‡ºæ¥çš„ç»“æœregression treeåœ¨å¯¹æ•´ä½“æ•°æ®è¿›è¡Œé¢„æµ‹çš„æ—¶å€™ï¼Œä¹Ÿä¸ä¼šè·‘çš„å¤ªåï¼Œåªæ˜¯ä¼šæ ¹æ®æ¢¯åº¦æ–¹å‘ç¨å¾®æœ‰æ‰€æ”¹å˜ï¼Œå¯¹å…¶å®ƒå¹¶ä¸éœ€è¦æ›´æ–°çš„æ•°æ®çš„å½±å“ä¹Ÿç›¸å¯¹è¾ƒå°ã€‚ä½†åŒæ—¶ä¹Ÿåœ¨é€æ¸æœç€æ•´ä½“çš„ä¼˜åŒ–æ–¹å‘ä¸Šå»å°è¯•ï¼Œæ‰€ä»¥æ‰ä¼šè¿™ä¹ˆå»åšã€‚ï¼ˆä»¥ä¸€ä¸ªé˜Ÿä¼åœ¨å±±å³°é—´ç§»åŠ¨ï¼Œåˆ†åˆ«å¯»æ‰¾å„è‡ªåˆé€‚ä½ç½®ä¸ºä¾‹ï¼‰ã€‚</p>
<h4 id="LambdaRank"><a href="#LambdaRank" class="headerlink" title="LambdaRank"></a>LambdaRank</h4><p>RankNetä»¥é”™è¯¯pairæœ€å°‘ä¸ºä¼˜åŒ–ç›®æ ‡çš„RankNetç®—æ³•ï¼Œç„¶è€Œè®¸å¤šæ—¶å€™ä»…ä»¥é”™è¯¯pairæ•°æ¥è¯„ä»·æ’åºçš„å¥½åæ˜¯ä¸å¤Ÿçš„ï¼ŒåƒNDCGæˆ–è€…ERRç­‰è¯„ä»·æŒ‡æ ‡å°±åªå…³æ³¨top kä¸ªç»“æœçš„æ’åºï¼Œå½“æˆ‘ä»¬é‡‡ç”¨RankNetç®—æ³•æ—¶ï¼Œå¾€å¾€æ— æ³•ä»¥è¿™äº›æŒ‡æ ‡ä¸ºä¼˜åŒ–ç›®æ ‡è¿›è¡Œè¿­ä»£ï¼Œæ‰€ä»¥RankNetçš„ä¼˜åŒ–ç›®æ ‡å’ŒIRè¯„ä»·æŒ‡æ ‡ä¹‹é—´è¿˜æ˜¯å­˜åœ¨gapçš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img width="500" src="/images/search_lambdaRank.png"><br>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ¯ä¸ªçº¿æ¡è¡¨ç¤ºæ–‡æ¡£ï¼Œè“è‰²è¡¨ç¤ºç›¸å…³æ–‡æ¡£ï¼Œç°è‰²è¡¨ç¤ºä¸ç›¸å…³æ–‡æ¡£ï¼ŒRankNetä»¥pairwise errorçš„æ–¹å¼è®¡ç®—costï¼Œå·¦å›¾çš„costä¸º13ï¼Œå³å›¾é€šè¿‡æŠŠç¬¬ä¸€ä¸ªç›¸å…³æ–‡æ¡£ä¸‹è°ƒ3ä¸ªä½ç½®ï¼Œç¬¬äºŒä¸ªæ–‡æ¡£ä¸Šæ¡5ä¸ªä½ç½®ï¼Œå°†costé™ä¸º11ï¼Œä½†æ˜¯åƒNDCGæˆ–è€…ERRç­‰è¯„ä»·æŒ‡æ ‡åªå…³æ³¨top kä¸ªç»“æœçš„æ’åºï¼Œåœ¨ä¼˜åŒ–è¿‡ç¨‹ä¸­ä¸‹è°ƒå‰é¢ç›¸å…³æ–‡æ¡£çš„ä½ç½®ä¸æ˜¯æˆ‘ä»¬æƒ³è¦å¾—åˆ°çš„ç»“æœã€‚å›¾ 1å³å›¾å·¦è¾¹é»‘è‰²çš„ç®­å¤´è¡¨ç¤ºRankNetä¸‹ä¸€è½®çš„è°ƒåºæ–¹å‘å’Œå¼ºåº¦ï¼Œä½†æˆ‘ä»¬çœŸæ­£éœ€è¦çš„æ˜¯å³è¾¹çº¢è‰²ç®­å¤´ä»£è¡¨çš„æ–¹å‘å’Œå¼ºåº¦ï¼Œå³æ›´å…³æ³¨é å‰ä½ç½®çš„ç›¸å…³æ–‡æ¡£çš„æ’åºä½ç½®çš„æå‡ã€‚LambdaRankæ­£æ˜¯åŸºäºè¿™ä¸ªæ€æƒ³æ¼”åŒ–è€Œæ¥ï¼Œå…¶ä¸­LambdaæŒ‡çš„å°±æ˜¯çº¢è‰²ç®­å¤´ï¼Œä»£è¡¨ä¸‹ä¸€æ¬¡è¿­ä»£ä¼˜åŒ–çš„æ–¹å‘å’Œå¼ºåº¦ï¼Œä¹Ÿå°±æ˜¯æ¢¯åº¦ã€‚<br>LambdaRankåœ¨RankNetçš„åŠ é€Ÿç®—æ³•å½¢å¼çš„åŸºç¡€ä¸Šå¼•å…¥è¯„ä»·æŒ‡æ ‡Z ï¼ˆå¦‚NDCGã€ERRç­‰ï¼‰ï¼ŒæŠŠäº¤æ¢ä¸¤ä¸ªæ–‡æ¡£çš„ä½ç½®å¼•èµ·çš„è¯„ä»·æŒ‡æ ‡çš„å˜åŒ–|Î”NDCG|ï¼Œä½œä¸ºå…¶ä¸­ä¸€ä¸ªå› å­ï¼Œå®éªŒè¡¨æ˜å¯¹æ¨¡å‹æ•ˆæœæœ‰æ˜¾è‘—çš„æå‡ï¼š<br><span>$$\begin{gather*}
\lambda_{i j}=\frac{\partial C\left(s_{i}-s_{j}\right)}{\partial s_{i}}=\frac{-\sigma}{1+e^{\sigma\left(s_{i}-s_{j}\right)}}\left|\Delta_{N D C G}\right|
\end{gather*}$$</span><!-- Has MathJax --><br>Î”NDCGè¡¨ç¤ºå°†Uiå’ŒUjè¿›è¡Œäº¤æ¢ï¼Œäº¤æ¢åæ’åºçš„NDCGä¸äº¤æ¢å‰æ’åºçš„NDCGçš„å·®å€¼ã€‚<br>æŸå¤±å‡½æ•°çš„æ¢¯åº¦ä»£è¡¨äº†æ–‡æ¡£ä¸‹ä¸€æ¬¡è¿­ä»£ä¼˜åŒ–çš„æ–¹å‘å’Œå¼ºåº¦ï¼Œç”±äºå¼•å…¥äº†IRè¯„ä»·æŒ‡æ ‡ï¼ŒLambdaæ¢¯åº¦æ›´å…³æ³¨ä½ç½®é å‰çš„ä¼˜è´¨æ–‡æ¡£çš„æ’åºä½ç½®çš„æå‡ã€‚æœ‰æ•ˆçš„é¿å…äº†ä¸‹è°ƒä½ç½®é å‰ä¼˜è´¨æ–‡æ¡£çš„ä½ç½®è¿™ç§æƒ…å†µçš„å‘ç”Ÿã€‚LambdaRankç›¸æ¯”RankNetçš„ä¼˜åŠ¿åœ¨äºåˆ†è§£å› å¼åè®­ç»ƒé€Ÿåº¦å˜å¿«ï¼ŒåŒæ—¶è€ƒè™‘äº†è¯„ä»·æŒ‡æ ‡ï¼Œç›´æ¥å¯¹é—®é¢˜æ±‚è§£ï¼Œæ•ˆæœæ›´æ˜æ˜¾ã€‚</p>
<h4 id="LambdaMART"><a href="#LambdaMART" class="headerlink" title="LambdaMART"></a>LambdaMART</h4><ol>
<li>Martï¼ˆMultiple Additive Regression Treeï¼ŒMartå°±æ˜¯GBDTï¼‰ï¼Œå®šä¹‰äº†ä¸€ä¸ªæ¡†æ¶ï¼Œç¼ºå°‘ä¸€ä¸ªæ¢¯åº¦ã€‚</li>
<li>LambdaRanké‡æ–°å®šä¹‰äº†æ¢¯åº¦ï¼Œèµ‹äºˆäº†æ¢¯åº¦æ–°çš„ç‰©ç†æ„ä¹‰ã€‚</li>
</ol>
<p>å› æ­¤ï¼Œæ‰€æœ‰å¯ä»¥ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•æ±‚è§£çš„æ¨¡å‹éƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ¢¯åº¦ï¼ŒMARTå°±æ˜¯å…¶ä¸­ä¸€ç§ï¼Œå°†æ¢¯åº¦Lambdaå’ŒMARTç»“åˆå°±æ˜¯å¤§åé¼é¼çš„LambdaMARTã€‚<br>MARTçš„åŸç†æ˜¯ç›´æ¥åœ¨å‡½æ•°ç©ºé—´å¯¹å‡½æ•°è¿›è¡Œæ±‚è§£ï¼Œæ¨¡å‹ç»“æœç”±è®¸å¤šæ£µæ ‘ç»„æˆï¼Œæ¯æ£µæ ‘çš„æ‹Ÿåˆç›®æ ‡æ˜¯æŸå¤±å‡½æ•°çš„æ¢¯åº¦ï¼Œåœ¨LambdaMARTä¸­å°±æ˜¯Lambdaã€‚LambdaMARTçš„å…·ä½“ç®—æ³•è¿‡ç¨‹å¦‚ä¸‹ï¼š<br><img width="700" src="/images/search_lambdaMart.png"><br>å¯ä»¥çœ‹å‡ºLambdaMARTçš„æ¡†æ¶å…¶å®å°±æ˜¯MARTï¼Œä¸»è¦çš„åˆ›æ–°åœ¨äºä¸­é—´è®¡ç®—çš„æ¢¯åº¦ä½¿ç”¨çš„æ˜¯Lambdaï¼Œæ˜¯pairwiseçš„ã€‚MARTéœ€è¦è®¾ç½®çš„å‚æ•°åŒ…æ‹¬ï¼šæ ‘çš„æ•°é‡Mã€å¶å­èŠ‚ç‚¹æ•°Lå’Œå­¦ä¹ ç‡vï¼Œè¿™3ä¸ªå‚æ•°å¯ä»¥é€šè¿‡éªŒè¯é›†è°ƒèŠ‚è·å–æœ€ä¼˜å‚æ•°ã€‚</p>
<p>MARTè¾“å‡ºå€¼çš„è®¡ç®—ï¼š</p>
<ol>
<li><p>é¦–å…ˆè®¾ç½®æ¯æ£µæ ‘çš„æœ€å¤§å¶å­æ•°ï¼ŒåŸºåˆ†ç±»å™¨é€šè¿‡æœ€å°å¹³æ–¹æŸå¤±è¿›è¡Œåˆ†è£‚ï¼Œè¾¾åˆ°æœ€å¤§å¶å­æ•°é‡æ—¶åœæ­¢åˆ†è£‚</p>
</li>
<li><p>ä½¿ç”¨ç‰›é¡¿æ³•å¾—åˆ°å¶å­çš„è¾“å‡ºï¼Œè®¡ç®—æ•ˆç”¨å‡½æ•°å¯¹æ¨¡å‹å¾—åˆ†çš„äºŒé˜¶å¯¼<span>$\frac{\partial \lambda_{i}}{\partial s_{i}}=\frac{\partial^{2} C}{\partial^{2} s_{i}}$</span><!-- Has MathJax --></p>
<span>$$\begin{gather*}

\frac{\partial^{2} C}{\partial^{2} s_{i}}=\sum_{\{i, j\} \rightleftharpoons I} \sigma^{2}\left|\triangle Z_{i j}\right| \rho_{i j}\left(1-\rho_{i j}\right)&NegativeMediumSpace;

\end{gather*}$$</span><!-- Has MathJax -->
</li>
<li><p>å¾—åˆ°ç¬¬mé¢—æ ‘çš„ç¬¬kä¸ªå¶å­çš„è¾“å‡ºå€¼:</p>
<span>$$\begin{gather*}

\gamma_{k m}=\frac{\sum_{x_{i} \in R_{k m}} \frac{\partial C}{\partial s_{i}}}{\sum_{x_{i} \in R_{k m}} \frac{\partial^{2} C}{\partial^{2} s_{i}}}=\frac{-\sum_{x_{i} \in R_{k m}} \sum_{\{i, j\} \rightleftharpoons I}\left|\triangle Z_{i j}\right| \rho_{i j}}{\sum_{x_{i} \in R_{k m}} \sum_{\{i, j\} \rightleftharpoons I}\left|\Delta Z_{i j}\right| \sigma \rho_{i j}\left(1-\rho_{i j}\right)}&NegativeMediumSpace;

\end{gather*}$$</span><!-- Has MathJax -->
</li>
<li><p><span>$x_i$</span><!-- Has MathJax -->ä¸ºç¬¬iä¸ªæ ·æœ¬ï¼Œ<span>$x_{i} \in R_{k m}$</span><!-- Has MathJax -->æ„å‘³ç€è½å…¥è¯¥å¶å­çš„æ ·æœ¬ï¼Œè¿™äº›æ ·æœ¬å…±åŒå†³å®šäº†è¯¥å¶å­çš„è¾“å‡ºå€¼ã€‚</p>
</li>
</ol>
<p>LambdaMARTå…·æœ‰å¾ˆå¤šä¼˜åŠ¿ï¼š</p>
<ol>
<li>é€‚ç”¨äºæ’åºåœºæ™¯ï¼šä¸æ˜¯ä¼ ç»Ÿçš„é€šè¿‡åˆ†ç±»æˆ–è€…å›å½’çš„æ–¹æ³•æ±‚è§£æ’åºé—®é¢˜ï¼Œè€Œæ˜¯ç›´æ¥æ±‚è§£;</li>
<li>æŸå¤±å‡½æ•°å¯å¯¼ï¼šé€šè¿‡æŸå¤±å‡½æ•°çš„è½¬æ¢ï¼Œå°†ç±»ä¼¼äºNDCGè¿™ç§æ— æ³•æ±‚å¯¼çš„IRè¯„ä»·æŒ‡æ ‡è½¬æ¢æˆå¯ä»¥æ±‚å¯¼çš„å‡½æ•°ï¼Œå¹¶ä¸”èµ‹äºˆäº†æ¢¯åº¦çš„å®é™…ç‰©ç†æ„ä¹‰ï¼Œæ•°å­¦è§£é‡Šéå¸¸æ¼‚äº®;</li>
<li>å¢é‡å­¦ä¹ ï¼šç”±äºæ¯æ¬¡è®­ç»ƒå¯ä»¥åœ¨å·²æœ‰çš„æ¨¡å‹ä¸Šç»§ç»­è®­ç»ƒï¼Œå› æ­¤é€‚åˆäºå¢é‡å­¦ä¹ ;</li>
<li>ç»„åˆç‰¹å¾ï¼šå› ä¸ºé‡‡ç”¨æ ‘æ¨¡å‹ï¼Œå› æ­¤å¯ä»¥å­¦åˆ°ä¸åŒç‰¹å¾ç»„åˆæƒ…å†µ;</li>
<li>ç‰¹å¾é€‰æ‹©ï¼šå› ä¸ºæ˜¯åŸºäºMARTæ¨¡å‹ï¼Œå› æ­¤ä¹Ÿå…·æœ‰MARTçš„ä¼˜åŠ¿ï¼Œå¯ä»¥å­¦åˆ°æ¯ä¸ªç‰¹å¾çš„é‡è¦æ€§ï¼Œå¯ä»¥åšç‰¹å¾é€‰æ‹©;</li>
<li>é€‚ç”¨äºæ­£è´Ÿæ ·æœ¬æ¯”ä¾‹å¤±è¡¡çš„æ•°æ®ï¼šå› ä¸ºæ¨¡å‹çš„è®­ç»ƒå¯¹è±¡å…·æœ‰ä¸åŒlabelçš„æ–‡æ¡£pairï¼Œè€Œä¸æ˜¯é¢„æµ‹æ¯ä¸ªæ–‡æ¡£çš„labelï¼Œå› æ­¤å¯¹æ­£è´Ÿæ ·æœ¬æ¯”ä¾‹å¤±è¡¡ä¸æ•æ„Ÿã€‚</li>
</ol>
<p><strong>LambdaMARTæ˜¯ä¸æ˜¯å¾ˆå¥½æ‡‚ï¼Ÿ</strong></p>
<p><img width="300" src="/images/Emoticon1.png"></p>
<p>æœ‰è¾ƒå¤šåšå®¢ã€èµ„æ–™åœ¨æ­¤æˆ›ç„¶è€Œæ­¢ï¼Œå¥½åƒä¸Šè¿°èµ„æ–™å·²ç»è¶³å¤Ÿç†è§£LambdaMARTäº†ï¼Œè¿™ä¹Ÿè®©æˆ‘ä¸€åº¦æ€€ç–‘è‡ªå·±çš„IQï¼ŒåŸºç¡€å’Œæˆ‘ä¸€æ ·ä¸å¤ªå¥½çš„å…„å¼Ÿä»¬å¯ä»¥è¿›å…¥å¦ä¸€ç¯‡åšå®¢ï¼Œæˆ‘ä»¬ä»æå‡æ ‘ã€æ¢¯åº¦æå‡æ ‘å’Œæ¢¯åº¦æå‡å†³ç­–æ ‘è¯´èµ·ï¼Œå¹¶ç»“åˆRanklibæºç å’Œå…·ä½“çš„ä¾‹å­ï¼Œä»¥åŠå¾®è½¯çš„ç›¸å…³æŠ€æœ¯æŠ¥å‘Šä¸€èµ·æ¥çœ‹çœ‹LambdaMARTçš„<a href="">çœŸç›¸</a>ã€‚</p>
<blockquote>
<p>çˆ±å¥‡è‰ºå®è·µï¼š<br>åœ¨æ²¡æœ‰åŠ å…¥ç¨€ç–ç±»ç‰¹å¾ä¹‹å‰ï¼Œæˆ‘ä»¬çš„æ¨¡å‹æ˜¯LambdaMARTæ¨¡å‹ï¼Œåœ¨IRé¢†åŸŸæ˜¯æœ€å…ˆè¿›çš„æ¨¡å‹ï¼Œè¯¥æ¨¡å‹æ˜¯ä¸€ä¸ªgbdtæ¨¡å‹ï¼ŒåŸºäºboostingæ€æƒ³ï¼Œä¸æ–­å¢åŠ å†³ç­–æ ‘ï¼Œæ¥å‡å°æ®‹å·®ã€‚è¯¥æ¨¡å‹åœ¨å¾ˆå¤šç«èµ›ä¸­è¡¨ç°è‰¯å¥½ï¼Œå› ä¸ºä¸ç”¨è¿‡å¤šçš„ç‰¹å¾å¤„ç†ï¼Œæ ‘æ¨¡å‹ä¼šè€ƒè™‘ç‰¹å¾æœ¬èº«çš„æ•°æ®åˆ†å¸ƒï¼ŒåŒæ—¶æœ‰å¾ˆå¥½çš„å­¦ä¹ æ³›åŒ–èƒ½åŠ›ï¼Œæ ‘ç»“æ„å¾ˆéš¾å…¼å®¹é«˜ç»´ç¨€ç–ç‰¹å¾ï¼Œæ¯”æ–¹è¯´æˆ‘ä»¬çš„documentæ˜¯ä¸Šäº¿çº§çš„ç‰¹å¾ï¼Œå¾ˆéš¾æ¯ä¸ªèŠ‚ç‚¹èµ°ä¸€æ¬¡æ ‘çš„åˆ†å‰²ï¼Œæ‰€ä»¥å¯¹äºåŠ å…¥ç¨€ç–ç‰¹å¾çš„æ—¶å€™ï¼Œæ ‘æ¨¡å‹ä¼šé‡åˆ°ç“¶é¢ˆã€‚ä½†æ˜¯åœ¨å¤„ç†é«˜ç»´ç¨€ç–ç‰¹å¾çš„æ—¶å€™ï¼ŒåƒLRã€FMã€FFMå¯ä»¥è®¤ä¸ºæ˜¯çº¿æ€§æ¨¡å‹ï¼Œç‰¹å¾çš„å¢åŠ å¹¶ä¸ä¼šå¯¹æ­¤ç±»æ¨¡å‹é€ æˆå‹åŠ›ï¼Œä¸Šäº¿ç»´ä¹Ÿæ²¡å…³ç³»ã€‚LRæ¨¡å‹å¼±ç‚¹åœ¨äºç‰¹å¾ç»„åˆèƒ½åŠ›ä¸è¶³ï¼Œå¾ˆå¤šæƒ…å†µä¸‹ç‰¹å¾ç»„åˆæ–¹å¼æ¯”è¾ƒé‡è¦ï¼Œæ ‘æ¨¡å‹ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„å…¶å®æ˜¯ä¸€ç§ç»„åˆæ–¹å¼ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
</blockquote>
<p><img width="700" src="/images/search_iqiyi_lm.png"></p>
<h4 id="æ·±åº¦æ¨¡å‹"><a href="#æ·±åº¦æ¨¡å‹" class="headerlink" title="æ·±åº¦æ¨¡å‹"></a>æ·±åº¦æ¨¡å‹</h4><h5 id="DNN"><a href="#DNN" class="headerlink" title="DNN"></a>DNN</h5><p>çˆ±å¥‡è‰ºå®ç°ï¼š<br><img width="700" src="/images/search_iqiyi_dnn.jpg"><br>åº•å±‚æ˜¯queryå’Œdocumentçš„æè¿°æ–‡æœ¬åšå¤šç²’åº¦åˆ‡è¯ï¼Œä¹‹ååšembeddingååŠ æƒå¹³å‡ï¼Œå¾—åˆ°documentå’Œqueryçš„å‘é‡è¡¨è¾¾ï¼Œæ‹¼æ¥è¿™ä¸¤ç»„å‘é‡ï¼ŒåŒæ—¶å†åšç‚¹ç§¯ï¼Œï¼ˆä¸¤ä¸ªå‘é‡è¶Šæ¥è¶Šç›¸è¿‘ï¼Œæ‹¼æ¥çš„æ—¶å€™å¸Œæœ›ä¸Šå±‚ç½‘ç»œå­¦åˆ°ä¸¤ä¸ªå‘é‡çš„ç›¸ä¼¼æ€§ï¼Œéœ€è¦æœ‰è¶³å¤Ÿçš„æ ·æœ¬å’Œæ­£è´Ÿæ ·ä¾‹ï¼Œæ‰€ä»¥æˆ‘ä»¬è‡ªå·±åšäº†ç‚¹ç§¯ï¼‰ã€‚é™¤äº†å‘é‡ç‰¹å¾ï¼Œæ¨¡å‹ä¹Ÿé€‚ç”¨äº†ç¨ å¯†ç‰¹å¾ï¼Œå³åˆ©ç”¨gbdtæŠ½å–ç‰¹å¾ï¼Œä¸embeddingç‰¹å¾åšæ‹¼æ¥ï¼Œæœ€åç»è¿‡ä¸‰ä¸ªå…¨è¿æ¥å±‚ï¼Œæ¥sigmoidå‡½æ•°ï¼Œå°±å¯ä»¥å¾—åˆ°æ ·æœ¬çš„scoreï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šç”¨ndcgçš„è¡¡é‡æ ‡å‡†å»è®¡ç®—æŸå¤±ï¼Œä»è€Œåå‘ä¼˜åŒ–ç½‘ç»œç»“æ„ã€‚è€Œåœ¨onlineæœåŠ¡ä¾§ï¼Œåˆ™ç›´æ¥ç”¨æ ·æœ¬å»predictå¾—åˆ†ã€‚è¿™ä¸ªæ¨¡å‹ä¸Šçº¿ä¹‹åï¼Œæ•ˆæœéå¸¸æ˜æ˜¾ã€‚å…¶ä¸­ï¼ŒäºŒæ¬¡æœç´¢ç‡é™ä½ï¼ˆäºŒæ¬¡æœç´¢ç‡è¶Šä½è¶Šå¥½ï¼Œè¯´æ˜ç”¨æˆ·ä¸€æ¬¡æœä¸­ï¼‰ã€‚</p>
<h5 id="Wide-amp-Deep"><a href="#Wide-amp-Deep" class="headerlink" title="Wide&amp;Deep"></a>Wide&amp;Deep</h5><p>ç¾å›¢ç‚¹è¯„æ¨¡å‹æ¡†æ¶ï¼š<br><img width="700" src="/images/search_wd_structure.png"><br>ç¾å›¢ç‚¹è¯„æ¨¡å‹å…·ä½“å®ç°ï¼š<br><img width="700" src="/images/search_wd_model.png"><br>åœ¨è®­ç»ƒæ—¶ï¼Œåˆ†åˆ«å¯¹æ ·æœ¬æ•°æ®è¿›è¡Œæ¸…æ´—å’Œææƒã€‚åœ¨ç‰¹å¾æ–¹é¢ï¼Œå¯¹äºè¿ç»­ç‰¹å¾ï¼Œç”¨Min-Maxæ–¹æ³•åšå½’ä¸€åŒ–ã€‚åœ¨äº¤å‰ç‰¹å¾æ–¹é¢ï¼Œç»“åˆä¸šåŠ¡éœ€æ±‚ï¼Œæç‚¼å‡ºå¤šä¸ªåœ¨ä¸šåŠ¡åœºæ™¯æ„ä¹‰æ¯”è¾ƒé‡å¤§çš„äº¤å‰ç‰¹å¾ã€‚ç”¨Adamåšä¸ºä¼˜åŒ–å™¨ï¼Œç”¨Cross Entropyåšä¸ºæŸå¤±å‡½æ•°ã€‚åœ¨è®­ç»ƒæœŸé—´ï¼Œä¸Wide &amp; Deep Learningè®ºæ–‡ä¸­ä¸åŒä¹‹å¤„åœ¨äºï¼Œå°†ç»„åˆç‰¹å¾ä½œä¸ºè¾“å…¥å±‚åˆ†åˆ«è¾“å…¥åˆ°å¯¹åº”çš„Deepç»„ä»¶å’ŒWideç»„ä»¶ä¸­ã€‚ç„¶ååœ¨Deepéƒ¨åˆ†å°†å…¨éƒ¨è¾“å…¥æ•°æ®é€åˆ°3ä¸ªReLUå±‚ï¼Œåœ¨æœ€åé€šè¿‡Sigmoidå±‚è¿›è¡Œæ‰“åˆ†ã€‚è®­ç»ƒæ•°æ®7000ä¸‡+ï¼Œå¹¶ç”¨è¶…è¿‡3000ä¸‡çš„æµ‹è¯•æ•°æ®è¿›è¡Œçº¿ä¸‹æ¨¡å‹é¢„ä¼°ã€‚Batchï¼Sizeè®¾ä¸º50000ï¼ŒEpochè®¾ä¸º20ã€‚<br>çº¿ä¸ŠABå®éªŒç»“æœï¼š<br><img width="700" src="/images/search_wd_abtest.png"></p>
<h5 id="LambdaDNN"><a href="#LambdaDNN" class="headerlink" title="LambdaDNN"></a>LambdaDNN</h5><p>å¤§ä¼—ç‚¹è¯„æœç´¢æ’åºæ¨¡å‹ï¼ŒåŸºäºTensorFlowåˆ†å¸ƒå¼æ¡†æ¶å®ç°ã€‚<br><img width="700" src="/images/search_lambdaDnn.png"><br>NDCGçš„è®¡ç®—å…¬å¼ä¸­ï¼ŒæŠ˜æŸçš„æƒé‡æ˜¯éšç€ä½ç½®å‘ˆæŒ‡æ•°å˜åŒ–çš„ã€‚ç„¶è€Œå®é™…æ›å…‰ç‚¹å‡»ç‡éšä½ç½®å˜åŒ–çš„æ›²çº¿ä¸NDCGçš„ç†è®ºæŠ˜æŸå€¼å­˜åœ¨ç€è¾ƒå¤§çš„å·®å¼‚ã€‚<br>å¯¹äºç§»åŠ¨ç«¯çš„åœºæ™¯æ¥è¯´ï¼Œç”¨æˆ·åœ¨ä¸‹æ‹‰æ»‘åŠ¨åˆ—è¡¨è¿›è¡Œæµè§ˆæ—¶ï¼Œè§†è§‰çš„ç„¦ç‚¹ä¼šéšç€æ»‘å±ã€ç¿»é¡µè€Œå‘ç”Ÿå˜åŠ¨ã€‚ä¾‹å¦‚ç”¨æˆ·ç¿»åˆ°ç¬¬äºŒé¡µæ—¶ï¼Œå¾€å¾€ä¼šé‡æ–°èšç„¦ï¼Œå› æ­¤ï¼Œä¼šå‘ç°ç¬¬äºŒé¡µå¤´éƒ¨çš„æ›å…‰ç‚¹å‡»ç‡å®é™…ä¸Šæ˜¯é«˜äºç¬¬ä¸€é¡µå°¾éƒ¨ä½ç½®çš„ã€‚æˆ‘ä»¬å°è¯•äº†ä¸¤ç§æ–¹æ¡ˆå»å¾®è°ƒNDCGä¸­çš„æŒ‡æ•°ä½ç½®æŠ˜æŸï¼š<br>æ ¹æ®å®é™…æ›å…‰ç‚¹å‡»ç‡æ‹ŸåˆæŠ˜æŸæ›²çº¿ï¼šæ ¹æ®å®é™…ç»Ÿè®¡åˆ°çš„æ›å…‰ç‚¹å‡»ç‡æ•°æ®ï¼Œæ‹Ÿåˆå…¬å¼æ›¿ä»£NDCGä¸­çš„æŒ‡æ•°æŠ˜æŸå…¬å¼ï¼Œç»˜åˆ¶çš„æ›²çº¿å¦‚å›¾12æ‰€ç¤ºã€‚<br>è®¡ç®—Position Biasä½œä¸ºä½ç½®æŠ˜æŸï¼šPosition Biasåœ¨ä¸šç•Œæœ‰è¾ƒå¤šçš„è®¨è®ºï¼Œç”¨æˆ·ç‚¹å‡»å•†æˆ·çš„è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºè§‚å¯Ÿå’Œç‚¹å‡»ä¸¤ä¸ªæ­¥éª¤ï¼ša.ç”¨æˆ·éœ€è¦é¦–å…ˆçœ‹åˆ°è¯¥å•†æˆ·ï¼Œè€Œçœ‹åˆ°å•†æˆ·çš„æ¦‚ç‡å–å†³äºæ‰€åœ¨çš„ä½ç½®ï¼›b.çœ‹åˆ°å•†æˆ·åç‚¹å‡»å•†æˆ·çš„æ¦‚ç‡åªä¸å•†æˆ·çš„ç›¸å…³æ€§æœ‰å…³ã€‚æ­¥éª¤aè®¡ç®—çš„æ¦‚ç‡å³ä¸ºPosition Biasï¼Œè¿™å—å†…å®¹å¯ä»¥è®¨è®ºçš„ä¸œè¥¿å¾ˆå¤šï¼Œè¿™é‡Œä¸å†è¯¦è¿°ã€‚<br><img width="700" src="/images/search_ndcg.png"><br>ç»è¿‡ä¸Šè¿°å¯¹NDCGè®¡ç®—æ”¹é€ è®­ç»ƒå‡ºçš„LambdaDNNæ¨¡å‹ï¼Œç›¸è¾ƒBaseæ ‘æ¨¡å‹å’ŒPointwise DNNæ¨¡å‹ï¼Œåœ¨ä¸šåŠ¡æŒ‡æ ‡ä¸Šæœ‰äº†éå¸¸æ˜¾è‘—çš„æå‡ã€‚<br><img width="700" src="/images/search_lm_dnn_lmDnn.png"></p>
<h5 id="LambdaDeepFM"><a href="#LambdaDeepFM" class="headerlink" title="LambdaDeepFM"></a>LambdaDeepFM</h5><p>[å¾…è¡¥å……]</p>
<h5 id="LambdaDCN"><a href="#LambdaDCN" class="headerlink" title="LambdaDCN"></a>LambdaDCN</h5><p>Lambdaæ¢¯åº¦é™¤äº†ä¸DNNç½‘ç»œç›¸ç»“åˆå¤–ï¼Œä¹Ÿå¯ä»¥ä¸ç»å¤§éƒ¨åˆ†å¸¸è§çš„ç½‘ç»œç»“æ„ç›¸ç»“åˆã€‚ä¸ºäº†è¿›ä¸€æ­¥å­¦ä¹ åˆ°æ›´å¤šäº¤å‰ç‰¹å¾ï¼Œç¾å›¢ç‚¹è¯„å›¢é˜Ÿåœ¨LambdaDNNçš„åŸºç¡€ä¸Šåˆ†åˆ«å°è¯•äº†LambdaDeepFMå’ŒLambdaDCNç½‘ç»œï¼›å…¶ä¸­DCNç½‘ç»œæ˜¯ä¸€ç§åŠ å…¥Crossçš„å¹¶è¡Œç½‘ç»œç»“æ„ï¼Œäº¤å‰çš„ç½‘ç»œæ¯ä¸€å±‚çš„è¾“å‡ºç‰¹å¾ä¸ç¬¬ä¸€å±‚çš„åŸå§‹è¾“å…¥ç‰¹å¾è¿›è¡Œæ˜¾æ€§çš„ä¸¤ä¸¤äº¤å‰ï¼Œç›¸å½“äºæ¯ä¸€å±‚å­¦ä¹ ç‰¹å¾äº¤å‰çš„æ˜ å°„å»æ‹Ÿåˆå±‚ä¹‹é—´çš„æ®‹å·®ã€‚<br><img width="700" src="/images/search_lambdaDcn.png"><br>ç¦»çº¿çš„å¯¹æ¯”å®éªŒè¡¨æ˜ï¼ŒLambdaæ¢¯åº¦ä¸DCNç½‘ç»œç»“åˆä¹‹åå……åˆ†å‘æŒ¥äº†DCNç½‘ç»œçš„ç‰¹ç‚¹ï¼Œç®€æ´çš„å¤šé¡¹å¼äº¤å‰è®¾è®¡æœ‰æ•ˆåœ°æå‡æ¨¡å‹çš„è®­ç»ƒæ•ˆæœã€‚NDCGæŒ‡æ ‡å¯¹æ¯”æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img width="500" src="/images/search_dcn_compare.png"></p>
<h4 id="è¡¥å……æ¨¡å‹"><a href="#è¡¥å……æ¨¡å‹" class="headerlink" title="è¡¥å……æ¨¡å‹"></a>è¡¥å……æ¨¡å‹</h4><h5 id="FM"><a href="#FM" class="headerlink" title="FM"></a>FM</h5><p><img width="700" src="/images/search_fm.png"></p>
<h5 id="DSSM"><a href="#DSSM" class="headerlink" title="DSSM"></a>DSSM</h5><p><img width="700" src="/images/search_dssm.png"></p>
<h5 id="ç‚¹å‡»æ¨¡å‹"><a href="#ç‚¹å‡»æ¨¡å‹" class="headerlink" title="ç‚¹å‡»æ¨¡å‹"></a>ç‚¹å‡»æ¨¡å‹</h5><p><img width="700" src="/images/search_click.png"></p>
<h5 id="DBNæ¨¡å‹"><a href="#DBNæ¨¡å‹" class="headerlink" title="DBNæ¨¡å‹"></a>DBNæ¨¡å‹</h5><p><img width="700" src="/images/search_dbn.png"></p>
<h5 id="IRGAN"><a href="#IRGAN" class="headerlink" title="IRGAN"></a>IRGAN</h5><p><img width="700" src="/images/search_irgan.png"></p>
<h1 id="æ¨¡å‹é€‰æ‹©"><a href="#æ¨¡å‹é€‰æ‹©" class="headerlink" title="æ¨¡å‹é€‰æ‹©"></a>æ¨¡å‹é€‰æ‹©</h1><ol>
<li>LambdaRank</li>
<li>LambdaMART</li>
<li>Wide&amp;Deep</li>
</ol>
<h1 id="æ¨¡å‹ç»„åˆ"><a href="#æ¨¡å‹ç»„åˆ" class="headerlink" title="æ¨¡å‹ç»„åˆ"></a>æ¨¡å‹ç»„åˆ</h1><p>çˆ±å¥‡è‰ºå®è·µï¼š<br><img width="700" src="/images/search_model_compare.png"></p>
<blockquote>
<p>é’ˆå¯¹GBDTå’ŒLRæ¨¡å‹çš„ä¼˜ç¼ºç‚¹ï¼Œåšäº†è¿›ä¸€æ­¥çš„æ¨¡å‹ç»„åˆçš„å°è¯•ï¼š<br>ç¬¬ä¸€ç§æ–¹å¼ï¼Œç”¨ LR æ¨¡å‹æŠŠé«˜ç»´ç¨ å¯†ç‰¹å¾è¿›è¡Œå­¦ä¹ ï¼Œå­¦ä¹ å‡ºé«˜ç»´ç‰¹å¾ï¼ŒæŠŠè¯¥ç‰¹å¾å’ŒåŸå§‹ç‰¹å¾åšæ‹¼æ¥ï¼Œå­¦ä¹  gbdt æ¨¡å‹ã€‚<br>è¯¥åŠæ³•æ•ˆæœä¸å¥½ï¼Œæå‡å¾ˆå¼±ã€‚<br><strong> å‰–æç¼˜ç”±ï¼š</strong> æŠŠé«˜ç»´ç‰¹å¾åˆšåœ¨ä¸€ä¸ªç‰¹å¾å»è¡¨è¾¾ï¼Œä¸¢æ‰äº†åŸå§‹çš„ç‰¹å¾ã€‚<br>ç¬¬äºŒç§æ–¹å¼ï¼Œç”¨ gbdt å»å­¦ï¼Œå­¦ä¹ åæŠŠæ ·æœ¬è½å…¥å¶å­èŠ‚ç‚¹ä¿¡æ¯æ¥è¿›æ¥ä¸é«˜ç»´ç¨ å¯†ç‰¹å¾æ‹¼æ¥ï¼Œåœ¨æ­¤æ ¹åº•ä¸Šç”¨ LR å­¦ä¹ ã€‚<br>è¯¥æ¨¡å‹æ•ˆæœå˜å·®ã€‚<br><strong> å‰–æç¼˜ç”±ï¼š</strong> ç‚¹å‡»ç±»å’Œç©¿æ’ç±»ç‰¹å¾æ˜¯å¯¹æ’åºå½±å“æœ€å¤§çš„ç‰¹å¾ï¼Œè¿™ç±»ç‰¹å¾å’Œå¤§é‡çš„ç¨ å¯†ç±»ç‰¹å¾åšæ‹¼æ¥æ—¶ï¼Œé‡è¦æ€§è¢«ç¨€é‡Šäº†ï¼Œå¯¼è‡´æ¨¡å‹çš„å­¦ä¹ èƒ½åŠ›å˜å¼±ã€‚</p>
</blockquote>
<h1 id="å·¥ç¨‹å®ç°"><a href="#å·¥ç¨‹å®ç°" class="headerlink" title="å·¥ç¨‹å®ç°"></a>å·¥ç¨‹å®ç°</h1><p><strong>Pythonè®­ç»ƒ+Golangéƒ¨ç½²</strong></p>
<ol>
<li>LambdaRankï¼ŒåŸºäºxgboostå®ç°ï¼Œå‚è€ƒï¼š<a href="https://github.com/dmlc/xgboost/tree/master/demo/rank" target="_blank" rel="external">https://github.com/dmlc/xgboost/tree/master/demo/rank</a></li>
<li>LambdaMARTï¼ŒåŸºäºLightGBMå®ç°ï¼Œå‚è€ƒï¼š<a href="https://github.com/jiangnanboy/learning_to_rank" target="_blank" rel="external">https://github.com/jiangnanboy/learning_to_rank</a></li>
<li>Wide&amp;DeepåŸºäºTensorFlowå®ç°ï¼Œå‚è€ƒï¼š<a href="https://github.com/tensorflow/ranking" target="_blank" rel="external">https://github.com/tensorflow/ranking</a></li>
</ol>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://mp.weixin.qq.com/s/NqVP0ksfLiRLSGkuWxiz5A" target="_blank" rel="external">æµ…è°ˆå¾®è§†æ¨èç³»ç»Ÿä¸­çš„ç‰¹å¾å·¥ç¨‹</a><br><a href="https://cloud.tencent.com/developer/news/184638" target="_blank" rel="external">å›é¡¾Â·æœç´¢å¼•æ“ç®—æ³•ä½“ç³»ç®€ä»‹â€”â€”æ’åºå’Œæ„å›¾ç¯‡</a><br><a href="https://tech.meituan.com/2017/07/28/dl.html" target="_blank" rel="external">æ·±åº¦å­¦ä¹ åœ¨ç¾å›¢æ¨èå¹³å°æ’åºä¸­çš„è¿ç”¨</a><br><a href="https://www.cnblogs.com/bentuwuying/p/6684585.html" target="_blank" rel="external">Learning to Rankç®—æ³•ä»‹ç»ï¼šGBRank</a><br><a href="https://www.cnblogs.com/bentuwuying/p/6683832.html" target="_blank" rel="external">Learning to Rankç®—æ³•ä»‹ç»ï¼šRankSVM å’Œ IR SVM</a><br><a href="https://tech.meituan.com/2019/01/17/dianping-search-deeplearning.html" target="_blank" rel="external">å¤§ä¼—ç‚¹è¯„æœç´¢åŸºäºçŸ¥è¯†å›¾è°±çš„æ·±åº¦å­¦ä¹ æ’åºå®è·µ</a><br><a href="https://www.cnblogs.com/bentuwuying/p/6690836.html" target="_blank" rel="external">Learning to Rankç®—æ³•ä»‹ç»ï¼šRankNetï¼ŒLambdaRankï¼ŒLambdaMart</a><br><a href="https://cloud.tencent.com/developer/article/1500313" target="_blank" rel="external">ã€Œå›é¡¾ã€çˆ±å¥‡è‰ºæœç´¢æ’åºæ¨¡å‹è¿­ä»£ä¹‹è·¯</a><br><a href="https://blog.csdn.net/v_JULY_v/article/details/81410574" target="_blank" rel="external">é€šä¿—ç†è§£kaggleæ¯”èµ›å¤§æ€å™¨xgboost</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/18/Learning-to-rankç®—æ³•/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeb">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°èœé¸¡">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/18/Learning-to-rankç®—æ³•/" itemprop="url">Learning to rankç®—æ³•</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-11-18T15:25:57+08:00">
                2019-11-18
              </time>
            

            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>äº’è”ç½‘<strong>æœç´¢</strong>è¯ç”ŸåˆæœŸï¼Œæ£€ç´¢æ¨¡å‹ä½¿ç”¨çš„ç‰¹å¾ç›¸å¯¹ç®€å•ï¼Œè¿™äº›ç‰¹å¾ä¸»è¦åŸºäºqueryä¸docä¹‹é—´çš„ç›¸å…³åº¦æ¥å¯¹æ–‡æ¡£è¿›è¡Œæ’åºã€‚å¦ä¸€ç§ä¼ ç»Ÿæ’åºæ¨¡å‹æ˜¯é‡è¦æ€§æ’åºæ¨¡å‹ï¼Œæ­¤æ—¶æ¨¡å‹ä¸è€ƒè™‘query ï¼Œè€Œä»…ä»…æ ¹æ®æ–‡æ¡£ï¼ˆç½‘é¡µï¼‰ä¹‹é—´çš„å›¾ç»“æ„æ¥åˆ¤æ–­docçš„é‡è¦ç¨‹åº¦ï¼Œä¾‹å¦‚PageRankæ’åºæ¨¡å‹ã€‚è€Œéšç€äº’è”ç½‘ä¸æ–­å‘å±•ï¼Œæµ·é‡æ•°æ®çš„äº§ç”Ÿï¼Œæ›´å¤šå¤æ‚æœ‰æ•ˆçš„ç‰¹å¾è¢«ç”¨äºæœç´¢æ’åºï¼Œäººå·¥è°ƒå‚å·²ä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œæ­¤æ—¶æœºå™¨å­¦ä¹ å¼€å§‹åœ¨æœç´¢æ’åºé¢†åŸŸå¾—åˆ°åº”ç”¨ï¼Œlearning to ranké€æ¸æˆä¸ºçƒ­é—¨ç ”ç©¶æ–¹å‘ã€‚</p>
<h2 id="æœç´¢"><a href="#æœç´¢" class="headerlink" title="æœç´¢"></a>æœç´¢</h2><p>æœç´¢çš„ç›®æ ‡æ˜¯é€‰æ‹©ä¸ç”¨æˆ·è¾“å…¥queryæœ€ç›¸å…³çš„ä¸€ç»„æ–‡æ¡£ï¼Œç›®å‰ä¸»è¦æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>ç²—æ’ï¼šquery-docåŒ¹é…ï¼Œå¾—åˆ°ä¸€ç»„ä¸queryç›¸å…³çš„æ–‡æ¡£ï¼Œç›®å‰ä¸€èˆ¬é‡‡ç”¨å€’æ’ç´¢å¼•å®ç°ï¼›</li>
<li>ç²¾æ’ï¼šé€‰å–æ›´å¤šç‰¹å¾ï¼ŒæŒ‰ç…§ç”¨æˆ·ç‚¹å‡»è¯¥docçš„å¯èƒ½æ€§å¤§å°æ’åºï¼ŒLearning to rankå³æ˜¯å®ç°è¯¥éƒ¨åˆ†çš„æœºå™¨å­¦ä¹ æ¨¡å‹ã€‚</li>
</ol>
<h2 id="æœºå™¨å­¦ä¹ æ’åºç³»ç»Ÿ"><a href="#æœºå™¨å­¦ä¹ æ’åºç³»ç»Ÿ" class="headerlink" title="æœºå™¨å­¦ä¹ æ’åºç³»ç»Ÿ"></a>æœºå™¨å­¦ä¹ æ’åºç³»ç»Ÿ</h2><p>å…¸å‹çš„æœºå™¨å­¦ä¹ æ’åºç³»ç»Ÿå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="/images/rank-system.jpg" alt=""></p>
<h2 id="Learning-to-rank"><a href="#Learning-to-rank" class="headerlink" title="Learning to rank"></a>Learning to rank</h2><p>åŒ…å«pointwiseæ–¹æ³•ã€pairwiseæ–¹æ³•å’Œlistwiseæ–¹æ³•ä¸‰ç§ç±»å‹ã€‚</p>
<p>(1) pointwiseæ–¹æ³•ï¼šå¯¹äºæŸä¸€ä¸ªqueryï¼Œ åˆ¤æ–­æ¯ä¸ªdocè¿™ä¸ªqueryçš„ç›¸å…³åº¦ï¼Œç”±æ­¤å°†docsæ’åºé—®é¢˜è½¬åŒ–ä¸ºäº†åˆ†ç±»ï¼ˆæ¯”å¦‚ç›¸å…³ã€ä¸ç›¸å…³ï¼‰æˆ–å›å½’é—®é¢˜ï¼ˆç›¸å…³ç¨‹åº¦è¶Šå¤§ï¼Œå›å½’å‡½æ•°çš„å€¼è¶Šå¤§ï¼‰ã€‚å…¶L2Ræ¡†æ¶å…·æœ‰ä»¥ä¸‹ç‰¹å¾ï¼š</p>
<ul>
<li>è¾“å…¥ç©ºé—´ä¸­æ ·æœ¬æ˜¯å•ä¸ª docï¼ˆå’Œå¯¹åº” queryï¼‰æ„æˆçš„ç‰¹å¾å‘é‡ï¼›</li>
<li>è¾“å‡ºç©ºé—´ä¸­æ ·æœ¬æ˜¯å•ä¸ª docï¼ˆå’Œå¯¹åº” queryï¼‰çš„ç›¸å…³åº¦ï¼›</li>
<li>å‡è®¾æ ·æœ¬æ»¡è¶³æ‰“åˆ†å‡½æ•°ï¼›</li>
<li>æŸå¤±å‡½æ•°è¯„ä¼°å•ä¸ª doc çš„é¢„æµ‹å¾—åˆ†å’ŒçœŸå®å¾—åˆ†ä¹‹é—´å·®å¼‚ã€‚</li>
</ul>
<p>(2) pairwiseæ–¹æ³•ï¼šè¯¥æ–¹æ³•å¹¶ä¸å…³å¿ƒæŸä¸€ä¸ªdocä¸queryç›¸å…³ç¨‹åº¦çš„å…·ä½“æ•°å€¼ï¼Œè€Œæ˜¯å°†æ’åºé—®é¢˜è½¬åŒ–ä¸ºä»»æ„ä¸¤ä¸ªä¸åŒçš„docs diå’Œdjè°ä¸å½“å‰çš„queryæ›´ç›¸å…³çš„ç›¸å¯¹é¡ºåºçš„æ’åºé—®é¢˜ã€‚ä¸€èˆ¬åˆ†ä¸ºdiæ¯”djæ›´ç›¸å…³ã€æ›´ä¸ç›¸å…³å’Œç›¸å…³ç¨‹åº¦ç›¸ç­‰ä¸‰ä¸ªç±»åˆ«ï¼Œåˆ†åˆ«è®°ä¸º{+1, -1, 0}ï¼Œç”±æ­¤ä¾¿åˆè½¬åŒ–ä¸ºäº†åˆ†ç±»é—®é¢˜ã€‚å…¶ L2R æ¡†æ¶å…·æœ‰ä»¥ä¸‹ç‰¹å¾ï¼š</p>
<ul>
<li>è¾“å…¥ç©ºé—´ä¸­æ ·æœ¬æ˜¯ï¼ˆåŒä¸€ query å¯¹åº”çš„ï¼‰ä¸¤ä¸ª docï¼ˆå’Œå¯¹åº” queryï¼‰æ„æˆçš„ä¸¤ä¸ªç‰¹å¾å‘é‡ï¼›</li>
<li>è¾“å‡ºç©ºé—´ä¸­æ ·æœ¬æ˜¯ pairwise preferenceï¼›</li>
<li>å‡è®¾ç©ºé—´ä¸­æ ·æœ¬æ»¡è¶³äºŒå˜é‡å‡½æ•°ï¼›</li>
<li>æŸå¤±å‡½æ•°è¯„ä¼° doc pair çš„é¢„æµ‹ preference å’ŒçœŸå® preference ä¹‹é—´å·®å¼‚ã€‚</li>
</ul>
<p>(3) listwiseæ–¹æ³•ï¼šå°†ä¸€ä¸ªqueryå¯¹åº”çš„æ‰€æœ‰ç›¸å…³æ–‡æ¡£çœ‹åšä¸€ä¸ªæ•´ä½“ï¼Œä½œä¸ºå•ä¸ªè®­ç»ƒæ ·æœ¬ã€‚å…¶ L2R æ¡†æ¶å…·æœ‰ä»¥ä¸‹ç‰¹å¾ï¼š</p>
<ul>
<li>è¾“å…¥ç©ºé—´ä¸­æ ·æœ¬æ˜¯ï¼ˆåŒä¸€ query å¯¹åº”çš„ï¼‰æ‰€æœ‰ docæ„æˆçš„å¤šä¸ªç‰¹å¾å‘é‡ï¼ˆåˆ—è¡¨ï¼‰ï¼›</li>
<li>è¾“å‡ºç©ºé—´ä¸­æ ·æœ¬æ˜¯è¿™äº› docä¸å¯¹åº” queryçš„ç›¸å…³åº¦æ’åºåˆ—è¡¨ï¼›</li>
<li>å‡è®¾ç©ºé—´ä¸­æ ·æœ¬æ»¡è¶³å¤šå˜é‡å‡½æ•°ï¼Œå¯¹äº docs å¾—åˆ°å…¶æ’åˆ—ï¼Œå®è·µä¸­ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªæ‰“åˆ†å‡½æ•°ï¼Œæ ¹æ®æ‰“åˆ†å‡½æ•°å¯¹æ‰€æœ‰ docs çš„æ‰“åˆ†è¿›è¡Œæ’åºå¾—åˆ° docs ç›¸å…³åº¦çš„æ’åˆ—ï¼›</li>
<li>æŸå¤±å‡½æ•°åˆ†æˆä¸¤ç±»ï¼Œä¸€ç±»æ˜¯ç›´æ¥å’Œè¯„ä»·æŒ‡æ ‡ç›¸å…³çš„ï¼Œè¿˜æœ‰ä¸€ç±»ä¸æ˜¯ç›´æ¥ç›¸å…³çš„ã€‚</li>
</ul>
<p>ç”±äºè¯„ä»·æŒ‡æ ‡é€šå¸¸æ˜¯ç¦»æ•£ä¸å¯å¾®çš„ï¼Œç›´æ¥ä¼˜åŒ–rankingè¯„ä»·æŒ‡æ ‡å¹¶ä¸ç®€å•ï¼Œé€šå¸¸æœ‰ä»¥ä¸‹å¤„ç†æ–¹å¼ï¼š</p>
<ul>
<li>ä¼˜åŒ–åŸºäºè¯„ä»·æŒ‡æ ‡çš„ ranking error çš„è¿ç»­å¯å¾®çš„è¿‘ä¼¼ï¼Œè¿™ç§æ–¹æ³•å°±å¯ä»¥ç›´æ¥åº”ç”¨å·²æœ‰çš„ä¼˜åŒ–æ–¹æ³•ï¼Œå¦‚SoftRankï¼ŒApproximateRankï¼ŒSmoothRankã€‚</li>
<li>ä¼˜åŒ–åŸºäºè¯„ä»·æŒ‡æ ‡çš„ ranking error çš„è¿ç»­å¯å¾®çš„ä¸Šç•Œï¼Œå¦‚ SVM-MAPï¼ŒSVM-NDCGï¼ŒPermuRankã€‚</li>
<li>ä½¿ç”¨å¯ä»¥ä¼˜åŒ–éå¹³æ»‘ç›®æ ‡å‡½æ•°çš„ä¼˜åŒ–æŠ€æœ¯ï¼Œå¦‚ AdaRankï¼ŒRankGPã€‚éç›´æ¥ç›¸å…³çš„æŸå¤±å‡½æ•°åˆ™ä¸å†ä½¿ç”¨ä¸è¯„ä»·ç›¸å…³çš„lossæ¥ä¼˜åŒ–æ¨¡å‹ï¼Œè€Œæ˜¯è®¾è®¡èƒ½è¡¡é‡æ¨¡å‹è¾“å‡ºä¸çœŸå®æ’åˆ—ä¹‹é—´å·®å¼‚çš„ lossï¼Œå¦‚æ­¤è·å¾—çš„æ¨¡å‹åœ¨è¯„ä»·æŒ‡æ ‡ä¸Šä¹Ÿèƒ½è·å¾—ä¸é”™çš„æ€§èƒ½ã€‚ä¾‹å¦‚ ï¼šListNetï¼ŒListMLEï¼ŒStructRankå’ŒBoltzRankã€‚</li>
</ul>
<h3 id="ä¸»è¦æ¨¡å‹åˆ†ç±»"><a href="#ä¸»è¦æ¨¡å‹åˆ†ç±»" class="headerlink" title="ä¸»è¦æ¨¡å‹åˆ†ç±»"></a>ä¸»è¦æ¨¡å‹åˆ†ç±»</h3><p>æŒ‰ç…§è¿™ä¸‰ç§ç±»å‹ï¼Œå¯ä»¥å°†ä¸»è¦æ¨¡å‹åšå¦‚ä¸‹æ¢³ç†ï¼š<br><img width="600" src="/images/search_kinds.png"><br>å›¾ä¸­Rank CreationæŒ‡ç»™å®šæŸ¥è¯¢Queryå’Œæ–‡æ¡£Docsï¼Œå¾—åˆ°Docsæ’åºç»“æœï¼›Rank AggregationæŒ‡ç»¼åˆå¤šä¸ªä¸åŒçš„Ranking Systemçš„æ’åºç»“æœï¼Œå¾—å‡ºæœ€ç»ˆæ’åºç»“æœã€‚</p>
<h3 id="XGBoost"><a href="#XGBoost" class="headerlink" title="XGBoost"></a>XGBoost</h3><p>ä¸‹é¢ä»¥xgboostæ¨¡å‹ä¸ºä¾‹ï¼Œè¯´æ˜å¦‚ä½•å®Œæˆæ’åºã€‚å¤§è‡´è¿‡ç¨‹å¦‚ä¸‹ï¼š<br><strong>è®­ç»ƒ</strong></p>
<ol>
<li>è·å–è®­ç»ƒæ•°æ®ï¼›</li>
<li>æ„é€ ç‰¹å¾å€™é€‰é›†ï¼Œå®Œæˆè®­ç»ƒæ ·æœ¬å‡†å¤‡ï¼›</li>
<li>åŸºäºxgboostå¯»æ‰¾åˆ’åˆ†ç‚¹ï¼Œé‡å¤è¯¥æ­¥è‡³ä¸èƒ½å†åˆ†è£‚åˆ’åˆ†ç‚¹ï¼›</li>
<li>é€šè¿‡æœ€å°åŒ–pairwise lossç”Ÿæˆä¸‹ä¸€æ£µæ ‘ï¼›</li>
<li>ç”Ÿæˆè®¾å®šæ•°é‡çš„æ ‘åï¼Œè®­ç»ƒå®Œæˆï¼›</li>
</ol>
<p><strong>æµ‹è¯•</strong></p>
<ol>
<li>è¾“å…¥æµ‹è¯•æ ·æœ¬ï¼›</li>
<li>æ ¹æ®è®­ç»ƒæ‰€å¾—æ¨¡å‹å’Œæ‰“åˆ†å‡½æ•°è¿›è¡Œæ‰“åˆ†ï¼›</li>
<li>è·å¾—æ¯ä¸ª<query,doc>å¯¹æ‰“åˆ†ï¼Œå¹¶å®Œæˆæ’åºã€‚</query,doc></li>
</ol>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç›®å‰ä½¿ç”¨æ¯”è¾ƒå¤šçš„XGBoost rankingæ¨¡å‹æ˜¯LambdaRankï¼Œä½†å°šæœªå®Œæˆï¼Œæ‰€ä»¥ç›®å‰ä½¿ç”¨pairwise rankï¼Œå‚è€ƒ<a href="https://github.com/dmlc/xgboost/tree/master/demo/rank" target="_blank" rel="external">dmlc/xgboost</a> .</p>
<p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line">import os,sys,json</div><div class="line">import math</div><div class="line">import random</div><div class="line">import numpy as np</div><div class="line">import pandas as pd</div><div class="line">import sklearn.utils</div><div class="line">import xgboost as xgb</div><div class="line"></div><div class="line">enableFeatures = [</div><div class="line">    &quot;fea1&quot;,</div><div class="line">    &quot;fea2&quot;</div><div class="line">]</div><div class="line"></div><div class="line">train_data = pd.read_csv(&quot;train.csv&quot;, sep=&quot;\t&quot;)</div><div class="line">test_data = pd.read_csv(&quot;test.csv&quot;, sep=&quot;\t&quot;)</div><div class="line">print(&quot;all data &#123;0&#125;&quot;.format(train_data.shape))</div><div class="line">print(&quot;all data &#123;0&#125;&quot;.format(test_data.shape))</div><div class="line"></div><div class="line"># åˆ†ç»„å¤„ç†æ•°æ®</div><div class="line">traingroups = &#123;&#125;</div><div class="line">validgroups = &#123;&#125;</div><div class="line"></div><div class="line">for qid, df in list(train_data.groupby(&quot;group_id&quot;)):</div><div class="line">    group = traingroups.setdefault(qid, &#123;&#125;)</div><div class="line">    group[&quot;length&quot;] = len(df)</div><div class="line">    group[&quot;weight&quot;] = 1</div><div class="line">    group[&quot;df&quot;] = df</div><div class="line"></div><div class="line">for qid, df in list(test_data.groupby(&quot;group_id&quot;)):</div><div class="line">    group = validgroups.setdefault(qid, &#123;&#125;)</div><div class="line">    group[&quot;length&quot;] = len(df)</div><div class="line">    group[&quot;weight&quot;] = 1</div><div class="line">    group[&quot;df&quot;] = df</div><div class="line"></div><div class="line">print(&quot;groups&quot;)</div><div class="line">traingroups = [group for qid, group in traingroups.items() ]</div><div class="line">validgroups = [group for qid, group in validgroups.items() ]</div><div class="line"></div><div class="line">print(&quot;concat&quot;)</div><div class="line">train_X = pd.concat(map(lambda x: sklearn.utils.shuffle(x[&quot;df&quot;]), traingroups), ignore_index=True)</div><div class="line">valid_X = pd.concat(map(lambda x: sklearn.utils.shuffle(x[&quot;df&quot;]), validgroups), ignore_index=True)</div><div class="line">train_y = train_X[&quot;label&quot;]</div><div class="line">valid_y = valid_X[&quot;label&quot;]</div><div class="line"></div><div class="line">train_X = train_X[enableFeatures]</div><div class="line">valid_X = valid_X[enableFeatures]</div><div class="line">train_X, valid_X = train_X.align(valid_X, join=&quot;left&quot;, axis=1)</div><div class="line"></div><div class="line">print(&quot;data length weight&quot;)</div><div class="line">train_q = np.array(list(map(lambda x: x[&quot;length&quot;], traingroups)))</div><div class="line">valid_q = np.array(list(map(lambda x: x[&quot;length&quot;], validgroups)))</div><div class="line">train_w = np.array(list(map(lambda x: x[&quot;weight&quot;], traingroups)))</div><div class="line">valid_w = np.array(list(map(lambda x: x[&quot;weight&quot;], validgroups)))</div><div class="line"></div><div class="line">print(&quot;model train&quot;)</div><div class="line">#&quot;rank:ndcg&quot;</div><div class="line">ranker = xgb.XGBRanker(objective=&quot;rank:pairwise&quot;)</div><div class="line">ranker.fit(train_X, train_y, train_q, sample_weight=train_w,</div><div class="line">    eval_set=[(valid_X, valid_y)], eval_group=[valid_q], sample_weight_eval_set=[valid_w],</div><div class="line">    eval_metric=[&quot;ndcg@5-&quot;, &quot;ndcg@10-&quot;], early_stopping_rounds=5, verbose=True,</div><div class="line">    callbacks=[xgb.callback.reset_learning_rate(lambda x,y: 0.95 ** x * 0.1)])</div><div class="line">ranker.feature_names = map(str, train_X.columns)</div><div class="line">with open(&quot;xgb_pair.model.features&quot;, &quot;w&quot;) as fw:</div><div class="line">    fw.write( &quot;,&quot;.join(ranker.feature_names))</div><div class="line">ranker.save_model(&apos;xgb_pair.model&apos;)</div><div class="line">model = xgb.Booster(model_file=&apos;xgb_pair.model&apos;)</div><div class="line">print(ranker.get_booster().get_score(importance_type=&apos;gain&apos;) )</div></pre></td></tr></table></figure></p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="https://blog.csdn.net/seasongirl/article/details/100178083" target="_blank" rel="external">ç”¨xgbooståšæ’åºä»»åŠ¡â€”â€”xgboostä¸‹çš„learning2rank</a><br><a href="https://blog.csdn.net/zuolixiangfisher/article/details/81072922" target="_blank" rel="external">Learning to Rankç³»åˆ—ä¹‹æ¦‚è¿°</a><br><a href="http://www.bdpt.net/cn/2018/11/20/rankæ•™ç¨‹-06-learning-to-rank-æ¦‚è¿°/" target="_blank" rel="external">Learning to Rank æ¦‚è¿°</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/31/BERTäºŒé˜¶æ®µfine-tuneä»£ç åˆ†æ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeb">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°èœé¸¡">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/31/BERTäºŒé˜¶æ®µfine-tuneä»£ç åˆ†æ/" itemprop="url">BERTäºŒé˜¶æ®µfine tuneä»£ç åˆ†æ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-05-31T16:56:20+08:00">
                2019-05-31
              </time>
            

            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>BERTé™¤é¢„è®­ç»ƒä»£ç run_pretraining.pyå¤–ï¼Œè¿˜æä¾›äº†run_classifier.pyç”¨äºæ–‡æœ¬åˆ†ç±»å’Œrun_squad.pyç”¨äºé˜…è¯»ç†è§£ï¼Œä¸‹é¢é€šè¿‡å¯¹æ¯”ä¸‰ä¸ªä»£ç æ€»ç»“å‡ºå¦‚ä½•å¿«é€ŸåŸºäºBERTåšäºŒé˜¶æ®µfine tuneçš„æ–¹æ³•ã€‚æ­¤å¤–ï¼Œå¦‚æœTF Hubä¸­æœ‰å¯¹åº”ä»»åŠ¡å¯ä½¿ç”¨çš„é¢„è®­ç»ƒæ¨¡å‹ï¼Œä¹Ÿå¯ç›´æ¥ä½¿ç”¨ï¼Œä¾‹å¦‚åŒæ ·ç”¨äºåˆ†ç±»çš„run_classifier_with_tfhub.pyã€‚</p>
<h2 id="ä»£ç æ•´ä½“ç»“æ„"><a href="#ä»£ç æ•´ä½“ç»“æ„" class="headerlink" title="ä»£ç æ•´ä½“ç»“æ„"></a>ä»£ç æ•´ä½“ç»“æ„</h2><p>ä»£ç çš„æ•´ä½“æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="/images/BERT.png" alt=""></p>
<h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>åœ¨bert_config_fileæ–‡ä»¶ä¸­é…ç½®å„ä¸ªå‚æ•°ï¼Œä¾‹å¦‚attention_probs_dropout_probå’Œdirectionalityç­‰ï¼Œconfigæ–‡ä»¶åœ¨BERTæä¾›çš„é¢„è®­ç»ƒæ¨¡å‹ä¸­ã€‚</p>
<h3 id="è¾“å…¥å¤„ç†"><a href="#è¾“å…¥å¤„ç†" class="headerlink" title="è¾“å…¥å¤„ç†"></a>è¾“å…¥å¤„ç†</h3><p>ç»“æ„å›¾ä¸­ä»¥get input filesè¡¨ç¤ºæ•´ä¸ªçš„è¾“å…¥æ•°æ®å¤„ç†éƒ¨åˆ†ï¼Œä¸åŒäºæ—©æœŸç‰ˆæœ¬çš„æ•°æ®å¤„ç†è¿‡ç¨‹ï¼Œå½“å‰çš„TFç‰ˆæœ¬å°†æ•°æ®è½¬åŒ–ä¸ºfeaturesç”¨äºè®­ç»ƒã€‚æ‰€ä»¥éœ€è¦å»ºç«‹ç›¸åº”çš„ç»“æ„ä½“æ‰¿æ¥æ•°æ®ï¼Œå¹¶å»ºç«‹å¯¹åº”çš„æ•°æ®å¤„ç†æ–¹æ³•ï¼Œæœ€åè½¬åŒ–ä¸ºfeaturesï¼Œä¸‹è¡¨ä¸­convert_exps_to_featuresä¸ºconvert_examples_to_featuresç®€å†™ã€‚</p>
<table>
<thead>
<tr>
<th>ä»£ç /åŠŸèƒ½</th>
<th>æ‰¿æ¥æ•°æ®</th>
<th>æ•°æ®å¤„ç†æ–¹æ³•</th>
<th>è½¬åŒ–ä¸ºfeatures</th>
</tr>
</thead>
<tbody>
<tr>
<td>run_classifier.py</td>
<td>InputExample, InputFeatures</td>
<td>DataProcessor</td>
<td>convert_single_example</td>
</tr>
<tr>
<td>run_squad.py</td>
<td>SquadExample, InputFeatures</td>
<td>read_squad_examples</td>
<td>convert_exps_to_features</td>
</tr>
</tbody>
</table>
<h3 id="å»ºç«‹æ¨¡å‹"><a href="#å»ºç«‹æ¨¡å‹" class="headerlink" title="å»ºç«‹æ¨¡å‹"></a>å»ºç«‹æ¨¡å‹</h3><p>ä»¥run_classifier.pyä¸ºä¾‹ï¼Œä½¿ç”¨model_fn_builderå‡½æ•°å»ºç«‹æ¨¡å‹ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">model_fn = model_fn_builder(</div><div class="line">      bert_config=bert_config,</div><div class="line">      num_labels=len(label_list),</div><div class="line">      init_checkpoint=FLAGS.init_checkpoint,</div><div class="line">      learning_rate=FLAGS.learning_rate,</div><div class="line">      num_train_steps=num_train_steps,</div><div class="line">      num_warmup_steps=num_warmup_steps,</div><div class="line">      use_tpu=FLAGS.use_tpu,</div><div class="line">      use_one_hot_embeddings=FLAGS.use_tpu)</div></pre></td></tr></table></figure></p>
<p>å…·ä½“åœ°ï¼Œå°†é…ç½®ã€è®­ç»ƒæ•°æ®ç­‰ä¿¡æ¯ä¼ å…¥create_modelå‡½æ•°ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(total_loss, per_example_loss, logits, probabilities) = create_model(</div><div class="line">        bert_config, is_training, input_ids, input_mask, segment_ids, label_ids,</div><div class="line">        num_labels, use_one_hot_embeddings)</div></pre></td></tr></table></figure></p>
<p>create_modelå‡½æ•°é¦–å…ˆåŸºäºBERTå»ºç«‹æ¨¡å‹ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">model = modeling.BertModel(</div><div class="line">      config=bert_config,</div><div class="line">      is_training=is_training,</div><div class="line">      input_ids=input_ids,</div><div class="line">      input_mask=input_mask,</div><div class="line">      token_type_ids=segment_ids,</div><div class="line">      use_one_hot_embeddings=use_one_hot_embeddings)</div></pre></td></tr></table></figure></p>
<p>ç„¶åæ ¹æ®éœ€è¦å–å¾—BERTæ¨¡å‹çš„è¾“å‡ºï¼Œä¾‹å¦‚åœ¨run_classifier.pyä¸­:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">output_layer = model.get_pooled_output()</div></pre></td></tr></table></figure></p>
<p>run_squad.pyä¸­:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">final_hidden = model.get_sequence_output()</div></pre></td></tr></table></figure></p>
<p>æ­¤éƒ¨åˆ†ç›¸å½“äºåˆ©ç”¨BERTä½œä¸ºä¸€ä¸ªEncoderæ¥ç¼–ç è¾“å…¥ä¿¡æ¯ï¼Œéšåä¾¿å¯æ ¹æ®ä»»åŠ¡å®šä¹‰å¯¹åº”çš„å¯å­¦ä¹ å‚æ•°å’Œlossã€‚</p>
<h3 id="å»ºç«‹estimator"><a href="#å»ºç«‹estimator" class="headerlink" title="å»ºç«‹estimator"></a>å»ºç«‹estimator</h3><p>æ ¹æ®å·²å»ºç«‹çš„æ¨¡å‹å’Œé…ç½®ä¿¡æ¯æ–°å»ºestimatorã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">estimator = tf.contrib.tpu.TPUEstimator(</div><div class="line">      use_tpu=FLAGS.use_tpu,</div><div class="line">      model_fn=model_fn,</div><div class="line">      config=run_config,</div><div class="line">      train_batch_size=FLAGS.train_batch_size,</div><div class="line">      predict_batch_size=FLAGS.predict_batch_size)</div></pre></td></tr></table></figure></p>
<h3 id="å¼€å§‹è®­ç»ƒ"><a href="#å¼€å§‹è®­ç»ƒ" class="headerlink" title="å¼€å§‹è®­ç»ƒ"></a>å¼€å§‹è®­ç»ƒ</h3><p>ä½¿ç”¨input_fn_builderå»ºç«‹è®­ç»ƒæ•°æ®ï¼Œè¾“å…¥estimatorå¼€å§‹è®­ç»ƒã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">train_input_fn = input_fn_builder(</div><div class="line">        input_file=train_writer.filename,</div><div class="line">        seq_length=FLAGS.max_seq_length,</div><div class="line">        is_training=True,</div><div class="line">        drop_remainder=True)</div><div class="line">    estimator.train(input_fn=train_input_fn, max_steps=num_train_steps)</div></pre></td></tr></table></figure></p>
<h2 id="ä½¿ç”¨TF-Hub"><a href="#ä½¿ç”¨TF-Hub" class="headerlink" title="ä½¿ç”¨TF Hub"></a>ä½¿ç”¨TF Hub</h2><p>run_classifier_with_tfhub.pyä¸run_classifier.pyæ•´ä½“æµç¨‹éå¸¸ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºrun_classifier_with_tfhub.pyä¸­è·å¾—BERTæ¨¡å‹æ˜¯é€šè¿‡TF Hubã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bert_module = hub.Module(bert_hub_module_handle, tags=tags, trainable=True)</div></pre></td></tr></table></figure></p>
<p>è·å¾—BERTæ¨¡å‹è¾“å‡ºæ—¶éœ€è¦æŒ‡å®šsignatureã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">bert_outputs = bert_module(</div><div class="line">      inputs=bert_inputs,</div><div class="line">      signature=&quot;tokens&quot;,</div><div class="line">      as_dict=True)</div></pre></td></tr></table></figure></p>
<p>å…¶ä»–éƒ¨åˆ†ä¸run_classifier.pyç±»ä¼¼ã€‚</p>
<h2 id="æ–°ä»»åŠ¡"><a href="#æ–°ä»»åŠ¡" class="headerlink" title="æ–°ä»»åŠ¡"></a>æ–°ä»»åŠ¡</h2><p>å¯¹äºä¸€ä¸ªæ–°ä»»åŠ¡ï¼Œå¯å‚è€ƒrun_classifier.pyä»£ç è¿›è¡Œä¿®æ”¹ï¼Œä¸»è¦ä¿®æ”¹æ•°æ®å¤„ç†ã€æ¨¡å‹å»ºç«‹ç­‰éƒ¨åˆ†ï¼Œå…·ä½“åœ°ï¼ŒInputExampleï¼ŒInputFeaturesï¼Œconvert_examples_to_featureså’Œcreate_modelå‡½æ•°ç­‰ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/15/æ–‡æœ¬æŸ¥é‡-SimHashå’ŒMinHashç®—æ³•/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeb">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°èœé¸¡">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/15/æ–‡æœ¬æŸ¥é‡-SimHashå’ŒMinHashç®—æ³•/" itemprop="url">æ–‡æœ¬æŸ¥é‡-SimHashå’ŒMinHashç®—æ³•</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-05-15T15:16:45+08:00">
                2019-05-15
              </time>
            

            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>

<script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<p>SimHashå’ŒMinHashç®—æ³•ä¸»è¦åº”ç”¨äºæµ·é‡æ–‡æœ¬æŸ¥é‡ï¼Œä¸¤è€…éƒ½å±äº<a href="https://www.cnblogs.com/wt869054461/p/8148940.html" target="_blank" rel="external">å±€éƒ¨æ•æ„Ÿå“ˆå¸Œ</a>ï¼ˆLocality-Sensitive Hashing, LSHï¼‰ç®—æ³•ï¼Œè€ŒLSHåˆæ˜¯<a href="http://www.cnblogs.com/ljygoodgoodstudydaydayup/p/10519253.html" target="_blank" rel="external">è¿‘ä¼¼æœ€è¿‘é‚»æŸ¥æ‰¾</a>ï¼ˆApproximate Nearest  Neighbor, ANNï¼‰ä¸­çš„ä¸€ç±»ç®—æ³•ï¼Œå…¶ä¸»è¦æ€æƒ³æ˜¯åˆ©ç”¨é™ç»´å’Œç´¢å¼•ï¼ŒåŠ å¿«æŸ¥æ‰¾è¿‡ç¨‹ã€‚</p>
<h2 id="SimHash"><a href="#SimHash" class="headerlink" title="SimHash"></a>SimHash</h2><p>ç®—æ³•çš„è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="http://dl.iteye.com/upload/attachment/437426/baf42378-e625-35d2-9a89-471524a355d8.jpg" alt=""><br>å…·ä½“è¿‡ç¨‹ä¸ºï¼š</p>
<ol>
<li>ç¡®å®šæ–‡æœ¬Docä¸­å„ä¸ªè¯è¯­ï¼ˆä¸­æ–‡éœ€åˆ†è¯ï¼‰çš„æƒé‡ï¼Œæ–¹æ³•å¯ä»¥æœ‰å¤šç§ï¼Œä¾‹å¦‚TfIdfå’ŒTextRankç®—æ³•ï¼Œåˆ™æ–‡æ¡£å¯è¡¨ç¤ºä¸º(feature, weight)ç»„æˆçš„å‘é‡ï¼›</li>
<li>åˆå§‹åŒ–ä¸€ä¸ªé•¿åº¦ä¸º64ä½ï¼ˆå¯ç»¼åˆç©ºé—´å’Œæ—¶é—´å¤æ‚åº¦è€ƒè™‘å…·ä½“æ•°å€¼ï¼‰çš„Docç‰¹å¾å‘é‡ï¼Œå„å…ƒç´ åˆå§‹åŒ–ä¸º0ï¼›</li>
<li>å¯¹Docä¸­æ¯ä¸ªè¯è¯­åˆ©ç”¨hashå‡½æ•°è®¡ç®—ä¸€ä¸ªé•¿åº¦ä¸º64ä½çš„ç‰¹å¾å‘é‡ï¼›</li>
<li>éå†è¯è¯­ç‰¹å¾å‘é‡ï¼Œå¦‚æœç¬¬iä½ä¸º1ï¼Œåˆ™Docç‰¹å¾å‘é‡å¯¹åº”ä½+wï¼Œå¦åˆ™-wï¼›</li>
<li>æ‰€æœ‰è¯è¯­å¤„ç†å®Œæ¯•åï¼Œåˆ¤æ–­Docç‰¹å¾å‘é‡çš„æ¯ä¸€ä½ï¼Œå¦‚æœå¤§äº0ï¼Œåˆ™ç½®1ï¼Œå¦åˆ™ç½®0ï¼›</li>
<li>è·å¾—å„Docçš„ç‰¹å¾å‘é‡åï¼Œå¯åˆ©ç”¨æµ·æ˜è·ç¦»åˆ¤æ–­ä¸¤ç¯‡æ–‡æ¡£çš„ç›¸ä¼¼æ€§ï¼Œä¸€èˆ¬åœ°ï¼Œè·ç¦»&lt;=3æ—¶è®¤ä¸ºä¸¤è€…æ˜¯ç›¸ä¼¼çš„ã€‚</li>
</ol>
<p>ä¸Šè¿°è¿‡ç¨‹å¯ä»¥ç†è§£ä¸ºDocçš„ç‰¹å¾é™ç»´è¿‡ç¨‹ï¼Œæˆ‘ä»¬å°†é™ç»´åçš„ç‰¹å¾å‘é‡æˆä¸ºfingerprintsã€‚å®Œæˆé™ç»´åï¼Œæˆ‘ä»¬éœ€è¦æ€è€ƒå¦‚ä½•è®¾è®¡ç´¢å¼•æ¥åŠ å¿«æŸ¥æ‰¾è¿‡ç¨‹ã€‚<br>ç¬¬ä¸€ç§æ–¹æ¡ˆæ˜¯å¯¹æŸ¥è¯¢å‘é‡Qè¿›è¡Œå˜åŒ–ï¼ŒæŸ¥æ‰¾64ä½æ‰€æœ‰3ä½ä»¥å†…çš„å˜åŒ–çš„ç»„åˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="http://dl.iteye.com/upload/attachment/438114/ae5a47cb-068c-32b6-a4d5-6a5b808b0b26.jpg" alt=""><br>å•ä¸€å†…å®¹Qéœ€è¦è¿›è¡Œå››ä¸‡å¤šæ¬¡æŸ¥è¯¢ï¼Œæ—¶é—´å¤æ‚åº¦å¤ªé«˜ã€‚<br>ç¬¬äºŒç§æ–¹æ¡ˆæ˜¯å¯¹å·²ç”ŸæˆDocçš„fingerprintsè¿›è¡Œ3ä½ä»¥å†…çš„ç»„åˆå˜åŒ–ï¼Œä½†éœ€è¦å¤šå æ®å››ä¸‡å¤šå€çš„åŸå§‹ç©ºé—´ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="http://dl.iteye.com/upload/attachment/437527/d31f3880-d43e-33ac-89c3-3e11a3f4f95e.jpg" alt=""><br>å¦‚ä½•æ‰¾åˆ°ä¸€ç§ç©ºé—´å’Œæ—¶é—´çš„å¹³è¡¡å‘¢ï¼Ÿå‡è®¾æµ·æ˜è·ç¦»åœ¨3ä»¥å†…çš„ä¸¤ä¸ªæ–‡æ¡£æ˜¯ç›¸ä¼¼çš„ï¼Œé‚£ä¹ˆåªè¦å°†64ä½çš„äºŒè¿›åˆ¶ä¸²åˆ†ä¸º4å—ï¼Œæ ¹æ®é¸½å·¢åŸç†ï¼Œä¸¤ä¸ªæ–‡æ¡£çš„fingerprintsä¸­è‡³å°‘æœ‰ä¸€å—æ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="http://dl.iteye.com/upload/attachment/437559/689719df-54b7-318c-bc90-e289f84344b9.jpg" alt=""><br>ç”±äºæŸ¥è¯¢æ—¶æ— æ³•é¢„çŸ¥æ˜¯å“ªä¸€å—åŒºåŸŸç›¸åŒï¼Œå› æ­¤éœ€è¦å¯¹å››å—ä¸­çš„æ¯ä¸€å—éƒ½å»ºç«‹ç´¢å¼•ï¼Œå‡è®¾æ ·æœ¬åº“ä¸­æœ‰<span>$2^32$</span><!-- Has MathJax -->ï¼Œçº¦43äº¿çš„fingerprintsï¼Œé‚£ä¹ˆæ¯ä¸ªtableä¸­åŒ…å«<span>$2^(32-16)$</span><!-- Has MathJax -->=65536ä¸ªå€™é€‰ç»“æœï¼Œå¤§å¤§å‡å°‘äº†æµ·æ˜è·ç¦»çš„è®¡ç®—æˆæœ¬ã€‚ä¸Šå›¾æ‰€ç¤ºçš„ç´¢å¼•ç»“æ„åœ¨MongoDBä¸­å®ç°éå¸¸ç®€å•ã€‚æ­¤å¤–ï¼Œç´¢å¼•å—æ•°kå’Œtableä¸­å€™é€‰ç»“æœæ•°é‡mä¹Ÿæ˜¯ä¸€ä¸ªå¹³è¡¡æŠ‰æ‹©çš„è¿‡ç¨‹ï¼Œkè¶Šå¤§ï¼Œmè¶Šå°ï¼Œç©ºé—´å¤æ‚åº¦å‡é«˜ï¼›kè¶Šå°ï¼Œmè¶Šå¤§ï¼Œæ—¶é—´å¤æ‚åº¦å‡é«˜ã€‚ä¸‹å›¾æ˜¯k=4æ—¶ç´¢å¼•ç¤ºæ„å›¾ï¼š<br><img src="http://dl.iteye.com/upload/attachment/437586/b72b8dc2-9139-3078-ad24-b689f64fd71a.jpg" alt=""></p>
<h2 id="MinHash"><a href="#MinHash" class="headerlink" title="MinHash"></a>MinHash</h2><p>ä¸SimHashä¸åŒï¼ŒMinHashè¦ä»è¡¡é‡ä¸¤ä¸ªæ–‡æ¡£çš„ç›¸ä¼¼åº¦è¯´èµ·ã€‚Jaccardç›¸ä¼¼åº¦ç”¨äºæè¿°ä¸¤ä¸ªé›†åˆçš„ç›¸ä¼¼ç¨‹åº¦ï¼Œå‡è®¾æœ‰ä¸¤ä¸ªé›†åˆAå’ŒBï¼Œç›¸ä¼¼åº¦=Aä¸Bäº¤é›†çš„å…ƒç´ ä¸ªæ•°ï¼Aä¸Bå¹¶é›†çš„å…ƒç´ ä¸ªæ•°ï¼Œå…¬å¼ä¸ºï¼š<br><span>$$\begin{gather*}
J(A, B)=\frac{|A \cap B|}{|A \cup B|}
\end{gather*}$$</span><!-- Has MathJax --><br>æµ·é‡æ–‡æœ¬ç›´æ¥æ±‚Jaccardç›¸ä¼¼åº¦å¤æ‚åº¦å¤ªé«˜ï¼Œä¸¤ä¸ªæ–‡æ¡£éœ€è¦é€ä¸ªè¯æ¯”è¾ƒï¼Œä¸ºé™ä½å¤æ‚åº¦ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸¤ä¸ªæ–‡æ¡£çš„æœ€å°å“ˆå¸Œå€¼ç›¸ç­‰çš„æ¦‚ç‡æ¥ç­‰ä»·äºä¸¤ä¸ªæ–‡æ¡£çš„Jaccardç›¸ä¼¼åº¦ï¼Œå¹¶å¯ä»¥è¯æ˜ä¸¤è€…æ˜¯ç›¸ç­‰çš„ã€‚é¦–å…ˆè¯´æ˜ä¸€ä¸‹å¦‚ä½•æ±‚ä¸€ä¸ªé›†åˆçš„æœ€å°å“ˆå¸Œå€¼ï¼Œå‡è®¾ç°åœ¨æœ‰4ä¸ªé›†åˆï¼Œåˆ†åˆ«ä¸ºS1ï¼ŒS2ï¼ŒS3ï¼ŒS4ï¼›å…¶ä¸­ï¼ŒS1={a,d}, S2={c}, S3={b,d,e}, S4={a,c,d}ï¼Œæ‰€ä»¥å…¨é›†U={a,b,c,d,e}ã€‚æˆ‘ä»¬å¯ä»¥æ„é€ å¦‚ä¸‹0-1çŸ©é˜µï¼š</p>
<table>
<thead>
<tr>
<th>å…ƒç´ </th>
<th>S1</th>
<th>S2</th>
<th>S3</th>
<th>S4</th>
</tr>
</thead>
<tbody>
<tr>
<td>a</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>b</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>c</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>d</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>e</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>ä¸ºå¾—åˆ°å„é›†åˆçš„æœ€å°å“ˆå¸Œå€¼ï¼Œé¦–å…ˆå¯¹çŸ©é˜µè¿›è¡Œéšæœºè¡Œæ‰“ä¹±ï¼Œåˆ™æŸä¸ªé›†åˆï¼ˆæŸä¸€åˆ—ï¼‰çš„æœ€å°å“ˆå¸Œå€¼å°±ç­‰äºæ‰“ä¹±åç¬¬ä¸€ä¸ªå€¼ä¸º1çš„è¡Œæ‰€åœ¨çš„è¡Œå·ã€‚å®šä¹‰ä¸€ä¸ªæœ€å°å“ˆå¸Œå‡½æ•°hï¼Œç”¨äºæ¨¡æ‹Ÿå¯¹çŸ©é˜µè¿›è¡Œéšæœºæ‰“ä¹±ï¼Œå‡è®¾æ‰“ä¹±åçš„çŸ©é˜µå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>
<table>
<thead>
<tr>
<th>å…ƒç´ </th>
<th>S1</th>
<th>S2</th>
<th>S3</th>
<th>S4</th>
</tr>
</thead>
<tbody>
<tr>
<td>b</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>e</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>a</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>d</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>c</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>åˆ™h(S1)=2, h(S2)=4, h(S3)=0, h(S4)=2ã€‚ç»è¿‡éšæœºæ‰“ä¹±åï¼Œä¸¤ä¸ªé›†åˆçš„æœ€å°å“ˆå¸Œå€¼ç›¸ç­‰çš„æ¦‚ç‡=ä¸¤é›†åˆçš„Jaccardçš„ç›¸ä¼¼åº¦è¯æ˜å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>ä»…è€ƒè™‘é›†åˆS1å’ŒS2ï¼Œé‚£ä¹ˆè¿™ä¸¤åˆ—æ‰€åœ¨çš„è¡Œæœ‰ä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š</p>
<ol>
<li>S1å’ŒS2çš„å€¼éƒ½ä¸º1ï¼Œç”¨Xè¡¨ç¤ºï¼›</li>
<li>ä¸€ä¸ªå€¼ä¸º1ï¼Œå¦ä¸€ä¸ªä¸º0ï¼Œç”¨Yè¡¨ç¤ºï¼›</li>
<li>S1å’ŒS2çš„å€¼éƒ½ä¸º0ï¼Œç”¨Zè¡¨ç¤ºã€‚</li>
</ol>
</blockquote>
<p>S1ä¸S2çš„äº¤é›†å…ƒç´ ä¸ªæ•°ä¸ºXï¼Œå¹¶é›†ä¸ªæ•°ä¸ºX+Yï¼Œæ‰€ä»¥sim(S1,S2)=Jaccard(S1,S2)=X/(X+Y)ã€‚éšæœºæ‰“ä¹±åh(S1)=h(S2)çš„æ¦‚ç‡ç­‰äºä»ä¸Šå¾€ä¸‹æ‰«æï¼Œåœ¨é‡åˆ°Yè¡Œä¹‹å‰é‡åˆ°Xè¡Œçš„æ¦‚ç‡ï¼ˆZè¡Œæ²¡æœ‰å½±å“ï¼‰ï¼Œæˆ–è€…è¯´æŠŠXä¸ªé»‘çƒå’ŒYä¸ªç™½çƒæ”¾å…¥ä¸€ä¸ªè¢‹å­ä¸­ï¼Œé¦–æ¬¡æ‹¿åˆ°é»‘çƒçš„æ¦‚ç‡ï¼Œå³h(S1)=h(S2)çš„æ¦‚ç‡ä¸ºX/(X+Y)ã€‚å‡è®¾ç‰¹å¾çŸ©é˜µå¾ˆå¤§æ—¶ï¼Œå¯¹å…¶è¿›è¡Œæ‰“ä¹±éå¸¸è€—æ—¶ï¼Œè€Œä¸”è¦è¿›è¡Œå¤šæ¬¡æ‰“ä¹±ï¼Œå…¶å®å¯ä»¥é€šè¿‡å¤šä¸ªéšæœºå“ˆå¸Œå‡½æ•°æ¥æ¨¡æ‹Ÿæ‰“ä¹±çš„æ•ˆæœã€‚å…·ä½“åœ°ï¼Œå®šä¹‰nä¸ªéšæœºå“ˆå¸Œå‡½æ•°$h_1, h_2,â€¦,h_n$ï¼Œsig(i,j)è¡¨ç¤ºç­¾åçŸ©é˜µä¸­ç¬¬iä¸ªå“ˆå¸Œå‡½æ•°åœ¨ç¬¬jåˆ—ä¸Šçš„å…ƒç´ ï¼Œå°†ç­¾åçŸ©é˜µä¸­å„ä¸ªå…ƒç´ sig(i,j)åˆå§‹åŒ–ä¸ºinf(æ— ç©·å¤§)ï¼Œå¯¹åŸçŸ©é˜µä¸­æ¯ä¸€è¡Œrï¼š</p>
<ol>
<li>è®¡ç®—<span>$h_1(r),h_2(r),...,h_n(r)$</span><!-- Has MathJax -->ï¼›</li>
<li>å¯¹äºæ¯ä¸€åˆ—jï¼š<ul>
<li>å¦‚æœjæ‰€åœ¨çš„ç¬¬rè¡Œä¸º0ï¼Œä»€ä¹ˆéƒ½ä¸åšï¼›</li>
<li>å¦‚æœjæ‰€åœ¨çš„ç¬¬rè¡Œä¸º1ï¼Œåˆ™å¯¹æ¯ä¸ªi=1,2,â€¦,nï¼Œ<span>$sig(i,j)=min(sig(i,j), h_i(r))$</span><!-- Has MathJax --></li>
</ul>
</li>
</ol>
<p>ä¾‹å¦‚<span>$h_1(x)=(x+1)%5, h_2(x)=(3*x+1)%5$</span><!-- Has MathJax -->ï¼Œåˆ™ç»è¿‡ä¸Šè¿°æ“ä½œå¯è·å¾—å¦‚ä¸‹çš„ç­¾åçŸ©é˜µï¼š</p>
<table>
<thead>
<tr>
<th>å“ˆå¸Œå‡½æ•°</th>
<th>S1</th>
<th>S2</th>
<th>S3</th>
<th>S4</th>
</tr>
</thead>
<tbody>
<tr>
<td>$h_1$</td>
<td>1</td>
<td>3</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>$h_2$</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>ä¸Šè¿°è·å¾—å„æ–‡æ¡£ç­¾åçŸ©é˜µå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªé™ç»´è¿‡ç¨‹ï¼Œè·å¾—ç­¾ååï¼Œå‡å¦‚æ•°æ®é‡ååˆ†åºå¤§çš„è¯ï¼Œä¸¤ä¸¤æ¯”è¾ƒçš„è¯è®¡ç®—å¤æ‚åº¦ä»ç„¶éå¸¸é«˜ï¼Œæ‰€ä»¥éœ€è¦ç±»ä¼¼SimHashç´¢å¼•åˆ†å—çš„æ–¹æ³•æ¥é™ä½æŸ¥è¯¢å¤æ‚åº¦ã€‚å½“ä¸€ä¸ªæ–°æ–‡æ¡£åˆ°è¾¾æ—¶ï¼Œå¸Œæœ›ä»…æ¯”è¾ƒä¸å…¶ç›¸ä¼¼æ€§è¾ƒé«˜çš„æ–‡æ¡£ï¼Œå¿½ç•¥ç›¸ä¼¼æ€§è¾ƒä½çš„é›†åˆã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå‡è®¾ç­¾åçŸ©é˜µæœ‰12è¡Œï¼Œæˆ‘ä»¬å°†3è¡Œä¸ºä¸€ç»„æ”¾è¿›ä¸€ä¸ªâ€œæ¡¶â€é‡Œï¼š<br><img width="500" src="/images/bucket.png"><br>å¯¹äºS2ï¼Œä»…éœ€è¦æŸ¥è¯¢ä¸å…¶å…·æœ‰ç›¸åŒæ¡¶çš„é›†åˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img width="500" src="/images/bucket5.png"><br>å³åªéœ€è¦æŸ¥è¯¢S4å’ŒS5ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote>
<p><a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.295.8001&amp;rep=rep1&amp;type=pdf" target="_blank" rel="external">http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.295.8001&amp;rep=rep1&amp;type=pdf</a><br><a href="https://blog.csdn.net/heiyeshuwu/article/details/44117473" target="_blank" rel="external">https://blog.csdn.net/heiyeshuwu/article/details/44117473</a><br><a href="https://www.cnblogs.com/sddai/p/6110704.html" target="_blank" rel="external">https://www.cnblogs.com/sddai/p/6110704.html</a></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/14/TextRankç®—æ³•/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeb">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°èœé¸¡">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/14/TextRankç®—æ³•/" itemprop="url">TextRankç®—æ³•</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-05-14T15:25:17+08:00">
                2019-05-14
              </time>
            

            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>

<script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<p>TextRankç®—æ³•å¯ä»¥ç”¨äºæå–æ–‡æœ¬å…³é”®è¯å’Œç”Ÿæˆæ‘˜è¦ï¼Œå…¶æ€æƒ³æ¥æºäºPageRankç®—æ³•ã€‚Googleä¸¤ä½åˆ›å§‹äººï¼Œåœ¨æ–¯å¦ç¦å¤§å­¦è¯»ç ”æœŸé—´ä»äº‹ç½‘é¡µæ’åºç ”ç©¶æ—¶ï¼Œå—åˆ°å­¦æœ¯ç•Œå¯¹å­¦æœ¯è®ºæ–‡é‡è¦æ€§çš„è¯„ä¼°æ–¹æ³•ï¼ˆè®ºæ–‡å¼•ç”¨æ¬¡æ•°ï¼‰ï¼Œæå‡ºäº†PageRankç®—æ³•ã€‚PageRankç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ¯”è¾ƒç›´è§‚ï¼š</p>
<ol>
<li>å¦‚æœä¸€ä¸ªç½‘é¡µè¢«å¾ˆå¤šå…¶ä»–ç½‘é¡µé“¾æ¥åˆ°ï¼Œè¯´æ˜è¿™ä¸ªç½‘é¡µå¾ˆé‡è¦ï¼Œå¯¹åº”çš„PR(PageRank)å€¼ä¹Ÿè¶Šé«˜ï¼›</li>
<li>å¦‚æœä¸€ä¸ªPRå€¼è¾ƒé«˜çš„ç½‘é¡µé“¾æ¥äº†æŸä¸ªç½‘é¡µï¼Œåˆ™è¯¥ç½‘é¡µçš„PRå€¼ä¹Ÿä¼šç›¸åº”æé«˜ã€‚</li>
</ol>
<h2 id="ç®—æ³•åŸç†"><a href="#ç®—æ³•åŸç†" class="headerlink" title="ç®—æ³•åŸç†"></a>ç®—æ³•åŸç†</h2><h3 id="PageRank"><a href="#PageRank" class="headerlink" title="PageRank"></a>PageRank</h3><p>å°†ç½‘é¡µä¹‹é—´çš„é“¾æ¥æŠ½è±¡ä¸ºä¸€å¼ æœ‰å‘å›¾ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img width="500" src="/images/dgraph.png"></p>
<p><center><strong><em><a href="https://www.cnblogs.com/mcomco/p/10304383.html" target="_blank" rel="external">å›¾ç‰‡æ¥æº</a></em></strong></center><br>å›¾ç»“æ„æ„é€ å®Œæˆåï¼Œå¯ä½¿ç”¨ä»¥ä¸‹å…¬å¼è®¡ç®—ç½‘é¡µçš„PRå€¼ï¼š<br><span>$$\begin{gather*}
S\left(V_{i}\right)=(1-d)+d * \sum_{j \in I n\left(V_{i}\right)} \frac{1}{\left|O u t\left(V_{j}\right)\right|} S\left(V_{j}\right)
\end{gather*}$$</span><!-- Has MathJax --><br><span>$S\left(V_{i}\right)$</span><!-- Has MathJax -->è¡¨ç¤ºç½‘é¡µiçš„PRå€¼ï¼Œå³ç½‘é¡µçš„é‡è¦æ€§æŒ‡æ ‡ã€‚dæ˜¯é˜»å°¼ç³»æ•°ï¼Œä¸€èˆ¬å–0.85ã€‚<span>$I n\left(V_{i}\right)$</span><!-- Has MathJax -->è¡¨ç¤ºæŒ‡å‘ç½‘é¡µiçš„ç½‘é¡µé›†åˆã€‚<span>$|O u t\left(V_{j}\right)|$</span><!-- Has MathJax -->è¡¨ç¤ºç½‘é¡µjæŒ‡å‘çš„ç½‘é¡µæ€»æ•°ï¼Œ<span>$S\left(V_{j}\right)$</span><!-- Has MathJax -->è¡¨ç¤ºç½‘é¡µjçš„PRå€¼ã€‚å¯å°†å„ç½‘é¡µPRå€¼è®¾ç½®ä¸º1ï¼Œç»è¿‡å¤šæ¬¡è¿­ä»£ï¼Œæ»¡è¶³æ”¶æ•›æ¡ä»¶åè·å¾—å„ä¸ªç½‘é¡µçš„PRå€¼ã€‚</p>
<h3 id="TextRank"><a href="#TextRank" class="headerlink" title="TextRank"></a>TextRank</h3><h4 id="å…³é”®è¯æå–"><a href="#å…³é”®è¯æå–" class="headerlink" title="å…³é”®è¯æå–"></a>å…³é”®è¯æå–</h4><p>ä»¥ä¸‹é¢çš„æ–‡ç« ä¸ºä¾‹ï¼Œé¦–å…ˆè¿›è¡Œè¿‡æ»¤åœç”¨è¯ç­‰é¢„å¤„ç†ï¼ˆä¸­æ–‡éœ€è¦åˆ†è¯ï¼‰ï¼Œç„¶åå»ºç«‹å¦‚å›¾æ‰€ç¤ºå•è¯ä¹‹é—´çš„è¿æ¥å›¾ï¼Œæ­¤æ—¶PageRankç®—æ³•ä¸­ç½‘é¡µä¹‹é—´çš„é“¾æ¥å…³ç³»ä½“ç°ä¸ºä¸€å®šçª—å£å¤§å°å†…å•è¯ä¹‹é—´çš„ç›¸é‚»å…³ç³»ï¼Œä¾‹å¦‚ä»¥â€œsystemsâ€ä¸ºä¸­å¿ƒï¼Œçª—å£å¤§å°ä¸º3æ—¶ï¼Œâ€typesâ€, â€œlinearâ€å’Œâ€œcompatibilityâ€ä¸å…¶å…·æœ‰â€œé“¾æ¥å…³ç³»â€œã€‚<br><img src="/images/keywords.png" alt=""></p>
<p><center><strong><em><a href="https://upload-images.jianshu.io/upload_images/3579920-09c220dd15b3f13b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/996" target="_blank" rel="external">å›¾ç‰‡æ¥æº</a></em></strong></center><br>å›¾æ„é€ å®Œæˆåï¼Œå•è¯çš„TRå€¼è®¡ç®—å…¬å¼ä¸ºï¼š<br><span>$$\begin{gather*}
W S\left(V_{i}\right)=(1-d)+d * \sum_{V_{j} \in I n\left(V_{i}\right)} \frac{w_{j i}}{\sum_{V_{k} \in O u t\left(V_{j}\right)} w_{j k}} W S\left(V_{j}\right)
\end{gather*}$$</span><!-- Has MathJax --><br>TRå€¼è®¡ç®—å…¬å¼ä¸PRå€¼ååˆ†ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºåŠ å…¥äº†ä¸€ä¸ªå‚æ•°<span>$w_{j i}$</span><!-- Has MathJax -->ï¼Œä¸€èˆ¬æ¥è¯´<span>$w_{j i}$</span><!-- Has MathJax -->çš„å€¼ä¸ºæ–‡ç« ä¸­ç¬¬jä¸ªå•è¯å’Œç¬¬iä¸ªå•è¯åœ¨ä¸€å®šçª—å£å¤§å°çš„å…±ç°æ¬¡æ•°ã€‚åç»­çš„è¿­ä»£è¿‡ç¨‹ä¸PRå€¼è®¡ç®—ç±»ä¼¼ã€‚</p>
<h4 id="æ‘˜è¦ç”Ÿæˆ"><a href="#æ‘˜è¦ç”Ÿæˆ" class="headerlink" title="æ‘˜è¦ç”Ÿæˆ"></a>æ‘˜è¦ç”Ÿæˆ</h4><p>å°†æ–‡æœ¬ä¸­çš„æ¯ä¸ªå¥å­çœ‹ä½œå›¾ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¥å­ä¹‹é—´çš„â€œé“¾æ¥å…³ç³»â€ç”±å¥å­é—´çš„ç›¸ä¼¼æ€§ä½“ç°ã€‚å¥å­ç›¸ä¼¼æ€§æœ‰å¤šç§è®¡ç®—æ–¹å¼ï¼Œè¿™é‡Œä½¿ç”¨ä¸€ç§å¾ˆç®€å•çš„æ–¹æ³•ï¼Œè®¡ç®—ä¸¤ä¸ªå¥å­å…±æœ‰è¯æ¯”ä¾‹ã€‚å¥å­ç›¸ä¼¼æ€§å…¬å¼ï¼š<br><span>$$\begin{gather*}
\text {Similarity}\left(S_{i}, S_{j}\right)=\frac{\left|\left\{w_{k} | w_{k} \in S_{i} \&amp; w_{k} \in S_{j}\right\}\right|}{\log \left(\left|S_{i}\right|\right)+\log \left(\left|S_{j}\right|\right)}
\end{gather*}$$</span><!-- Has MathJax --><br><span>$S_{i}, S_{j}$</span><!-- Has MathJax -->åˆ†åˆ«è¡¨ç¤ºç¬¬iä¸ªå’Œç¬¬jä¸ªå¥å­ï¼Œ$w_{k}$è¡¨ç¤ºå¥å­ä¸­çš„è¯è¯­ï¼Œå…¬å¼ä¸­åˆ†å­è¡¨ç¤ºä¸¤ä¸ªå¥å­å…±æœ‰è¯çš„ä¸ªæ•°ï¼Œåˆ†æ¯è¡¨ç¤ºä¸¤ä¸ªå¥å­è¯æ€»æ•°å¯¹æ•°æ±‚å’Œã€‚åç»­TRå€¼è®¡ç®—å’Œè¿­ä»£è¿‡ç¨‹ä¸å…³é”®è¯æå–ç±»ä¼¼ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote>
<p><a href="http://www.cnblogs.com/xueyinzhe/p/7101295.html" target="_blank" rel="external">http://www.cnblogs.com/xueyinzhe/p/7101295.html</a><br><a href="https://blog.csdn.net/woshiliulei0/article/details/81479434" target="_blank" rel="external">https://blog.csdn.net/woshiliulei0/article/details/81479434</a></p>
</blockquote>
<p><strong><em>æœ¬æ–‡ä¸­å›¾ç‰‡å‡æ¥è‡ªäº’è”ç½‘</em></strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/07/ä½¿ç”¨TensorFlow-Servingå¿«é€Ÿéƒ¨ç½²æ¨¡å‹/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeb">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°èœé¸¡">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/07/ä½¿ç”¨TensorFlow-Servingå¿«é€Ÿéƒ¨ç½²æ¨¡å‹/" itemprop="url">ä½¿ç”¨TensorFlow Servingå¿«é€Ÿéƒ¨ç½²æ¨¡å‹</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-05-07T11:41:42+08:00">
                2019-05-07
              </time>
            

            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="å·¥ä¸šäº§å“ä¸­TensorFlowä½¿ç”¨æ–¹æ³•"><a href="#å·¥ä¸šäº§å“ä¸­TensorFlowä½¿ç”¨æ–¹æ³•" class="headerlink" title="å·¥ä¸šäº§å“ä¸­TensorFlowä½¿ç”¨æ–¹æ³•"></a>å·¥ä¸šäº§å“ä¸­TensorFlowä½¿ç”¨æ–¹æ³•</h1><ol>
<li>ç”¨TensorFlowçš„C++/Java/Nodejs APIç›´æ¥ä½¿ç”¨ä¿å­˜çš„TensorFlowæ¨¡å‹ï¼šç±»ä¼¼Caffeï¼Œé€‚åˆåšæ¡Œé¢è½¯ä»¶ã€‚</li>
<li>ç›´æ¥å°†ä½¿ç”¨TensorFlowçš„Pythonä»£ç æ”¾åˆ°Flaskç­‰Webç¨‹åºä¸­ï¼Œæä¾›Restfulæ¥å£ï¼šå®ç°å’Œè°ƒè¯•æ–¹ä¾¿ï¼Œä½†æ•ˆç‡ä¸å¤ªé«˜ï¼Œä¸å¤§é€‚åˆé«˜è´Ÿè·åœºæ™¯ï¼Œä¸”æ²¡æœ‰ç‰ˆæœ¬ç®¡ç†ã€æ¨¡å‹çƒ­æ›´æ–°ç­‰åŠŸèƒ½ã€‚</li>
<li>å°†TensorFlowæ¨¡å‹æ‰˜ç®¡åˆ°TensorFlow Servingä¸­ï¼Œæä¾›RPCæˆ–RestfulæœåŠ¡ï¼šå®ç°æ–¹ä¾¿ï¼Œé«˜æ•ˆï¼Œè‡ªå¸¦ç‰ˆæœ¬ç®¡ç†ã€æ¨¡å‹çƒ­æ›´æ–°ç­‰ï¼Œå¾ˆé€‚åˆå¤§è§„æ¨¡çº¿ä¸Šä¸šåŠ¡ã€‚</li>
</ol>
<blockquote>
<p>å‚è€ƒé“¾æ¥ï¼š<a href="https://cloud.tencent.com/developer/article/1375668" target="_blank" rel="external">https://cloud.tencent.com/developer/article/1375668</a> </p>
</blockquote>
<h1 id="TensorFlow-Servingç®€ä»‹"><a href="#TensorFlow-Servingç®€ä»‹" class="headerlink" title="TensorFlow Servingç®€ä»‹"></a>TensorFlow Servingç®€ä»‹</h1><p><a href="https://github.com/tensorflow/serving" target="_blank" rel="external">Tensorflow Serving</a>æ˜¯Googleå®˜æ–¹æä¾›çš„æ¨¡å‹éƒ¨ç½²æ–¹å¼ï¼Œæ­£ç¡®å¯¼å‡ºæ¨¡å‹åï¼Œå¯ä¸€åˆ†é’Ÿå®Œæˆéƒ¨ç½²ï¼ˆå®˜æ–¹å¹¿å‘Šï¼‰ã€‚TF1.8åï¼ŒTensorflow Servingæ”¯æŒRESTfull APIå’Œgrpcçš„è¯·æ±‚æ–¹å¼ï¼Œæ¨¡å‹éƒ¨ç½²å®Œæˆåå¯å¾ˆæ–¹ä¾¿çš„åˆ©ç”¨postè¯·æ±‚è¿›è¡Œæµ‹è¯•ã€‚</p>
<h1 id="TensorFlow-ServingæœåŠ¡æ¡†æ¶"><a href="#TensorFlow-ServingæœåŠ¡æ¡†æ¶" class="headerlink" title="TensorFlow ServingæœåŠ¡æ¡†æ¶"></a>TensorFlow ServingæœåŠ¡æ¡†æ¶</h1><p>æ¡†æ¶åˆ†ä¸ºæ¨¡å‹è®­ç»ƒã€æ¨¡å‹ä¸Šçº¿å’ŒæœåŠ¡ä½¿ç”¨ä¸‰éƒ¨åˆ†ã€‚æ¨¡å‹è®­ç»ƒä¸æ­£å¸¸çš„è®­ç»ƒè¿‡ç¨‹ä¸€è‡´ï¼Œåªæ˜¯å¯¼å‡ºæ—¶éœ€è¦æŒ‰ç…§TF Servingçš„æ ‡å‡†å®šä¹‰è¾“å…¥ã€è¾“å‡ºå’Œç­¾åã€‚æ¨¡å‹ä¸Šçº¿æ—¶æŒ‡å®šç«¯å£å·å’Œæ¨¡å‹è·¯å¾„åï¼Œé€šè¿‡tensorflow_model_serverå‘½ä»¤å¯åŠ¨æœåŠ¡ã€‚æœåŠ¡ä½¿ç”¨å¯é€šè¿‡grpcå’ŒRESTfullæ–¹å¼è¯·æ±‚ã€‚<br><img width="724" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_jpg/rFWVXwibLGtzxrqiba6BicbqCjDDQ313ohCZJQ5u0LTnK5okv89ibHbf2pI6YWMq05UNjjoiaxxibxd6pqk6l07T04rA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1"></p>
<h1 id="æ¨¡å‹å¯¼å‡º"><a href="#æ¨¡å‹å¯¼å‡º" class="headerlink" title="æ¨¡å‹å¯¼å‡º"></a>æ¨¡å‹å¯¼å‡º</h1><p>éœ€æŒ‡å®šæ¨¡å‹çš„è¾“å…¥å’Œè¾“å‡ºï¼Œå¹¶åœ¨tagsä¸­åŒ…å«â€serveâ€ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­ï¼ŒTF Servingè¦æ±‚å¯¼å‡ºæ¨¡å‹åŒ…å«â€serveâ€è¿™ä¸ªtagã€‚æ­¤å¤–ï¼Œè¿˜éœ€è¦æŒ‡å®šé»˜è®¤ç­¾åï¼Œtf.saved_model.signature_constants.DEFAULT_SERVING_SIGNATURE_DEF_KEY = â€œserving_defaultâ€ï¼Œæ­¤å¤–tf.saved_model.signature_constantså®šä¹‰äº†ä¸‰ç±»ç­¾åï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>åˆ†ç±»classify</li>
<li>å›å½’regress</li>
<li>é¢„æµ‹predict</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">CLASSIFY_METHOD_NAME = &quot;tensorflow/serving/classify&quot;</div><div class="line">PREDICT_METHOD_NAME = &quot;tensorflow/serving/predict&quot;</div><div class="line">REGRESS_METHOD_NAME = &quot;tensorflow/serving/regress&quot;</div></pre></td></tr></table></figure>
<p>ä¸€èˆ¬è€Œè¨€ï¼Œç”¨predictå°±å®Œäº‹äº†ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">with sess.graph.as_default() as graph:</div><div class="line">    builder = tf.saved_model.builder.SavedModelBuilder(saved_model_dir)</div><div class="line">    signature = tf.saved_model.signature_def_utils.predict_signature_def(inputs=&#123;&apos;image&apos;: in_image&#125;,</div><div class="line">                                      outputs=&#123;&apos;prediction&apos;: graph.get_tensor_by_name(&apos;final_result:0&apos;)&#125;,)</div><div class="line">    builder.add_meta_graph_and_variables(sess=sess,</div><div class="line">                                         tags=[&quot;serve&quot;],</div><div class="line">                                         signature_def_map=&#123;&apos;predict&apos;:signature, tf.saved_model.signature_constants.DEFAULT_SERVING_SIGNATURE_DEF_KEY:signature&#125;)</div><div class="line">    builder.save()</div></pre></td></tr></table></figure></p>
<h1 id="å¯åŠ¨æœåŠ¡"><a href="#å¯åŠ¨æœåŠ¡" class="headerlink" title="å¯åŠ¨æœåŠ¡"></a>å¯åŠ¨æœåŠ¡</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tensorflow_model_server --port=8500 --rest_api_port=8501 --model_name=æ¨¡å‹å --model_base_path=æ¨¡å‹æ‰€åœ¨è·¯å¾„</div></pre></td></tr></table></figure>
<h1 id="è¯·æ±‚æœåŠ¡"><a href="#è¯·æ±‚æœåŠ¡" class="headerlink" title="è¯·æ±‚æœåŠ¡"></a>è¯·æ±‚æœåŠ¡</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -d &apos;&#123;&quot;inputs&quot;: [[1.1,1.2,0.8,1.3]]&#125;&apos; -X POST http://localhost:8501/v1/models/æ¨¡å‹å:predict</div></pre></td></tr></table></figure>
<p>pythonå¯ä»¥é€šè¿‡postè¯·æ±‚ï¼Œgolangå¯ä»¥é€šè¿‡grpcæœåŠ¡è¯·æ±‚ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/07/åŸºäºTensorflow-Hubè¿›è¡Œè¿ç§»å­¦ä¹ å®Œæˆäººè„¸BMIæŒ‡æ•°é¢„æµ‹/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeb">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°èœé¸¡">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/07/åŸºäºTensorflow-Hubè¿›è¡Œè¿ç§»å­¦ä¹ å®Œæˆäººè„¸BMIæŒ‡æ•°é¢„æµ‹/" itemprop="url">åŸºäºTensorflow Hubè¿›è¡Œè¿ç§»å­¦ä¹ å®Œæˆäººè„¸BMIæŒ‡æ•°é¢„æµ‹</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-05-07T11:23:00+08:00">
                2019-05-07
              </time>
            

            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Tensorflow-Hub"><a href="#Tensorflow-Hub" class="headerlink" title="Tensorflow Hub"></a>Tensorflow Hub</h1><p>TF Hubæ˜¯ä¸€ä¸ªé€šè¿‡å¤ç”¨Tensorflow modelsæ¥å®Œæˆè¿ç§»å­¦ä¹ çš„æ¨¡å‹åº“ï¼Œç›®å‰æœ‰è‡ªç„¶è¯­è¨€ã€å›¾åƒå’Œè§†é¢‘ä¸‰å¤§ç±»ï¼Œå…·ä½“å¯å‚è€ƒä¸‹é¢é“¾æ¥ï¼ˆéƒ¨åˆ†é¡µé¢éœ€è¦ç¿»å¢™ï¼Œä½ æ‡‚å¾—ï¼‰ï¼š</p>
<blockquote>
<p><a href="https://www.tensorflow.org/hub" target="_blank" rel="external">https://www.tensorflow.org/hub</a></p>
</blockquote>
<h1 id="æ¨¡å‹ç»“æ„"><a href="#æ¨¡å‹ç»“æ„" class="headerlink" title="æ¨¡å‹ç»“æ„"></a>æ¨¡å‹ç»“æ„</h1><p>é¦–å…ˆå¯¹äººç‰©å›¾ç‰‡è¿›è¡Œäººè„¸è¯†åˆ«ï¼Œç„¶ååˆ©ç”¨tfhubä¸­inception v3æ¨¡å‹æå–feature vectorï¼Œæœ€åä½¿ç”¨SVRæ¨¡å‹å®ŒæˆåŸºäºäººè„¸çš„BMIæŒ‡æ•°é¢„æµ‹ã€‚<br><img src="/images/face2bmimodel.png" alt=""></p>
<blockquote>
<p>å‚è€ƒè®ºæ–‡é“¾æ¥ï¼š<a href="https://arxiv.org/abs/1703.03156" target="_blank" rel="external">https://arxiv.org/abs/1703.03156</a></p>
</blockquote>
<h2 id="äººè„¸è¯†åˆ«"><a href="#äººè„¸è¯†åˆ«" class="headerlink" title="äººè„¸è¯†åˆ«"></a>äººè„¸è¯†åˆ«</h2><p>è¿™é‡Œä»‹ç»golangç‰ˆæœ¬è§£å†³æ–¹æ¡ˆï¼Œpythonçš„èµ„æºä¸°å¯Œï¼Œä¾‹å¦‚<a href="https://github.com/ageitgey/face_recognition" target="_blank" rel="external">face_recognition</a>ç­‰ã€‚<a href="https://github.com/Kagami/go-face" target="_blank" rel="external">go-face</a>æä¾›äº†çº¯goç‰ˆæœ¬çš„äººè„¸è¯†åˆ«åŠŸèƒ½ï¼Œä¸éœ€è¦å®‰è£…opencvç­‰å¤æ‚çš„ç¯å¢ƒä¾èµ–ï¼Œç›¸å…³çš„ä¾èµ–ä¹Ÿå¯ä»¥é€šè¿‡apt-getæ–¹å¼å¿«é€Ÿå®‰è£…ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯å…¶éœ€è¦äººè„¸è¯†åˆ«çš„æ¨¡å‹æ–‡ä»¶shape_predictorå’Œdlib_face_recognitionï¼Œå…·ä½“ä»‹ç»å¯ä»¥å‚è€ƒå…¶githubä¸»é¡µã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">//ä¸»è¦ä»£ç </div><div class="line">const dataDir = &quot;testdata&quot;</div><div class="line"></div><div class="line">func main() &#123;</div><div class="line">	// Init the recognizer.</div><div class="line">	rec, err := face.NewRecognizer(dataDir)</div><div class="line">	if err != nil &#123;</div><div class="line">		log.Fatalf(&quot;Can&apos;t init face recognizer: %v&quot;, err)</div><div class="line">	&#125;</div><div class="line">	// Free the resources when you&apos;re finished.</div><div class="line">	defer rec.Close()</div><div class="line"></div><div class="line">	// Test</div><div class="line">	testImage := filepath.Join(dataDir, &quot;face.jpg&quot;)</div><div class="line">	// Recognize faces on that image.</div><div class="line">	faces, err := rec.RecognizeFile(testImagePristin)</div><div class="line">	if err != nil &#123;</div><div class="line">		log.Fatalf(&quot;Can&apos;t recognize: %v&quot;, err)</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="tfhub"><a href="#tfhub" class="headerlink" title="tfhub"></a>tfhub</h2><p>è¿™é‡Œä½¿ç”¨googleå‘å¸ƒçš„inception_v3æ¨¡å‹ï¼Œç”±äºç½‘ç»œåŸå› ï¼Œå¦‚æœåœ¨ä»£ç ä¸­æ— æ³•ä¸‹è½½å¯ä»¥é€‰æ‹©æ‰‹åŠ¨ä¸‹è½½å¹¶æŒ‡å®šè·¯å¾„ï¼Œä¸‹è½½æ—¶urlä¸ºï¼š</p>
<blockquote>
<p><a href="https://storage.googleapis.com/tfhub-modules/google/imagenet/inception_v3/feature_vector/1.tar.gz" target="_blank" rel="external">https://storage.googleapis.com/tfhub-modules/google/imagenet/inception_v3/feature_vector/1.tar.gz</a></p>
</blockquote>
<p>æ¨¡å‹ä¸‹è½½å®Œæˆå¹¶æŒ‡å®šè·¯å¾„åå¯ç›´æ¥åœ¨hubä¸­ä½¿ç”¨å¹¶è·å¾—è¾“å…¥å›¾ç‰‡çš„feature vectorã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">height, width = hub.get_expected_image_size(module_spec)</div><div class="line">resized_input_tensor = tf.placeholder(tf.float32, [None, height, width, 3], name=&quot;input_tensor&quot;)</div><div class="line">m = hub.Module(module_spec)</div><div class="line">bottleneck_tensor = m(resized_input_tensor)</div></pre></td></tr></table></figure></p>
<h2 id="SVRæ¨¡å‹"><a href="#SVRæ¨¡å‹" class="headerlink" title="SVRæ¨¡å‹"></a>SVRæ¨¡å‹</h2><p>å¯¹äºä¸€èˆ¬çš„å›å½’é—®é¢˜ï¼Œç»™å®šè®­ç»ƒæ ·æœ¬ï¼Œæ¨¡å‹å¸Œæœ›å­¦ä¹ å¾—åˆ°ä¸€ä¸ªf(x)ä¸yå°½å¯èƒ½çš„æ¥è¿‘ï¼Œåªæœ‰f(x)å’Œyå®Œå…¨ç›¸åŒæ—¶ï¼ŒæŸå¤±æ‰ä¸ºé›¶ï¼Œè€Œæ”¯æŒå‘é‡å›å½’å¯ä»¥å®¹å¿f(x)ä¸yä¹‹å‰æœ€å¤šæœ‰Îµçš„åå·®ï¼Œå½“ä¸”ä»…å½“f(x)ä¸yçš„å·®åˆ«ç»å¯¹å€¼å¤§äºÎµæ—¶ï¼Œæ‰è®¡ç®—æŸå¤±ã€‚æ­¤æ—¶ç›¸å½“äºä»¥f(x)ä¸ºä¸­å¿ƒï¼Œæ„å»ºä¸€ä¸ªå®½åº¦ä¸º2Îµçš„é—´éš”å¸¦ï¼Œè‹¥è®­ç»ƒæ ·æœ¬è½å…¥æ­¤é—´éš”å¸¦ï¼Œåˆ™è®¤ä¸ºæ˜¯è¢«é¢„æµ‹æ­£ç¡®çš„ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="/images/svr.png" alt="å›¾ç‰‡"><br>å‚è€ƒé“¾æ¥ï¼š</p>
<blockquote>
<p><a href="https://blog.csdn.net/zb123455445/article/details/78354489" target="_blank" rel="external">https://blog.csdn.net/zb123455445/article/details/78354489</a></p>
</blockquote>
<p>Tensorflowä¸­å®ç°SVRæ¨¡å‹é¦–å…ˆè®¾ç½®å’Œåˆå§‹åŒ–W, bå’ŒÎµï¼Œé€šè¿‡W*x+bè·å¾—final_tensorï¼Œæœ€åè®¡ç®—lossï¼Œå…¬å¼ä¸ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">with tf.name_scope(&apos;loss&apos;):</div><div class="line">    loss = tf.reduce_mean(tf.maximum(0., tf.subtract(tf.abs(tf.subtract(final_tensor, ground_truth_input)), epsilon)))</div></pre></td></tr></table></figure></p>
<h1 id="æ¨¡å‹ä»£ç "><a href="#æ¨¡å‹ä»£ç " class="headerlink" title="æ¨¡å‹ä»£ç "></a>æ¨¡å‹ä»£ç </h1><p>è®­ç»ƒä»£ç å‚è€ƒäº†tensorflowæä¾›çš„é²œèŠ±åˆ†ç±»çš„retrain.pyä»£ç ï¼Œä¸»è¦å¯¹losså‡½æ•°ï¼Œæ•°æ®å¤„ç†å’Œæ¨¡å‹å¯¼å‡ºåšäº†ä¿®æ”¹ã€‚</p>
<blockquote>
<p>å‚è€ƒè¿æ¥ï¼š<a href="https://github.com/tensorflow/hub/raw/master/examples/image_retraining/retrain.py" target="_blank" rel="external">https://github.com/tensorflow/hub/raw/master/examples/image_retraining/retrain.py</a></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/25/Language-Model-based-on-BERT/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeb">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°èœé¸¡">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/25/Language-Model-based-on-BERT/" itemprop="url">Language Model based on BERT</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-03-25T19:22:22+08:00">
                2019-03-25
              </time>
            

            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="BERT"><a href="#BERT" class="headerlink" title="BERT"></a>BERT</h2><p>2018å¹´10æœˆè°·æ­ŒAIå›¢é˜Ÿå‘å¸ƒBERTæ¨¡å‹ï¼Œåœ¨11ç§NLPä»»åŠ¡æµ‹è¯•ä¸­åˆ·æ–°äº†æœ€ä½³æˆç»©ï¼Œä¸€æ—¶é£å¤´æ— ä¸¤ã€‚è‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸè¿‘ä¸¤å¹´æœ€å—å…³æ³¨ï¼Œå¹¶ä¸”è¿›å±•è¿…é€Ÿçš„å½“å±æœºå™¨é˜…è¯»ç†è§£ï¼Œå…¶ä¸­æ–¯å¦ç¦å¤§å­¦äº2016å¹´æå‡ºçš„SQuADæ•°æ®é›†å¯¹äºæ¨åŠ¨Machine Comprehensionçš„å‘å±•èµ·åˆ°äº†å·¨å¤§çš„ä½œç”¨ã€‚SQuAD 1.0å‘å¸ƒæ—¶ï¼ŒGoogleä¸€ç›´æ²¡æœ‰å‡ºæ‰‹ï¼Œå¾®è½¯æ›¾é•¿æœŸå æ®æ¦œé¦–ä½ç½®ï¼Œé˜¿é‡Œå·´å·´ä¹Ÿæ›¾çŸ­æš‚ç™»é¡¶ã€‚2018å¹´1æœˆ3æ—¥å¾®è½¯äºšæ´²ç ”ç©¶é™¢æäº¤çš„R-NETæ¨¡å‹åœ¨EMå€¼ï¼ˆExact Matchè¡¨ç¤ºé¢„æµ‹ç­”æ¡ˆå’ŒçœŸå®ç­”æ¡ˆå®Œå…¨åŒ¹é…ï¼‰ä¸Šä»¥82.650çš„æœ€é«˜åˆ†é¢†å…ˆï¼Œå¹¶ç‡å…ˆè¶…è¶Šäººç±»åˆ†æ•°82.304ã€‚è€Œå½“è°·æ­Œä¸€å‡ºæ‰‹ï¼Œä¾¿çŸ¥æœ‰æ²¡æœ‰ï¼Œç›®å‰SQuADæ’è¡Œæ¦œä¸Šå·²ç»è¢«BERTéœ¸å±ï¼Œæ’è¡Œå‰åˆ—çš„æ¨¡å‹å‡ ä¹å…¨éƒ¨åŸºäºBERTã€‚å…³äºé€šç”¨è¯­è¨€æ¨¡å‹çš„ä»‹ç»ï¼Œå¯ä»¥å‚è€ƒå¦ä¸€ç¯‡ç¿»è¯‘çš„åšå®¢ï¼Œä»¥åŠå¼ ä¿Šæ—è€å¸ˆçš„ä»‹ç»ï¼Œå‚è€ƒé“¾æ¥é™„åœ¨æœ¬æ–‡æœ«å°¾ã€‚</p>
<h2 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h2><p>è°·æ­Œå·²å¼€æ”¾æºç ï¼š</p>
<blockquote>
<p><a href="https://github.com/google-research/bert" target="_blank" rel="external">https://github.com/google-research/bert</a></p>
</blockquote>
<p>å…¶ä¸­create_pretraining_data.pyç”¨äºåˆ›å»ºè®­ç»ƒæ•°æ®ï¼Œrun_pretraining.pyç”¨äºè¿›è¡Œé¢„è®­ç»ƒã€‚æ­¤å¤–ï¼Œè°·æ­Œè¿˜æä¾›äº†äºŒé˜¶æ®µfine tunningçš„è®­ç»ƒä»£ç ï¼Œrun_classifier.pyç”¨äºå¥å­åˆ†ç±»ä»»åŠ¡ï¼Œrun_squad.pyç”¨äºæœºå™¨é˜…è¯»ç†è§£ä»»åŠ¡ï¼Œå¯ç›´æ¥ä½¿ç”¨ã€‚è€ŒåŸºäºBERTçš„è¯­è¨€æ¨¡å‹å¯ç›´æ¥å¯¹é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œæ”¹é€ åè·å¾—ï¼Œå‚è€ƒé“¾æ¥ï¼š</p>
<blockquote>
<p><a href="https://github.com/xu-song/bert-as-language-model" target="_blank" rel="external">https://github.com/xu-song/bert-as-language-model</a></p>
</blockquote>
<p>ä½œè€…ä¸»è¦å¯¹get_masked_lm_outputå‡½æ•°è¿›è¡Œäº†æ”¹é€ ï¼Œå…·ä½“åœ°ï¼Œè®¡ç®—masked lm lossæ—¶ä¸ä½¿ç”¨masked_lm_weightsï¼Œå‚è€ƒä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">#åŸä»£ç </div><div class="line">def get_masked_lm_output(bert_config, input_tensor, output_weights, positions,</div><div class="line">                         label_ids, label_weights):</div><div class="line">  &quot;&quot;&quot;Get loss and log probs for the masked LM.&quot;&quot;&quot;</div><div class="line">  input_tensor = gather_indexes(input_tensor, positions)</div><div class="line"></div><div class="line">  with tf.variable_scope(&quot;cls/predictions&quot;):</div><div class="line">    # We apply one more non-linear transformation before the output layer.</div><div class="line">    # This matrix is not used after pre-training.</div><div class="line">    with tf.variable_scope(&quot;transform&quot;):</div><div class="line">      input_tensor = tf.layers.dense(</div><div class="line">          input_tensor,</div><div class="line">          units=bert_config.hidden_size,</div><div class="line">          activation=modeling.get_activation(bert_config.hidden_act),</div><div class="line">          kernel_initializer=modeling.create_initializer(</div><div class="line">              bert_config.initializer_range))</div><div class="line">      input_tensor = modeling.layer_norm(input_tensor)</div><div class="line"></div><div class="line">    # The output weights are the same as the input embeddings, but there is</div><div class="line">    # an output-only bias for each token.</div><div class="line">    output_bias = tf.get_variable(</div><div class="line">        &quot;output_bias&quot;,</div><div class="line">        shape=[bert_config.vocab_size],</div><div class="line">        initializer=tf.zeros_initializer())</div><div class="line">    logits = tf.matmul(input_tensor, output_weights, transpose_b=True)</div><div class="line">    logits = tf.nn.bias_add(logits, output_bias)</div><div class="line">    log_probs = tf.nn.log_softmax(logits, axis=-1)</div><div class="line"></div><div class="line">    label_ids = tf.reshape(label_ids, [-1])</div><div class="line">    label_weights = tf.reshape(label_weights, [-1])</div><div class="line"></div><div class="line">    one_hot_labels = tf.one_hot(</div><div class="line">        label_ids, depth=bert_config.vocab_size, dtype=tf.float32)</div><div class="line"></div><div class="line">    # The `positions` tensor might be zero-padded (if the sequence is too</div><div class="line">    # short to have the maximum number of predictions). The `label_weights`</div><div class="line">    # tensor has a value of 1.0 for every real prediction and 0.0 for the</div><div class="line">    # padding predictions.</div><div class="line">    per_example_loss = -tf.reduce_sum(log_probs * one_hot_labels, axis=[-1])</div><div class="line">    numerator = tf.reduce_sum(label_weights * per_example_loss)</div><div class="line">    denominator = tf.reduce_sum(label_weights) + 1e-5</div><div class="line">    loss = numerator / denominator</div><div class="line"></div><div class="line">  return (loss, per_example_loss, log_probs)</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">#æ”¹é€ åä»£ç </div><div class="line">def get_masked_lm_output(bert_config, input_tensor, output_weights, positions,</div><div class="line">                         label_ids):</div><div class="line">  &quot;&quot;&quot;Get loss and log probs for the masked LM.&quot;&quot;&quot;</div><div class="line">  input_tensor = gather_indexes(input_tensor, positions)</div><div class="line"></div><div class="line">  with tf.variable_scope(&quot;cls/predictions&quot;):</div><div class="line">    # We apply one more non-linear transformation before the output layer.</div><div class="line">    # This matrix is not used after pre-training.</div><div class="line">    with tf.variable_scope(&quot;transform&quot;):</div><div class="line">      input_tensor = tf.layers.dense(</div><div class="line">          input_tensor,</div><div class="line">          units=bert_config.hidden_size,</div><div class="line">          activation=modeling.get_activation(bert_config.hidden_act),</div><div class="line">          kernel_initializer=modeling.create_initializer(</div><div class="line">              bert_config.initializer_range))</div><div class="line">      input_tensor = modeling.layer_norm(input_tensor)</div><div class="line"></div><div class="line">    # The output weights are the same as the input embeddings, but there is</div><div class="line">    # an output-only bias for each token.</div><div class="line">    output_bias = tf.get_variable(</div><div class="line">        &quot;output_bias&quot;,</div><div class="line">        shape=[bert_config.vocab_size],</div><div class="line">        initializer=tf.zeros_initializer())</div><div class="line">    logits = tf.matmul(input_tensor, output_weights, transpose_b=True)</div><div class="line">    logits = tf.nn.bias_add(logits, output_bias)</div><div class="line">    log_probs = tf.nn.log_softmax(logits, axis=-1)</div><div class="line"></div><div class="line">    label_ids = tf.reshape(label_ids, [-1])</div><div class="line"></div><div class="line">    one_hot_labels = tf.one_hot(</div><div class="line">        label_ids, depth=bert_config.vocab_size, dtype=tf.float32)</div><div class="line">    per_example_loss = -tf.reduce_sum(log_probs * one_hot_labels, axis=[-1])</div><div class="line">    loss = tf.reshape(per_example_loss, [-1, tf.shape(positions)[1]])</div><div class="line">    # TODO: dynamic gather from per_example_loss</div><div class="line">  return loss</div></pre></td></tr></table></figure>
<p>Pythonä¸­å¯ç›´æ¥æ„é€ è¾“å…¥ï¼Œç„¶ååˆ©ç”¨Tensorflowé«˜çº§APIæ¥è·å¾—ç»“æœï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">result = estimator.predict(input_fn=predict_input_fn)</div></pre></td></tr></table></figure></p>
<p>estimator.predictçš„é¢„æµ‹ç»“æœåœ¨model_fn_builderä¸­æŒ‡å®šï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">if mode == tf.estimator.ModeKeys.PREDICT:</div><div class="line">    output_spec = tf.contrib.tpu.TPUEstimatorSpec(</div><div class="line">    mode=mode, predictions=masked_lm_example_loss, scaffold_fn=scaffold_fn)  # è¾“å‡ºmask_wordçš„score</div></pre></td></tr></table></figure></p>
<p>BERTä½œä¸ºè¯­è¨€æ¨¡å‹æ—¶ï¼Œä¸€ä¸ªä¸ä¾¿ä¹‹å¤„æ˜¯éœ€è¦é€ä¸ªè®¡ç®—æ¯ä¸ªtokençš„probï¼Œç„¶åè®¡ç®—å¥å­çš„pplã€‚</p>
<blockquote>
<p>ppl: è‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸï¼ˆNLPï¼‰ä¸­ï¼Œè¡¡é‡è¯­è¨€æ¨¡å‹å¥½åçš„æŒ‡æ ‡ã€‚æ ¹æ®æ¯ä¸ªè¯æ¥ä¼°è®¡ä¸€å¥è¯å‡ºç°çš„æ¦‚ç‡ï¼Œå¹¶ç”¨å¥å­é•¿åº¦ä½œnormalizeï¼Œpplå€¼è¶Šå°ï¼Œè¡¨ç¤ºè¯¥å¥å­è¶Šåˆç†ã€‚</p>
</blockquote>
<p>ç»“æœè§£æï¼Œpplè®¡ç®—ä»£ç ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">def parse_result(result, all_tokens, output_file=None):</div><div class="line">  with tf.gfile.GFile(output_file, &quot;w&quot;) as writer:</div><div class="line">    tf.logging.info(&quot;***** Predict results *****&quot;)</div><div class="line">    i = 0</div><div class="line">    sentences = []</div><div class="line">    for word_loss in result:</div><div class="line">      # start of a sentence</div><div class="line">      if all_tokens[i] == &quot;[CLS]&quot;:</div><div class="line">        sentence = &#123;&#125;</div><div class="line">        tokens = []</div><div class="line">        sentence_loss = 0.0</div><div class="line">        word_count_per_sent = 0</div><div class="line">        i += 1</div><div class="line"></div><div class="line">      # add token</div><div class="line">      tokens.append(&#123;&quot;token&quot;: tokenization.printable_text(all_tokens[i]),</div><div class="line">                     &quot;prob&quot;: float(np.exp(-word_loss[0])) &#125;)</div><div class="line">      sentence_loss += word_loss[0]</div><div class="line">      word_count_per_sent += 1</div><div class="line">      i += 1</div><div class="line"></div><div class="line">      token_count_per_word = 0</div><div class="line">      while is_subtoken(all_tokens[i]):</div><div class="line">        token_count_per_word += 1</div><div class="line">        tokens.append(&#123;&quot;token&quot;: tokenization.printable_text(all_tokens[i]),</div><div class="line">                       &quot;prob&quot;: float(np.exp(-word_loss[token_count_per_word]))&#125;)</div><div class="line">        sentence_loss += word_loss[token_count_per_word]</div><div class="line">        i += 1</div><div class="line"></div><div class="line">      # end of a sentence</div><div class="line">      if all_tokens[i] == &quot;[SEP]&quot;:</div><div class="line">        sentence[&quot;tokens&quot;] = tokens</div><div class="line">        sentence[&quot;ppl&quot;] = float(np.exp(sentence_loss / word_count_per_sent))</div><div class="line">        sentences.append(sentence)</div><div class="line">        i += 1</div><div class="line"></div><div class="line">    if output_file is not None:</div><div class="line">      tf.logging.info(&quot;Saving results to %s&quot; % output_file)</div><div class="line">      writer.write(json.dumps(sentences, indent=2, ensure_ascii=False))</div></pre></td></tr></table></figure></p>
<h2 id="æ¨¡å‹è®­ç»ƒã€å¯¼å‡ºå’Œéƒ¨ç½²"><a href="#æ¨¡å‹è®­ç»ƒã€å¯¼å‡ºå’Œéƒ¨ç½²" class="headerlink" title="æ¨¡å‹è®­ç»ƒã€å¯¼å‡ºå’Œéƒ¨ç½²"></a>æ¨¡å‹è®­ç»ƒã€å¯¼å‡ºå’Œéƒ¨ç½²</h2><p>ç”±äºé¢„è®­ç»ƒæ¨¡å‹ä¸­masked lm lossèŠ‚ç‚¹å¹¶æœªå‘½åï¼Œæ‰€ä»¥æ·»åŠ nameåéœ€è¦å¯åŠ¨å¾ˆçŸ­æš‚çš„é¢„è®­ç»ƒï¼ŒåŒæ—¶å°†æ¨¡å‹å¯¼å‡ºã€‚get_masked_lm_outputå‡½æ•°å‚è€ƒbert-as-language-modelä¸­çš„ä»£ç è¿›è¡Œç›¸åº”æ”¹é€ ã€‚Tensorflowç‰ˆæœ¬å‡çº§åï¼Œä½¿ç”¨estimatoræ¥å—è¾“å…¥ï¼ŒåŸæ¥æˆ‘ä»¬æœ€çˆ±çš„placeholderæ‰¾ä¸åˆ°äº†ï¼Œè€Œåœ¨éƒ¨ç½²æ¨¡å‹æ—¶ï¼Œä»éœ€è¦ä½¿ç”¨placeholderæ¥å—è¾“å…¥ï¼Œå¯åœ¨run_pretraining.pyå¯¼å‡ºæ¨¡å‹æ—¶æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">if FLAGS.do_export:</div><div class="line">    estimator._export_to_tpu = False</div><div class="line">    name_to_features = [(&quot;input_ids&quot;, tf.int32), (&quot;input_mask&quot;, tf.int32),</div><div class="line">                            (&quot;segment_ids&quot;, tf.int32), (&quot;masked_lm_positions&quot;, tf.int32), (&quot;masked_lm_ids&quot;, tf.int32),</div><div class="line">                            (&quot;masked_lm_weights&quot;, tf.float32), (&quot;next_sentence_labels&quot;, tf.int32)]</div><div class="line">    feature_placeholders = &#123;name: tf.placeholder(dtype, [1, FLAGS.max_seq_length],</div><div class="line">                                                     name=&apos;bert/&apos; + name + &quot;_placeholder&quot;) for name, dtype in</div><div class="line">                                name_to_features&#125;</div><div class="line">    serving_input_fn = tf.estimator.export.build_raw_serving_input_receiver_fn(feature_placeholders)</div><div class="line">    path = estimator.export_savedmodel(&quot;./export/&quot;, serving_input_fn)</div></pre></td></tr></table></figure></p>
<p>æœ¬æ–‡éƒ¨ç½²æ¨¡å‹ä½¿ç”¨golangè¯­è¨€ï¼ŒåŸºäºtfgoå®ç°æ¨¡å‹çš„åŠ è½½å’Œtensorflowå¯¹åº”èŠ‚ç‚¹çš„è®¡ç®—ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//æ¨¡å‹åŠ è½½</div><div class="line">model := tg.LoadModel(*modleDir, []string&#123;&quot;serve&quot;&#125;, nil)</div></pre></td></tr></table></figure></p>
<p>å‚è€ƒrun_pretraining.pyå¯¼å‡ºæ¨¡å‹æ—¶çš„ä»£ç ï¼Œgolangç¨‹åºä¸­éœ€è¦æ„é€ 7ä¸ªè¾“å…¥ï¼Œè€Œmasked_lm_weightså’Œnext_sentence_labelså¯¹äºè¯­è¨€æ¨¡å‹æ²¡æœ‰å½±å“ï¼Œå¯æŒ‰è‡ªå·±å–œçˆ±æ„é€ ã€‚ä»¥ä¸‹é¢çš„ä¾‹å­è¯´æ˜ä¸€ä¸‹è¾“å…¥çš„æ„é€ æ ‡å‡†ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">//è¾“å…¥å¥å­</div><div class="line">ä½•å¼‚æµ®äº‘è¿‡å¤ªç©º</div><div class="line">//å¤„ç†åçš„å¥å­</div><div class="line">[[CLS] ä½• å¼‚ æµ® äº‘ è¿‡ å¤ª ç©º [SEP]]</div><div class="line">------------------------token 1-----------------------------</div><div class="line">//input_ids</div><div class="line">[101 103 2460 3859 756 6814 1922 4958 102 0 0 0 ...]</div><div class="line">//input_mask</div><div class="line">[1 1 1 1 1 1 1 1 1 0 0 0 ...]</div><div class="line">//segment_ids</div><div class="line">[0 0 0 ...]</div><div class="line">//masked_lm_positions</div><div class="line">[1 0 0 0 ...]</div><div class="line">//masked_lm_ids</div><div class="line">[862 0 0 0 0 0 ...]</div><div class="line">------------------------token 2----------------------------</div><div class="line">[101 862 103 3859 756 6814 1922 4958 102 0 0 0 ...]</div><div class="line">[1 1 1 1 1 1 1 1 1 0 0 0 ...]</div><div class="line">[0 0 0 ...]</div><div class="line">[2 0 0 0 ...]</div><div class="line">[2460 0 0 0 ...]</div></pre></td></tr></table></figure></p>
<p>Golangç¨‹åºè®¡ç®—å¥å­pplï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">for i := 1; i &lt; ids_len - 1; i++&#123;</div><div class="line">	...</div><div class="line">	result := model.Exec([]tf.Output&#123;</div><div class="line">				model.Op(&quot;cls/predictions/lm_loss&quot;, 0),</div><div class="line">			&#125;, map[tf.Output]*tf.Tensor&#123;</div><div class="line">				model.Op(&quot;bert/input_ids_placeholder&quot;, 0):           inputX1,</div><div class="line">				model.Op(&quot;bert/input_mask_placeholder&quot;, 0):           inputX2,</div><div class="line">				model.Op(&quot;bert/segment_ids_placeholder&quot;, 0):           inputX3,</div><div class="line">				model.Op(&quot;bert/masked_lm_positions_placeholder&quot;, 0):           inputX4,</div><div class="line">				model.Op(&quot;bert/masked_lm_ids_placeholder&quot;, 0):           inputX5,</div><div class="line">				model.Op(&quot;bert/masked_lm_weights_placeholder&quot;, 0):           inputX6,</div><div class="line">				model.Op(&quot;bert/next_sentence_labels_placeholder&quot;, 0):           inputX7,</div><div class="line">			&#125;)</div><div class="line">	</div><div class="line">	val := result[0].Value().([][]float32)[0][0]</div><div class="line">	sentence_loss += float64(val)</div><div class="line">	...</div><div class="line">&#125;</div><div class="line"></div><div class="line">ppl := math.Pow(math.E, sentence_loss / float64(ids_len))</div></pre></td></tr></table></figure></p>
<h2 id="é™„å½•"><a href="#é™„å½•" class="headerlink" title="é™„å½•"></a>é™„å½•</h2><blockquote>
<p><a href="https://zhuanlan.zhihu.com/p/49271699" target="_blank" rel="external">ä»Word Embeddingåˆ°Bertæ¨¡å‹</a><br><a href="https://zhuanlan.zhihu.com/p/56865533" target="_blank" rel="external">æ•ˆæœæƒŠäººçš„GPT 2.0æ¨¡å‹</a><br><a href="http://octopuscoder.github.io/2019/03/11/é€šç”¨è¯­è¨€æ¨¡å‹/" target="_blank" rel="external">é€šç”¨è¯­è¨€æ¨¡å‹</a></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          
            <img class="site-author-image" itemprop="image"
              src="/images/avatar.gif"
              alt="Jeb" />
          
            <p class="site-author-name" itemprop="name">Jeb</p>
            <p class="site-description motion-element" itemprop="description">æˆ‘èœæ•…æˆ‘åœ¨</p>
        </div>

        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/">
            
                <span class="site-state-item-count">24</span>
                <span class="site-state-item-name">æ—¥å¿—</span>
              </a>
            </div>
          

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jeb</span>

  
</div>


  <div class="powered-by">ç”± <a class="theme-link" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.2</div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>


  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->



  


  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
